// trix@2.1.10 downloaded from https://ga.jspm.io/npm:trix@2.1.10/dist/trix.esm.min.js

var o="2.1.10";const s="[data-trix-attachment]",a={preview:{presentation:"gallery",caption:{name:!0,size:!0}},file:{caption:{size:!0}}},l={default:{tagName:"div",parse:!1},quote:{tagName:"blockquote",nestable:!0},heading1:{tagName:"h1",terminal:!0,breakOnReturn:!0,group:!1},code:{tagName:"pre",terminal:!0,htmlAttributes:["language"],text:{plaintext:!0}},bulletList:{tagName:"ul",parse:!1},bullet:{tagName:"li",listAttribute:"bulletList",group:!1,nestable:!0,test(o){return r(o.parentNode)===l[this.listAttribute].tagName}},numberList:{tagName:"ol",parse:!1},number:{tagName:"li",listAttribute:"numberList",group:!1,nestable:!0,test(o){return r(o.parentNode)===l[this.listAttribute].tagName}},attachmentGallery:{tagName:"div",exclusive:!0,terminal:!0,parse:!1,group:!1}},r=o=>{var s;return null==o||null===(s=o.tagName)||void 0===s?void 0:s.toLowerCase()},c=navigator.userAgent.match(/android\s([0-9]+.*Chrome)/i),h=c&&parseInt(c[1]);var d={composesExistingText:/Android.*Chrome/.test(navigator.userAgent),recentAndroid:h&&h>12,samsungAndroid:h&&navigator.userAgent.match(/Android.*SM-/),forcesObjectResizing:/Trident.*rv:11/.test(navigator.userAgent),supportsInputEvents:"undefined"!=typeof InputEvent&&["data","getTargetRanges","inputType"].every((o=>o in InputEvent.prototype))},m={attachFiles:"Attach Files",bold:"Bold",bullets:"Bullets",byte:"Byte",bytes:"Bytes",captionPlaceholder:"Add a captionâ€¦",code:"Code",heading1:"Heading",indent:"Increase Level",italic:"Italic",link:"Link",numbers:"Numbers",outdent:"Decrease Level",quote:"Quote",redo:"Redo",remove:"Remove",strike:"Strikethrough",undo:"Undo",unlink:"Unlink",url:"URL",urlPlaceholder:"Enter a URLâ€¦",GB:"GB",KB:"KB",MB:"MB",PB:"PB",TB:"TB"};const p=[m.bytes,m.KB,m.MB,m.GB,m.TB,m.PB];var T={prefix:"IEC",precision:2,formatter(o){switch(o){case 0:return"0 ".concat(m.bytes);case 1:return"1 ".concat(m.byte);default:let s;"SI"===this.prefix?s=1e3:"IEC"===this.prefix&&(s=1024);const a=Math.floor(Math.log(o)/Math.log(s)),l=(o/Math.pow(s,a)).toFixed(this.precision).replace(/0*$/,"").replace(/\.$/,"");return"".concat(l," ").concat(p[a])}}};const B="\ufeff",j="Â ",g=function(o){for(const s in o){const a=o[s];this[s]=a}return this},_=document.documentElement,W=_.matches,f=function(o){let{onElement:s,matchingSelector:a,withCallback:l,inPhase:c,preventDefault:h,times:d}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const m=s||_,p=a,T="capturing"===c,u=function(o){null!=d&&0==--d&&u.destroy();const s=A(o.target,{matchingSelector:p});null!=s&&(null==l||l.call(s,o,s),h&&o.preventDefault())};return u.destroy=()=>m.removeEventListener(o,u,T),m.addEventListener(o,u,T),u},b=function(o){let{onElement:s,bubbles:a,cancelable:l,attributes:c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const h=null!=s?s:_;a=!1!==a,l=!1!==l;const d=document.createEvent("Events");return d.initEvent(o,a,l),null!=c&&g.call(d,c),h.dispatchEvent(d)},v=function(o,s){if(1===(null==o?void 0:o.nodeType))return W.call(o,s)},A=function(o){let{matchingSelector:s,untilNode:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(;o&&o.nodeType!==Node.ELEMENT_NODE;)o=o.parentNode;if(null!=o){if(null==s)return o;if(o.closest&&null==a)return o.closest(s);for(;o&&o!==a;){if(v(o,s))return o;o=o.parentNode}}},y=o=>document.activeElement!==o&&x(o,document.activeElement),x=function(o,s){if(o&&s)for(;s;){if(s===o)return!0;s=s.parentNode}},C=function(o){var s;if(null===(s=o)||void 0===s||!s.parentNode)return;let a=0;for(o=o.previousSibling;o;)a++,o=o.previousSibling;return a},E=o=>{var s;return null==o||null===(s=o.parentNode)||void 0===s?void 0:s.removeChild(o)},S=function(o){let{onlyNodesOfType:s,usingFilter:a,expandEntityReferences:l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const c=(()=>{switch(s){case"element":return NodeFilter.SHOW_ELEMENT;case"text":return NodeFilter.SHOW_TEXT;case"comment":return NodeFilter.SHOW_COMMENT;default:return NodeFilter.SHOW_ALL}})();return document.createTreeWalker(o,c,null!=a?a:null,!0===l)},R=o=>{var s;return null==o||null===(s=o.tagName)||void 0===s?void 0:s.toLowerCase()},k=function(o){let s,a,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"object"==typeof o?(l=o,o=l.tagName):l={attributes:l};const c=document.createElement(o);if(null!=l.editable&&(null==l.attributes&&(l.attributes={}),l.attributes.contenteditable=l.editable),l.attributes)for(s in l.attributes)a=l.attributes[s],c.setAttribute(s,a);if(l.style)for(s in l.style)a=l.style[s],c.style[s]=a;if(l.data)for(s in l.data)a=l.data[s],c.dataset[s]=a;return l.className&&l.className.split(" ").forEach((o=>{c.classList.add(o)})),l.textContent&&(c.textContent=l.textContent),l.childNodes&&[].concat(l.childNodes).forEach((o=>{c.appendChild(o)})),c};let U;const w=function(){if(null!=U)return U;U=[];for(const o in l){const s=l[o];s.tagName&&U.push(s.tagName)}return U},L=o=>N(null==o?void 0:o.firstChild),D=function(o){let{strict:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{strict:!0};return s?N(o):N(o)||!N(o.firstChild)&&function(o){return w().includes(R(o))&&!w().includes(R(o.firstChild))}(o)},N=o=>I(o)&&"block"===(null==o?void 0:o.data),I=o=>(null==o?void 0:o.nodeType)===Node.COMMENT_NODE,O=function(o){let{name:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(o)return M(o)?o.data===B?!s||o.parentNode.dataset.trixCursorTarget===s:void 0:O(o.firstChild)},P=o=>v(o,s),F=o=>M(o)&&""===(null==o?void 0:o.data),M=o=>(null==o?void 0:o.nodeType)===Node.TEXT_NODE,V={level2Enabled:!0,getLevel(){return this.level2Enabled&&d.supportsInputEvents?2:0},pickFiles(o){const s=k("input",{type:"file",multiple:!0,hidden:!0,id:this.fileInputId});s.addEventListener("change",(()=>{o(s.files),E(s)})),E(document.getElementById(this.fileInputId)),document.body.appendChild(s),s.click()}};var H={removeBlankTableCells:!1,tableCellSeparator:" | ",tableRowSeparator:"\n"},J={bold:{tagName:"strong",inheritable:!0,parser(o){const s=window.getComputedStyle(o);return"bold"===s.fontWeight||s.fontWeight>=600}},italic:{tagName:"em",inheritable:!0,parser:o=>"italic"===window.getComputedStyle(o).fontStyle},href:{groupTagName:"a",parser(o){const a="a:not(".concat(s,")"),l=o.closest(a);if(l)return l.getAttribute("href")}},strike:{tagName:"del",inheritable:!0},frozen:{style:{backgroundColor:"highlight"}}},K={getDefaultHTML:()=>'<div class="trix-button-row">\n      <span class="trix-button-group trix-button-group--text-tools" data-trix-button-group="text-tools">\n        <button type="button" class="trix-button trix-button--icon trix-button--icon-bold" data-trix-attribute="bold" data-trix-key="b" title="'.concat(m.bold,'" tabindex="-1">').concat(m.bold,'</button>\n        <button type="button" class="trix-button trix-button--icon trix-button--icon-italic" data-trix-attribute="italic" data-trix-key="i" title="').concat(m.italic,'" tabindex="-1">').concat(m.italic,'</button>\n        <button type="button" class="trix-button trix-button--icon trix-button--icon-strike" data-trix-attribute="strike" title="').concat(m.strike,'" tabindex="-1">').concat(m.strike,'</button>\n        <button type="button" class="trix-button trix-button--icon trix-button--icon-link" data-trix-attribute="href" data-trix-action="link" data-trix-key="k" title="').concat(m.link,'" tabindex="-1">').concat(m.link,'</button>\n      </span>\n\n      <span class="trix-button-group trix-button-group--block-tools" data-trix-button-group="block-tools">\n        <button type="button" class="trix-button trix-button--icon trix-button--icon-heading-1" data-trix-attribute="heading1" title="').concat(m.heading1,'" tabindex="-1">').concat(m.heading1,'</button>\n        <button type="button" class="trix-button trix-button--icon trix-button--icon-quote" data-trix-attribute="quote" title="').concat(m.quote,'" tabindex="-1">').concat(m.quote,'</button>\n        <button type="button" class="trix-button trix-button--icon trix-button--icon-code" data-trix-attribute="code" title="').concat(m.code,'" tabindex="-1">').concat(m.code,'</button>\n        <button type="button" class="trix-button trix-button--icon trix-button--icon-bullet-list" data-trix-attribute="bullet" title="').concat(m.bullets,'" tabindex="-1">').concat(m.bullets,'</button>\n        <button type="button" class="trix-button trix-button--icon trix-button--icon-number-list" data-trix-attribute="number" title="').concat(m.numbers,'" tabindex="-1">').concat(m.numbers,'</button>\n        <button type="button" class="trix-button trix-button--icon trix-button--icon-decrease-nesting-level" data-trix-action="decreaseNestingLevel" title="').concat(m.outdent,'" tabindex="-1">').concat(m.outdent,'</button>\n        <button type="button" class="trix-button trix-button--icon trix-button--icon-increase-nesting-level" data-trix-action="increaseNestingLevel" title="').concat(m.indent,'" tabindex="-1">').concat(m.indent,'</button>\n      </span>\n\n      <span class="trix-button-group trix-button-group--file-tools" data-trix-button-group="file-tools">\n        <button type="button" class="trix-button trix-button--icon trix-button--icon-attach" data-trix-action="attachFiles" title="').concat(m.attachFiles,'" tabindex="-1">').concat(m.attachFiles,'</button>\n      </span>\n\n      <span class="trix-button-group-spacer"></span>\n\n      <span class="trix-button-group trix-button-group--history-tools" data-trix-button-group="history-tools">\n        <button type="button" class="trix-button trix-button--icon trix-button--icon-undo" data-trix-action="undo" data-trix-key="z" title="').concat(m.undo,'" tabindex="-1">').concat(m.undo,'</button>\n        <button type="button" class="trix-button trix-button--icon trix-button--icon-redo" data-trix-action="redo" data-trix-key="shift+z" title="').concat(m.redo,'" tabindex="-1">').concat(m.redo,'</button>\n      </span>\n    </div>\n\n    <div class="trix-dialogs" data-trix-dialogs>\n      <div class="trix-dialog trix-dialog--link" data-trix-dialog="href" data-trix-dialog-attribute="href">\n        <div class="trix-dialog__link-fields">\n          <input type="url" name="href" class="trix-input trix-input--dialog" placeholder="').concat(m.urlPlaceholder,'" aria-label="').concat(m.url,'" required data-trix-input>\n          <div class="trix-button-group">\n            <input type="button" class="trix-button trix-button--dialog" value="').concat(m.link,'" data-trix-method="setAttribute">\n            <input type="button" class="trix-button trix-button--dialog" value="').concat(m.unlink,'" data-trix-method="removeAttribute">\n          </div>\n        </div>\n      </div>\n    </div>')};const G={interval:5e3};var Y=Object.freeze({__proto__:null,attachments:a,blockAttributes:l,browser:d,css:{attachment:"attachment",attachmentCaption:"attachment__caption",attachmentCaptionEditor:"attachment__caption-editor",attachmentMetadata:"attachment__metadata",attachmentMetadataContainer:"attachment__metadata-container",attachmentName:"attachment__name",attachmentProgress:"attachment__progress",attachmentSize:"attachment__size",attachmentToolbar:"attachment__toolbar",attachmentGallery:"attachment-gallery"},fileSize:T,input:V,keyNames:{8:"backspace",9:"tab",13:"return",27:"escape",37:"left",39:"right",46:"delete",68:"d",72:"h",79:"o"},lang:m,parser:H,textAttributes:J,toolbar:K,undo:G});class z{static proxyMethod(o){const{name:s,toMethod:a,toProperty:l,optional:c}=q(o);this.prototype[s]=function(){let o,h;var d,m;a?h=c?null===(d=this[a])||void 0===d?void 0:d.call(this):this[a]():l&&(h=this[l]);return c?(o=null===(m=h)||void 0===m?void 0:m[s],o?X.call(o,h,arguments):void 0):(o=h[s],X.call(o,h,arguments))}}}const q=function(o){const s=o.match(Z);if(!s)throw new Error("can't parse @proxyMethod expression: ".concat(o));const a={name:s[4]};return null!=s[2]?a.toMethod=s[1]:a.toProperty=s[1],null!=s[3]&&(a.optional=!0),a},{apply:X}=Function.prototype,Z=new RegExp("^(.+?)(\\(\\))?(\\?)?\\.(.+?)$");var Q,tt,et;class $ extends z{static box(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return o instanceof this?o:this.fromUCS2String(null==o?void 0:o.toString())}static fromUCS2String(o){return new this(o,lt(o))}static fromCodepoints(o){return new this(ct(o),o)}constructor(o,s){super(...arguments),this.ucs2String=o,this.codepoints=s,this.length=this.codepoints.length,this.ucs2Length=this.ucs2String.length}offsetToUCS2Offset(o){return ct(this.codepoints.slice(0,Math.max(0,o))).length}offsetFromUCS2Offset(o){return lt(this.ucs2String.slice(0,Math.max(0,o))).length}slice(){return this.constructor.fromCodepoints(this.codepoints.slice(...arguments))}charAt(o){return this.slice(o,o+1)}isEqualTo(o){return this.constructor.box(o).ucs2String===this.ucs2String}toJSON(){return this.ucs2String}getCacheKey(){return this.ucs2String}toString(){return this.ucs2String}}const it=1===(null===(Q=Array.from)||void 0===Q?void 0:Q.call(Array,"ðŸ‘¼").length),st=null!=(null===(tt=" ".codePointAt)||void 0===tt?void 0:tt.call(" ",0)),at=" ðŸ‘¼"===(null===(et=String.fromCodePoint)||void 0===et?void 0:et.call(String,32,128124));let lt,ct;lt=it&&st?o=>Array.from(o).map((o=>o.codePointAt(0))):function(o){const s=[];let a=0;const{length:l}=o;for(;a<l;){let c=o.charCodeAt(a++);if(55296<=c&&c<=56319&&a<l){const s=o.charCodeAt(a++);56320==(64512&s)?c=((1023&c)<<10)+(1023&s)+65536:a--}s.push(c)}return s},ct=at?o=>String.fromCodePoint(...Array.from(o||[])):function(o){return(()=>{const s=[];return Array.from(o).forEach((o=>{let a="";o>65535&&(o-=65536,a+=String.fromCharCode(o>>>10&1023|55296),o=56320|1023&o),s.push(a+String.fromCharCode(o))})),s})().join("")};let ut=0;class nt extends z{static fromJSONString(o){return this.fromJSON(JSON.parse(o))}constructor(){super(...arguments),this.id=++ut}hasSameConstructorAs(o){return this.constructor===(null==o?void 0:o.constructor)}isEqualTo(o){return this===o}inspect(){const o=[],s=this.contentsForInspection()||{};for(const a in s){const l=s[a];o.push("".concat(a,"=").concat(l))}return"#<".concat(this.constructor.name,":").concat(this.id).concat(o.length?" ".concat(o.join(", ")):"",">")}contentsForInspection(){}toJSONString(){return JSON.stringify(this)}toUTF16String(){return $.box(this)}getCacheKey(){return this.id.toString()}}const rt=function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(o.length!==s.length)return!1;for(let a=0;a<o.length;a++)if(o[a]!==s[a])return!1;return!0},ot=function(o){const s=o.slice(0);for(var a=arguments.length,l=new Array(a>1?a-1:0),c=1;c<a;c++)l[c-1]=arguments[c];return s.splice(...l),s},ht=/[\u05BE\u05C0\u05C3\u05D0-\u05EA\u05F0-\u05F4\u061B\u061F\u0621-\u063A\u0640-\u064A\u066D\u0671-\u06B7\u06BA-\u06BE\u06C0-\u06CE\u06D0-\u06D5\u06E5\u06E6\u200F\u202B\u202E\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE72\uFE74\uFE76-\uFEFC]/,xt=function(){const o=k("input",{dir:"auto",name:"x",dirName:"x.dir"}),s=k("textarea",{dir:"auto",name:"y",dirName:"y.dir"}),a=k("form");a.appendChild(o),a.appendChild(s);const l=function(){try{return new FormData(a).has(s.dirName)}catch(o){return!1}}(),c=function(){try{return o.matches(":dir(ltr),:dir(rtl)")}catch(o){return!1}}();return l?function(o){return s.value=o,new FormData(a).get(s.dirName)}:c?function(s){return o.value=s,o.matches(":dir(rtl)")?"rtl":"ltr"}:function(o){const s=o.trim().charAt(0);return ht.test(s)?"rtl":"ltr"}}();let Et=null,ne=null,re=null,oe=null;const dt=()=>(Et||(Et=ft().concat(mt())),Et),gt=o=>l[o],mt=()=>(ne||(ne=Object.keys(l)),ne),pt=o=>J[o],ft=()=>(re||(re=Object.keys(J)),re),bt=function(o,s){vt(o).textContent=s.replace(/%t/g,o)},vt=function(o){const s=document.createElement("style");s.setAttribute("type","text/css"),s.setAttribute("data-tag-name",o.toLowerCase());const a=At();return a&&s.setAttribute("nonce",a),document.head.insertBefore(s,document.head.firstChild),s},At=function(){const o=yt("trix-csp-nonce")||yt("csp-nonce");if(o){const{nonce:s,content:a}=o;return""==s?a:s}},yt=o=>document.head.querySelector("meta[name=".concat(o,"]")),se={"application/x-trix-feature-detection":"test"},Ct=function(o){const s=o.getData("text/plain"),a=o.getData("text/html");if(!s||!a)return null==s?void 0:s.length;{const{body:o}=(new DOMParser).parseFromString(a,"text/html");if(o.textContent===s)return!o.querySelector("*")}},ae=/Mac|^iP/.test(navigator.platform)?o=>o.metaKey:o=>o.ctrlKey;const St=o=>setTimeout(o,1),Rt=function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s={};for(const a in o){const l=o[a];s[a]=l}return s},kt=function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Object.keys(o).length!==Object.keys(s).length)return!1;for(const a in o)if(o[a]!==s[a])return!1;return!0},Tt=function(o){if(null!=o)return Array.isArray(o)||(o=[o,o]),[Dt(o[0]),Dt(null!=o[1]?o[1]:o[0])]},wt=function(o){if(null==o)return;const[s,a]=Tt(o);return Nt(s,a)},Lt=function(o,s){if(null==o||null==s)return;const[a,l]=Tt(o),[c,h]=Tt(s);return Nt(a,c)&&Nt(l,h)},Dt=function(o){return"number"==typeof o?o:Rt(o)},Nt=function(o,s){return"number"==typeof o?o===s:kt(o,s)};class It extends z{constructor(){super(...arguments),this.update=this.update.bind(this),this.selectionManagers=[]}start(){this.started||(this.started=!0,document.addEventListener("selectionchange",this.update,!0))}stop(){if(this.started)return this.started=!1,document.removeEventListener("selectionchange",this.update,!0)}registerSelectionManager(o){if(!this.selectionManagers.includes(o))return this.selectionManagers.push(o),this.start()}unregisterSelectionManager(o){if(this.selectionManagers=this.selectionManagers.filter((s=>s!==o)),0===this.selectionManagers.length)return this.stop()}notifySelectionManagersOfSelectionChange(){return this.selectionManagers.map((o=>o.selectionDidChange()))}update(){this.notifySelectionManagersOfSelectionChange()}reset(){this.update()}}const le=new It,Pt=function(){const o=window.getSelection();if(o.rangeCount>0)return o},Ft=function(){var o;const s=null===(o=Pt())||void 0===o?void 0:o.getRangeAt(0);if(s&&!Bt(s))return s},Mt=function(o){const s=window.getSelection();return s.removeAllRanges(),s.addRange(o),le.update()},Bt=o=>_t(o.startContainer)||_t(o.endContainer),_t=o=>!Object.getPrototypeOf(o),jt=o=>o.replace(new RegExp("".concat(B),"g"),"").replace(new RegExp("".concat(j),"g")," "),ce=new RegExp("[^\\S".concat(j,"]")),Ut=o=>o.replace(new RegExp("".concat(ce.source),"g")," ").replace(/\ {2,}/g," "),Vt=function(o,s){if(o.isEqualTo(s))return["",""];const a=zt(o,s),{length:l}=a.utf16String;let c;if(l){const{offset:h}=a,d=o.codepoints.slice(0,h).concat(o.codepoints.slice(h+l));c=zt(s,$.fromCodepoints(d))}else c=zt(s,o);return[a.utf16String.toString(),c.utf16String.toString()]},zt=function(o,s){let a=0,l=o.length,c=s.length;for(;a<l&&o.charAt(a).isEqualTo(s.charAt(a));)a++;for(;l>a+1&&o.charAt(l-1).isEqualTo(s.charAt(c-1));)l--,c--;return{utf16String:o.slice(a,l),offset:a}};class qt extends nt{static fromCommonAttributesOfObjects(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!o.length)return new this;let s=Gt(o[0]),a=s.getKeys();return o.slice(1).forEach((o=>{a=s.getKeysCommonToHash(Gt(o)),s=s.slice(a)})),s}static box(o){return Gt(o)}constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(...arguments),this.values=Kt(o)}add(o,s){return this.merge(Ht(o,s))}remove(o){return new qt(Kt(this.values,o))}get(o){return this.values[o]}has(o){return o in this.values}merge(o){return new qt(Jt(this.values,Yt(o)))}slice(o){const s={};return Array.from(o).forEach((o=>{this.has(o)&&(s[o]=this.values[o])})),new qt(s)}getKeys(){return Object.keys(this.values)}getKeysCommonToHash(o){return o=Gt(o),this.getKeys().filter((s=>this.values[s]===o.values[s]))}isEqualTo(o){return rt(this.toArray(),Gt(o).toArray())}isEmpty(){return 0===this.getKeys().length}toArray(){if(!this.array){const o=[];for(const s in this.values){const a=this.values[s];o.push(o.push(s,a))}this.array=o.slice(0)}return this.array}toObject(){return Kt(this.values)}toJSON(){return this.toObject()}contentsForInspection(){return{values:JSON.stringify(this.values)}}}const Ht=function(o,s){const a={};return a[o]=s,a},Jt=function(o,s){const a=Kt(o);for(const o in s){const l=s[o];a[o]=l}return a},Kt=function(o,s){const a={};return Object.keys(o).sort().forEach((l=>{l!==s&&(a[l]=o[l])})),a},Gt=function(o){return o instanceof qt?o:new qt(o)},Yt=function(o){return o instanceof qt?o.values:o};class $t{static groupObjects(){let o,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],{depth:a,asTree:l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};l&&null==a&&(a=0);const c=[];return Array.from(s).forEach((s=>{var h;if(o){var d,m,p;if(null!==(d=s.canBeGrouped)&&void 0!==d&&d.call(s,a)&&null!==(m=(p=o[o.length-1]).canBeGroupedWith)&&void 0!==m&&m.call(p,s,a))return void o.push(s);c.push(new this(o,{depth:a,asTree:l})),o=null}null!==(h=s.canBeGrouped)&&void 0!==h&&h.call(s,a)?o=[s]:c.push(s)})),o&&c.push(new this(o,{depth:a,asTree:l})),c}constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],{depth:s,asTree:a}=arguments.length>1?arguments[1]:void 0;this.objects=o,a&&(this.depth=s,this.objects=this.constructor.groupObjects(this.objects,{asTree:a,depth:this.depth+1}))}getObjects(){return this.objects}getDepth(){return this.depth}getCacheKey(){const o=["objectGroup"];return Array.from(this.getObjects()).forEach((s=>{o.push(s.getCacheKey())})),o.join("/")}}class Xt extends z{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(...arguments),this.objects={},Array.from(o).forEach((o=>{const s=JSON.stringify(o);null==this.objects[s]&&(this.objects[s]=o)}))}find(o){const s=JSON.stringify(o);return this.objects[s]}}class Zt{constructor(o){this.reset(o)}add(o){const s=Qt(o);this.elements[s]=o}remove(o){const s=Qt(o),a=this.elements[s];if(a)return delete this.elements[s],a}reset(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.elements={},Array.from(o).forEach((o=>{this.add(o)})),o}}const Qt=o=>o.dataset.trixStoreKey;class te extends z{isPerforming(){return!0===this.performing}hasPerformed(){return!0===this.performed}hasSucceeded(){return this.performed&&this.succeeded}hasFailed(){return this.performed&&!this.succeeded}getPromise(){return this.promise||(this.promise=new Promise(((o,s)=>(this.performing=!0,this.perform(((a,l)=>{this.succeeded=a,this.performing=!1,this.performed=!0,this.succeeded?o(l):s(l)})))))),this.promise}perform(o){return o(!1)}release(){var o,s;null===(o=this.promise)||void 0===o||null===(s=o.cancel)||void 0===s||s.call(o),this.promise=null,this.performing=null,this.performed=null,this.succeeded=null}}te.proxyMethod("getPromise().then"),te.proxyMethod("getPromise().catch");class ee extends z{constructor(o){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(...arguments),this.object=o,this.options=s,this.childViews=[],this.rootView=this}getNodes(){return this.nodes||(this.nodes=this.createNodes()),this.nodes.map((o=>o.cloneNode(!0)))}invalidate(){var o;return this.nodes=null,this.childViews=[],null===(o=this.parentView)||void 0===o?void 0:o.invalidate()}invalidateViewForObject(o){var s;return null===(s=this.findViewForObject(o))||void 0===s?void 0:s.invalidate()}findOrCreateCachedChildView(o,s,a){let l=this.getCachedViewForObject(s);return l?this.recordChildView(l):(l=this.createChildView(...arguments),this.cacheViewForObject(l,s)),l}createChildView(o,s){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};s instanceof $t&&(a.viewClass=o,o=ie);const l=new o(s,a);return this.recordChildView(l)}recordChildView(o){return o.parentView=this,o.rootView=this.rootView,this.childViews.push(o),o}getAllChildViews(){let o=[];return this.childViews.forEach((s=>{o.push(s),o=o.concat(s.getAllChildViews())})),o}findElement(){return this.findElementForObject(this.object)}findElementForObject(o){const s=null==o?void 0:o.id;if(s)return this.rootView.element.querySelector("[data-trix-id='".concat(s,"']"))}findViewForObject(o){for(const s of this.getAllChildViews())if(s.object===o)return s}getViewCache(){return this.rootView!==this?this.rootView.getViewCache():this.isViewCachingEnabled()?(this.viewCache||(this.viewCache={}),this.viewCache):void 0}isViewCachingEnabled(){return!1!==this.shouldCacheViews}enableViewCaching(){this.shouldCacheViews=!0}disableViewCaching(){this.shouldCacheViews=!1}getCachedViewForObject(o){var s;return null===(s=this.getViewCache())||void 0===s?void 0:s[o.getCacheKey()]}cacheViewForObject(o,s){const a=this.getViewCache();a&&(a[s.getCacheKey()]=o)}garbageCollectCachedViews(){const o=this.getViewCache();if(o){const s=this.getAllChildViews().concat(this).map((o=>o.object.getCacheKey()));for(const a in o)s.includes(a)||delete o[a]}}}class ie extends ee{constructor(){super(...arguments),this.objectGroup=this.object,this.viewClass=this.options.viewClass,delete this.options.viewClass}getChildViews(){return this.childViews.length||Array.from(this.objectGroup.getObjects()).forEach((o=>{this.findOrCreateCachedChildView(this.viewClass,o,this.options)})),this.childViews}createNodes(){const o=this.createContainerElement();return this.getChildViews().forEach((s=>{Array.from(s.getNodes()).forEach((s=>{o.appendChild(s)}))})),[o]}createContainerElement(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.objectGroup.getDepth();return this.getChildViews()[0].createContainerElement(o)}}
/*! @license DOMPurify 3.2.3 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.3/LICENSE */const{entries:ue,setPrototypeOf:he,isFrozen:de,getPrototypeOf:ge,getOwnPropertyDescriptor:me}=Object;let{freeze:pe,seal:fe,create:be}=Object,{apply:ve,construct:Ae}="undefined"!=typeof Reflect&&Reflect;pe||(pe=function(o){return o}),fe||(fe=function(o){return o}),ve||(ve=function(o,s,a){return o.apply(s,a)}),Ae||(Ae=function(o,s){return new o(...s)});const ye=ke(Array.prototype.forEach),xe=ke(Array.prototype.pop),Ce=ke(Array.prototype.push),Ee=ke(String.prototype.toLowerCase),Se=ke(String.prototype.toString),Re=ke(String.prototype.match),Ne=ke(String.prototype.replace),Ie=ke(String.prototype.indexOf),Oe=ke(String.prototype.trim),Pe=ke(Object.prototype.hasOwnProperty),Fe=ke(RegExp.prototype.test),Me=(Be=TypeError,function(){for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return Ae(Be,s)});var Be;function ke(o){return function(s){for(var a=arguments.length,l=new Array(a>1?a-1:0),c=1;c<a;c++)l[c-1]=arguments[c];return ve(o,s,l)}}function Te(o,s){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ee;he&&he(o,null);let l=s.length;for(;l--;){let c=s[l];if("string"==typeof c){const o=a(c);o!==c&&(de(s)||(s[l]=o),c=o)}o[c]=!0}return o}function we(o){for(let s=0;s<o.length;s++)Pe(o,s)||(o[s]=null);return o}function Le(o){const s=be(null);for(const[a,l]of ue(o))Pe(o,a)&&(Array.isArray(l)?s[a]=we(l):l&&"object"==typeof l&&l.constructor===Object?s[a]=Le(l):s[a]=l);return s}function De(o,s){for(;null!==o;){const a=me(o,s);if(a){if(a.get)return ke(a.get);if("function"==typeof a.value)return ke(a.value)}o=ge(o)}return function(){return null}}const je=pe(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),_e=pe(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),We=pe(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Ue=pe(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),ze=pe(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Ve=pe(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),qe=pe(["#text"]),He=pe(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Je=pe(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Ke=pe(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Ge=pe(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),$e=fe(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Ye=fe(/<%[\w\W]*|[\w\W]*%>/gm),Xe=fe(/\$\{[\w\W]*}/gm),Ze=fe(/^data-[\-\w.\u00B7-\uFFFF]+$/),Qe=fe(/^aria-[\-\w]+$/),ti=fe(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),ei=fe(/^(?:\w+script|data):/i),ii=fe(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),ni=fe(/^html$/i),oi=fe(/^[a-z][.\w]*(-[.\w]+)+$/i);var si=Object.freeze({__proto__:null,ARIA_ATTR:Qe,ATTR_WHITESPACE:ii,CUSTOM_ELEMENT:oi,DATA_ATTR:Ze,DOCTYPE_NAME:ni,ERB_EXPR:Ye,IS_ALLOWED_URI:ti,IS_SCRIPT_OR_DATA:ei,MUSTACHE_EXPR:$e,TMPLIT_EXPR:Xe});const ai=1,li=3,hi=7,Ai=8,$i=9,ri=function(){return"undefined"==typeof window?null:window};var fn=function t(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ri();const i=o=>t(o);if(i.version="3.2.3",i.removed=[],!o||!o.document||o.document.nodeType!==$i)return i.isSupported=!1,i;let{document:s}=o;const a=s,l=a.currentScript,{DocumentFragment:c,HTMLTemplateElement:h,Node:d,Element:m,NodeFilter:p,NamedNodeMap:T=o.NamedNodeMap||o.MozNamedAttrMap,HTMLFormElement:B,DOMParser:j,trustedTypes:_}=o,W=m.prototype,U=De(W,"cloneNode"),V=De(W,"remove"),H=De(W,"nextSibling"),J=De(W,"childNodes"),K=De(W,"parentNode");if("function"==typeof h){const o=s.createElement("template");o.content&&o.content.ownerDocument&&(s=o.content.ownerDocument)}let G,Y="";const{implementation:X,createNodeIterator:Z,createDocumentFragment:Q,getElementsByTagName:tt}=s,{importNode:et}=a;let it={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};i.isSupported="function"==typeof ue&&"function"==typeof K&&X&&void 0!==X.createHTMLDocument;const{MUSTACHE_EXPR:st,ERB_EXPR:at,TMPLIT_EXPR:lt,DATA_ATTR:ct,ARIA_ATTR:ut,IS_SCRIPT_OR_DATA:ht,ATTR_WHITESPACE:xt,CUSTOM_ELEMENT:Et}=si;let{IS_ALLOWED_URI:ne}=si,re=null;const oe=Te({},[...je,..._e,...We,...ze,...qe]);let se=null;const ae=Te({},[...He,...Je,...Ke,...Ge]);let le=Object.seal(be(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ce=null,he=null,de=!0,ge=!0,me=!1,fe=!0,ve=!1,Ae=!0,Be=!1,$e=!1,Ye=!1,Xe=!1,Ze=!1,Qe=!1,ei=!0,ii=!1,oi=!0,fn=!1,bn={},vn=null;const An=Te({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let yn=null;const xn=Te({},["audio","video","img","source","image","track"]);let wn=null;const Nn=Te({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Wn="http://www.w3.org/1998/Math/MathML",Un="http://www.w3.org/2000/svg",zn="http://www.w3.org/1999/xhtml";let Vn=zn,qn=!1,$n=null;const Yn=Te({},[Wn,Un,zn],Se);let Xn=Te({},["mi","mo","mn","ms","mtext"]),nr=Te({},["annotation-xml"]);const sr=Te({},["title","style","font","a","script"]);let ar=null;const lr=["application/xhtml+xml","text/html"];let cr=null,dr=null;const Sr=s.createElement("form"),Lt=function(o){return o instanceof RegExp||o instanceof Function},Dt=function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!dr||dr!==o){if(o&&"object"==typeof o||(o={}),o=Le(o),ar=-1===lr.indexOf(o.PARSER_MEDIA_TYPE)?"text/html":o.PARSER_MEDIA_TYPE,cr="application/xhtml+xml"===ar?Se:Ee,re=Pe(o,"ALLOWED_TAGS")?Te({},o.ALLOWED_TAGS,cr):oe,se=Pe(o,"ALLOWED_ATTR")?Te({},o.ALLOWED_ATTR,cr):ae,$n=Pe(o,"ALLOWED_NAMESPACES")?Te({},o.ALLOWED_NAMESPACES,Se):Yn,wn=Pe(o,"ADD_URI_SAFE_ATTR")?Te(Le(Nn),o.ADD_URI_SAFE_ATTR,cr):Nn,yn=Pe(o,"ADD_DATA_URI_TAGS")?Te(Le(xn),o.ADD_DATA_URI_TAGS,cr):xn,vn=Pe(o,"FORBID_CONTENTS")?Te({},o.FORBID_CONTENTS,cr):An,ce=Pe(o,"FORBID_TAGS")?Te({},o.FORBID_TAGS,cr):{},he=Pe(o,"FORBID_ATTR")?Te({},o.FORBID_ATTR,cr):{},bn=!!Pe(o,"USE_PROFILES")&&o.USE_PROFILES,de=!1!==o.ALLOW_ARIA_ATTR,ge=!1!==o.ALLOW_DATA_ATTR,me=o.ALLOW_UNKNOWN_PROTOCOLS||!1,fe=!1!==o.ALLOW_SELF_CLOSE_IN_ATTR,ve=o.SAFE_FOR_TEMPLATES||!1,Ae=!1!==o.SAFE_FOR_XML,Be=o.WHOLE_DOCUMENT||!1,Xe=o.RETURN_DOM||!1,Ze=o.RETURN_DOM_FRAGMENT||!1,Qe=o.RETURN_TRUSTED_TYPE||!1,Ye=o.FORCE_BODY||!1,ei=!1!==o.SANITIZE_DOM,ii=o.SANITIZE_NAMED_PROPS||!1,oi=!1!==o.KEEP_CONTENT,fn=o.IN_PLACE||!1,ne=o.ALLOWED_URI_REGEXP||ti,Vn=o.NAMESPACE||zn,Xn=o.MATHML_TEXT_INTEGRATION_POINTS||Xn,nr=o.HTML_INTEGRATION_POINTS||nr,le=o.CUSTOM_ELEMENT_HANDLING||{},o.CUSTOM_ELEMENT_HANDLING&&Lt(o.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(le.tagNameCheck=o.CUSTOM_ELEMENT_HANDLING.tagNameCheck),o.CUSTOM_ELEMENT_HANDLING&&Lt(o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(le.attributeNameCheck=o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),o.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(le.allowCustomizedBuiltInElements=o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),ve&&(ge=!1),Ze&&(Xe=!0),bn&&(re=Te({},qe),se=[],!0===bn.html&&(Te(re,je),Te(se,He)),!0===bn.svg&&(Te(re,_e),Te(se,Je),Te(se,Ge)),!0===bn.svgFilters&&(Te(re,We),Te(se,Je),Te(se,Ge)),!0===bn.mathMl&&(Te(re,ze),Te(se,Ke),Te(se,Ge))),o.ADD_TAGS&&(re===oe&&(re=Le(re)),Te(re,o.ADD_TAGS,cr)),o.ADD_ATTR&&(se===ae&&(se=Le(se)),Te(se,o.ADD_ATTR,cr)),o.ADD_URI_SAFE_ATTR&&Te(wn,o.ADD_URI_SAFE_ATTR,cr),o.FORBID_CONTENTS&&(vn===An&&(vn=Le(vn)),Te(vn,o.FORBID_CONTENTS,cr)),oi&&(re["#text"]=!0),Be&&Te(re,["html","head","body"]),re.table&&(Te(re,["tbody"]),delete ce.tbody),o.TRUSTED_TYPES_POLICY){if("function"!=typeof o.TRUSTED_TYPES_POLICY.createHTML)throw Me('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof o.TRUSTED_TYPES_POLICY.createScriptURL)throw Me('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');G=o.TRUSTED_TYPES_POLICY,Y=G.createHTML("")}else void 0===G&&(G=function(o,s){if("object"!=typeof o||"function"!=typeof o.createPolicy)return null;let a=null;const l="data-tt-policy-suffix";s&&s.hasAttribute(l)&&(a=s.getAttribute(l));const c="dompurify"+(a?"#"+a:"");try{return o.createPolicy(c,{createHTML:o=>o,createScriptURL:o=>o})}catch(o){return console.warn("TrustedTypes policy "+c+" could not be created."),null}}(_,l)),null!==G&&"string"==typeof Y&&(Y=G.createHTML(""));pe&&pe(o),dr=o}},Rr=Te({},[..._e,...We,...Ue]),Tr=Te({},[...ze,...Ve]),Ot=function(o){Ce(i.removed,{element:o});try{K(o).removeChild(o)}catch(s){V(o)}},Pt=function(o,s){try{Ce(i.removed,{attribute:s.getAttributeNode(o),from:s})}catch(o){Ce(i.removed,{attribute:null,from:s})}if(s.removeAttribute(o),"is"===o)if(Xe||Ze)try{Ot(s)}catch(o){}else try{s.setAttribute(o,"")}catch(o){}},Ft=function(o){let a=null,l=null;if(Ye)o="<remove></remove>"+o;else{const s=Re(o,/^[\r\n\t ]+/);l=s&&s[0]}"application/xhtml+xml"===ar&&Vn===zn&&(o='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+o+"</body></html>");const c=G?G.createHTML(o):o;if(Vn===zn)try{a=(new j).parseFromString(c,ar)}catch(o){}if(!a||!a.documentElement){a=X.createDocument(Vn,"template",null);try{a.documentElement.innerHTML=qn?Y:c}catch(o){}}const h=a.body||a.documentElement;return o&&l&&h.insertBefore(s.createTextNode(l),h.childNodes[0]||null),Vn===zn?tt.call(a,Be?"html":"body")[0]:Be?a.documentElement:h},Mt=function(o){return Z.call(o.ownerDocument||o,o,p.SHOW_ELEMENT|p.SHOW_COMMENT|p.SHOW_TEXT|p.SHOW_PROCESSING_INSTRUCTION|p.SHOW_CDATA_SECTION,null)},Bt=function(o){return o instanceof B&&("string"!=typeof o.nodeName||"string"!=typeof o.textContent||"function"!=typeof o.removeChild||!(o.attributes instanceof T)||"function"!=typeof o.removeAttribute||"function"!=typeof o.setAttribute||"string"!=typeof o.namespaceURI||"function"!=typeof o.insertBefore||"function"!=typeof o.hasChildNodes)},_t=function(o){return"function"==typeof d&&o instanceof d};function jt(o,s,a){ye(o,(o=>{o.call(i,s,a,dr)}))}const Wt=function(o){let s=null;if(jt(it.beforeSanitizeElements,o,null),Bt(o))return Ot(o),!0;const a=cr(o.nodeName);if(jt(it.uponSanitizeElement,o,{tagName:a,allowedTags:re}),o.hasChildNodes()&&!_t(o.firstElementChild)&&Fe(/<[/\w]/g,o.innerHTML)&&Fe(/<[/\w]/g,o.textContent))return Ot(o),!0;if(o.nodeType===hi)return Ot(o),!0;if(Ae&&o.nodeType===Ai&&Fe(/<[/\w]/g,o.data))return Ot(o),!0;if(!re[a]||ce[a]){if(!ce[a]&&Vt(a)){if(le.tagNameCheck instanceof RegExp&&Fe(le.tagNameCheck,a))return!1;if(le.tagNameCheck instanceof Function&&le.tagNameCheck(a))return!1}if(oi&&!vn[a]){const s=K(o)||o.parentNode,a=J(o)||o.childNodes;if(a&&s)for(let l=a.length-1;l>=0;--l){const c=U(a[l],!0);c.__removalCount=(o.__removalCount||0)+1,s.insertBefore(c,H(o))}}return Ot(o),!0}return o instanceof m&&!function(o){let s=K(o);s&&s.tagName||(s={namespaceURI:Vn,tagName:"template"});const a=Ee(o.tagName),l=Ee(s.tagName);return!!$n[o.namespaceURI]&&(o.namespaceURI===Un?s.namespaceURI===zn?"svg"===a:s.namespaceURI===Wn?"svg"===a&&("annotation-xml"===l||Xn[l]):Boolean(Rr[a]):o.namespaceURI===Wn?s.namespaceURI===zn?"math"===a:s.namespaceURI===Un?"math"===a&&nr[l]:Boolean(Tr[a]):o.namespaceURI===zn?!(s.namespaceURI===Un&&!nr[l])&&!(s.namespaceURI===Wn&&!Xn[l])&&!Tr[a]&&(sr[a]||!Rr[a]):!("application/xhtml+xml"!==ar||!$n[o.namespaceURI]))}(o)?(Ot(o),!0):"noscript"!==a&&"noembed"!==a&&"noframes"!==a||!Fe(/<\/no(script|embed|frames)/i,o.innerHTML)?(ve&&o.nodeType===li&&(s=o.textContent,ye([st,at,lt],(o=>{s=Ne(s,o," ")})),o.textContent!==s&&(Ce(i.removed,{element:o.cloneNode()}),o.textContent=s)),jt(it.afterSanitizeElements,o,null),!1):(Ot(o),!0)},Ut=function(o,a,l){if(ei&&("id"===a||"name"===a)&&(l in s||l in Sr))return!1;if(ge&&!he[a]&&Fe(ct,a));else if(de&&Fe(ut,a));else if(!se[a]||he[a]){if(!(Vt(o)&&(le.tagNameCheck instanceof RegExp&&Fe(le.tagNameCheck,o)||le.tagNameCheck instanceof Function&&le.tagNameCheck(o))&&(le.attributeNameCheck instanceof RegExp&&Fe(le.attributeNameCheck,a)||le.attributeNameCheck instanceof Function&&le.attributeNameCheck(a))||"is"===a&&le.allowCustomizedBuiltInElements&&(le.tagNameCheck instanceof RegExp&&Fe(le.tagNameCheck,l)||le.tagNameCheck instanceof Function&&le.tagNameCheck(l))))return!1}else if(wn[a]);else if(Fe(ne,Ne(l,xt,"")));else if("src"!==a&&"xlink:href"!==a&&"href"!==a||"script"===o||0!==Ie(l,"data:")||!yn[o])if(me&&!Fe(ht,Ne(l,xt,"")));else if(l)return!1;return!0},Vt=function(o){return"annotation-xml"!==o&&Re(o,Et)},zt=function(o){jt(it.beforeSanitizeAttributes,o,null);const{attributes:s}=o;if(!s||Bt(o))return;const a={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:se,forceKeepAttr:void 0};let l=s.length;for(;l--;){const c=s[l],{name:h,namespaceURI:d,value:m}=c,p=cr(h);let T="value"===h?m:Oe(m);if(a.attrName=p,a.attrValue=T,a.keepAttr=!0,a.forceKeepAttr=void 0,jt(it.uponSanitizeAttribute,o,a),T=a.attrValue,!ii||"id"!==p&&"name"!==p||(Pt(h,o),T="user-content-"+T),Ae&&Fe(/((--!?|])>)|<\/(style|title)/i,T)){Pt(h,o);continue}if(a.forceKeepAttr)continue;if(Pt(h,o),!a.keepAttr)continue;if(!fe&&Fe(/\/>/i,T)){Pt(h,o);continue}ve&&ye([st,at,lt],(o=>{T=Ne(T,o," ")}));const B=cr(o.nodeName);if(Ut(B,p,T)){if(G&&"object"==typeof _&&"function"==typeof _.getAttributeType)if(d);else switch(_.getAttributeType(B,p)){case"TrustedHTML":T=G.createHTML(T);break;case"TrustedScriptURL":T=G.createScriptURL(T)}try{d?o.setAttributeNS(d,h,T):o.setAttribute(h,T),Bt(o)?Ot(o):xe(i.removed)}catch(o){}}}jt(it.afterSanitizeAttributes,o,null)},kr=function t(o){let s=null;const a=Mt(o);for(jt(it.beforeSanitizeShadowDOM,o,null);s=a.nextNode();)jt(it.uponSanitizeShadowNode,s,null),Wt(s),zt(s),s.content instanceof c&&t(s.content);jt(it.afterSanitizeShadowDOM,o,null)};return i.sanitize=function(o){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=null,h=null,m=null,p=null;if(qn=!o,qn&&(o="\x3c!--\x3e"),"string"!=typeof o&&!_t(o)){if("function"!=typeof o.toString)throw Me("toString is not a function");if("string"!=typeof(o=o.toString()))throw Me("dirty is not a string, aborting")}if(!i.isSupported)return o;if($e||Dt(s),i.removed=[],"string"==typeof o&&(fn=!1),fn){if(o.nodeName){const s=cr(o.nodeName);if(!re[s]||ce[s])throw Me("root node is forbidden and cannot be sanitized in-place")}}else if(o instanceof d)l=Ft("\x3c!----\x3e"),h=l.ownerDocument.importNode(o,!0),h.nodeType===ai&&"BODY"===h.nodeName||"HTML"===h.nodeName?l=h:l.appendChild(h);else{if(!Xe&&!ve&&!Be&&-1===o.indexOf("<"))return G&&Qe?G.createHTML(o):o;if(l=Ft(o),!l)return Xe?null:Qe?Y:""}l&&Ye&&Ot(l.firstChild);const T=Mt(fn?o:l);for(;m=T.nextNode();)Wt(m),zt(m),m.content instanceof c&&kr(m.content);if(fn)return o;if(Xe){if(Ze)for(p=Q.call(l.ownerDocument);l.firstChild;)p.appendChild(l.firstChild);else p=l;return(se.shadowroot||se.shadowrootmode)&&(p=et.call(a,p,!0)),p}let B=Be?l.outerHTML:l.innerHTML;return Be&&re["!doctype"]&&l.ownerDocument&&l.ownerDocument.doctype&&l.ownerDocument.doctype.name&&Fe(ni,l.ownerDocument.doctype.name)&&(B="<!DOCTYPE "+l.ownerDocument.doctype.name+">\n"+B),ve&&ye([st,at,lt],(o=>{B=Ne(B,o," ")})),G&&Qe?G.createHTML(B):B},i.setConfig=function(){Dt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),$e=!0},i.clearConfig=function(){dr=null,$e=!1},i.isValidAttribute=function(o,s,a){dr||Dt({});const l=cr(o),c=cr(s);return Ut(l,c,a)},i.addHook=function(o,s){"function"==typeof s&&Ce(it[o],s)},i.removeHook=function(o){return xe(it[o])},i.removeHooks=function(o){it[o]=[]},i.removeAllHooks=function(){it={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},i}();const bn="style href src width height language class".split(" "),vn="javascript:".split(" "),An="script iframe form noscript".split(" ");class ci extends z{static setHTML(o,s){const a=new this(s).sanitize(),l=a.getHTML?a.getHTML():a.outerHTML;o.innerHTML=l}static sanitize(o,s){const a=new this(o,s);return a.sanitize(),a}constructor(o){let{allowedAttributes:s,forbiddenProtocols:a,forbiddenElements:l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(...arguments),this.allowedAttributes=s||bn,this.forbiddenProtocols=a||vn,this.forbiddenElements=l||An,this.body=ui(o)}sanitize(){return this.sanitizeElements(),this.normalizeListElementNesting(),fn.sanitize(this.body,{ADD_ATTR:["language"],RETURN_DOM:!0})}getHTML(){return this.body.innerHTML}getBody(){return this.body}sanitizeElements(){const o=S(this.body),s=[];for(;o.nextNode();){const a=o.currentNode;switch(a.nodeType){case Node.ELEMENT_NODE:this.elementIsRemovable(a)?s.push(a):this.sanitizeElement(a);break;case Node.COMMENT_NODE:s.push(a)}}return s.forEach((o=>E(o))),this.body}sanitizeElement(o){return o.hasAttribute("href")&&this.forbiddenProtocols.includes(o.protocol)&&o.removeAttribute("href"),Array.from(o.attributes).forEach((s=>{let{name:a}=s;this.allowedAttributes.includes(a)||0===a.indexOf("data-trix")||o.removeAttribute(a)})),o}normalizeListElementNesting(){return Array.from(this.body.querySelectorAll("ul,ol")).forEach((o=>{const s=o.previousElementSibling;s&&"li"===R(s)&&s.appendChild(o)})),this.body}elementIsRemovable(o){if((null==o?void 0:o.nodeType)===Node.ELEMENT_NODE)return this.elementIsForbidden(o)||this.elementIsntSerializable(o)}elementIsForbidden(o){return this.forbiddenElements.includes(R(o))}elementIsntSerializable(o){return"false"===o.getAttribute("data-trix-serialize")&&!P(o)}}const ui=function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";o=o.replace(/<\/html[^>]*>[^]*$/i,"</html>");const s=document.implementation.createHTMLDocument("");return s.documentElement.innerHTML=o,Array.from(s.head.querySelectorAll("style")).forEach((o=>{s.body.appendChild(o)})),s.body},{css:yn}=Y;class di extends ee{constructor(){super(...arguments),this.attachment=this.object,this.attachment.uploadProgressDelegate=this,this.attachmentPiece=this.options.piece}createContentNodes(){return[]}createNodes(){let o;const s=o=k({tagName:"figure",className:this.getClassName(),data:this.getData(),editable:!1}),a=this.getHref();return a&&(o=k({tagName:"a",editable:!1,attributes:{href:a,tabindex:-1}}),s.appendChild(o)),this.attachment.hasContent()?ci.setHTML(o,this.attachment.getContent()):this.createContentNodes().forEach((s=>{o.appendChild(s)})),o.appendChild(this.createCaptionElement()),this.attachment.isPending()&&(this.progressElement=k({tagName:"progress",attributes:{class:yn.attachmentProgress,value:this.attachment.getUploadProgress(),max:100},data:{trixMutable:!0,trixStoreKey:["progressElement",this.attachment.id].join("/")}}),s.appendChild(this.progressElement)),[gi("left"),s,gi("right")]}createCaptionElement(){const o=k({tagName:"figcaption",className:yn.attachmentCaption}),s=this.attachmentPiece.getCaption();if(s)o.classList.add("".concat(yn.attachmentCaption,"--edited")),o.textContent=s;else{let s,a;const l=this.getCaptionConfig();if(l.name&&(s=this.attachment.getFilename()),l.size&&(a=this.attachment.getFormattedFilesize()),s){const a=k({tagName:"span",className:yn.attachmentName,textContent:s});o.appendChild(a)}if(a){s&&o.appendChild(document.createTextNode(" "));const l=k({tagName:"span",className:yn.attachmentSize,textContent:a});o.appendChild(l)}}return o}getClassName(){const o=[yn.attachment,"".concat(yn.attachment,"--").concat(this.attachment.getType())],s=this.attachment.getExtension();return s&&o.push("".concat(yn.attachment,"--").concat(s)),o.join(" ")}getData(){const o={trixAttachment:JSON.stringify(this.attachment),trixContentType:this.attachment.getContentType(),trixId:this.attachment.id},{attributes:s}=this.attachmentPiece;return s.isEmpty()||(o.trixAttributes=JSON.stringify(s)),this.attachment.isPending()&&(o.trixSerialize=!1),o}getHref(){if(!mi(this.attachment.getContent(),"a"))return this.attachment.getHref()}getCaptionConfig(){var o;const s=this.attachment.getType(),l=Rt(null===(o=a[s])||void 0===o?void 0:o.caption);return"file"===s&&(l.name=!0),l}findProgressElement(){var o;return null===(o=this.findElement())||void 0===o?void 0:o.querySelector("progress")}attachmentDidChangeUploadProgress(){const o=this.attachment.getUploadProgress(),s=this.findProgressElement();s&&(s.value=o)}}const gi=o=>k({tagName:"span",textContent:B,data:{trixCursorTarget:o,trixSerialize:!1}}),mi=function(o,s){const a=k("div");return ci.setHTML(a,o||""),a.querySelector(s)};class pi extends di{constructor(){super(...arguments),this.attachment.previewDelegate=this}createContentNodes(){return this.image=k({tagName:"img",attributes:{src:""},data:{trixMutable:!0}}),this.refresh(this.image),[this.image]}createCaptionElement(){const o=super.createCaptionElement(...arguments);return o.textContent||o.setAttribute("data-trix-placeholder",m.captionPlaceholder),o}refresh(o){var s;o||(o=null===(s=this.findElement())||void 0===s?void 0:s.querySelector("img"));if(o)return this.updateAttributesForImage(o)}updateAttributesForImage(o){const s=this.attachment.getURL(),a=this.attachment.getPreviewURL();if(o.src=a||s,a===s)o.removeAttribute("data-trix-serialized-attributes");else{const a=JSON.stringify({src:s});o.setAttribute("data-trix-serialized-attributes",a)}const l=this.attachment.getWidth(),c=this.attachment.getHeight();null!=l&&(o.width=l),null!=c&&(o.height=c);const h=["imageElement",this.attachment.id,o.src,o.width,o.height].join("/");o.dataset.trixStoreKey=h}attachmentDidChangeAttributes(){return this.refresh(this.image),this.refresh()}}class fi extends ee{constructor(){super(...arguments),this.piece=this.object,this.attributes=this.piece.getAttributes(),this.textConfig=this.options.textConfig,this.context=this.options.context,this.piece.attachment?this.attachment=this.piece.attachment:this.string=this.piece.toString()}createNodes(){let o=this.attachment?this.createAttachmentNodes():this.createStringNodes();const s=this.createElement();if(s){const a=function(o){for(;null!==(s=o)&&void 0!==s&&s.firstElementChild;){var s;o=o.firstElementChild}return o}(s);Array.from(o).forEach((o=>{a.appendChild(o)})),o=[s]}return o}createAttachmentNodes(){const o=this.attachment.isPreviewable()?pi:di;return this.createChildView(o,this.piece.attachment,{piece:this.piece}).getNodes()}createStringNodes(){var o;if(null!==(o=this.textConfig)&&void 0!==o&&o.plaintext)return[document.createTextNode(this.string)];{const o=[],s=this.string.split("\n");for(let a=0;a<s.length;a++){const l=s[a];if(a>0){const s=k("br");o.push(s)}if(l.length){const s=document.createTextNode(this.preserveSpaces(l));o.push(s)}}return o}}createElement(){let o,s,a;const l={};for(s in this.attributes){a=this.attributes[s];const h=pt(s);if(h){if(h.tagName){var c;const s=k(h.tagName);c?(c.appendChild(s),c=s):o=c=s}if(h.styleProperty&&(l[h.styleProperty]=a),h.style)for(s in h.style)a=h.style[s],l[s]=a}}if(Object.keys(l).length)for(s in o||(o=k("span")),l)a=l[s],o.style[s]=a;return o}createContainerElement(){for(const o in this.attributes){const s=this.attributes[o],a=pt(o);if(a&&a.groupTagName){const l={};return l[o]=s,k(a.groupTagName,l)}}}preserveSpaces(o){return this.context.isLast&&(o=o.replace(/\ $/,j)),o=o.replace(/(\S)\ {3}(\S)/g,"$1 ".concat(j," $2")).replace(/\ {2}/g,"".concat(j," ")).replace(/\ {2}/g," ".concat(j)),(this.context.isFirst||this.context.followsWhitespace)&&(o=o.replace(/^\ /,j)),o}}class bi extends ee{constructor(){super(...arguments),this.text=this.object,this.textConfig=this.options.textConfig}createNodes(){const o=[],s=$t.groupObjects(this.getPieces()),a=s.length-1;for(let c=0;c<s.length;c++){const h=s[c],d={};0===c&&(d.isFirst=!0),c===a&&(d.isLast=!0),vi(l)&&(d.followsWhitespace=!0);const m=this.findOrCreateCachedChildView(fi,h,{textConfig:this.textConfig,context:d});o.push(...Array.from(m.getNodes()||[]));var l=h}return o}getPieces(){return Array.from(this.text.getPieces()).filter((o=>!o.hasAttribute("blockBreak")))}}const vi=o=>/\s$/.test(null==o?void 0:o.toString()),{css:xn}=Y;class yi extends ee{constructor(){super(...arguments),this.block=this.object,this.attributes=this.block.getAttributes()}createNodes(){const o=[document.createComment("block")];if(this.block.isEmpty())o.push(k("br"));else{var s;const a=null===(s=gt(this.block.getLastAttribute()))||void 0===s?void 0:s.text,l=this.findOrCreateCachedChildView(bi,this.block.text,{textConfig:a});o.push(...Array.from(l.getNodes()||[])),this.shouldAddExtraNewlineElement()&&o.push(k("br"))}if(this.attributes.length)return o;{let s;const{tagName:a}=l.default;this.block.isRTL()&&(s={dir:"rtl"});const c=k({tagName:a,attributes:s});return o.forEach((o=>c.appendChild(o))),[c]}}createContainerElement(o){const s={};let a;const l=this.attributes[o],{tagName:c,htmlAttributes:h=[]}=gt(l);if(0===o&&this.block.isRTL()&&Object.assign(s,{dir:"rtl"}),"attachmentGallery"===l){const o=this.block.getBlockBreakPosition();a="".concat(xn.attachmentGallery," ").concat(xn.attachmentGallery,"--").concat(o)}return Object.entries(this.block.htmlAttributes).forEach((o=>{let[a,l]=o;h.includes(a)&&(s[a]=l)})),k({tagName:c,className:a,attributes:s})}shouldAddExtraNewlineElement(){return/\n\n$/.test(this.block.toString())}}class xi extends ee{static render(o){const s=k("div"),a=new this(o,{element:s});return a.render(),a.sync(),s}constructor(){super(...arguments),this.element=this.options.element,this.elementStore=new Zt,this.setDocument(this.object)}setDocument(o){o.isEqualTo(this.document)||(this.document=this.object=o)}render(){if(this.childViews=[],this.shadowElement=k("div"),!this.document.isEmpty()){const o=$t.groupObjects(this.document.getBlocks(),{asTree:!0});Array.from(o).forEach((o=>{const s=this.findOrCreateCachedChildView(yi,o);Array.from(s.getNodes()).map((o=>this.shadowElement.appendChild(o)))}))}}isSynced(){return Ei(this.shadowElement,this.element)}sync(){const o=this.createDocumentFragmentForSync();for(;this.element.lastChild;)this.element.removeChild(this.element.lastChild);return this.element.appendChild(o),this.didSync()}didSync(){return this.elementStore.reset(Ci(this.element)),St((()=>this.garbageCollectCachedViews()))}createDocumentFragmentForSync(){const o=document.createDocumentFragment();return Array.from(this.shadowElement.childNodes).forEach((s=>{o.appendChild(s.cloneNode(!0))})),Array.from(Ci(o)).forEach((o=>{const s=this.elementStore.remove(o);s&&o.parentNode.replaceChild(s,o)})),o}}const Ci=o=>o.querySelectorAll("[data-trix-store-key]"),Ei=(o,s)=>Si(o.innerHTML)===Si(s.innerHTML),Si=o=>o.replace(/&nbsp;/g," ");function Ri(o){var s,a;function n(s,a){try{var l=o[s](a),c=l.value,h=c instanceof ki;Promise.resolve(h?c.v:c).then((function(a){if(h){var d="return"===s?"return":"next";if(!c.k||a.done)return n(d,a);a=o[d](a).value}r(l.done?"return":"normal",a)}),(function(o){n("throw",o)}))}catch(o){r("throw",o)}}function r(o,l){switch(o){case"return":s.resolve({value:l,done:!0});break;case"throw":s.reject(l);break;default:s.resolve({value:l,done:!1})}(s=s.next)?n(s.key,s.arg):a=null}this._invoke=function(o,l){return new Promise((function(c,h){var d={key:o,arg:l,resolve:c,reject:h,next:null};a?a=a.next=d:(s=a=d,n(o,l))}))},"function"!=typeof o.return&&(this.return=void 0)}function ki(o,s){this.v=o,this.k=s}function Ti(o,s,a){return(s=wi(s))in o?Object.defineProperty(o,s,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[s]=a,o}function wi(o){var s=function(o,s){if("object"!=typeof o||null===o)return o;var a=o[Symbol.toPrimitive];if(void 0!==a){var l=a.call(o,s||"default");if("object"!=typeof l)return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(o)}(o,"string");return"symbol"==typeof s?s:String(s)}Ri.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},Ri.prototype.next=function(o){return this._invoke("next",o)},Ri.prototype.throw=function(o){return this._invoke("throw",o)},Ri.prototype.return=function(o){return this._invoke("return",o)};function Li(o,s){return Ii(o,Ni(o,s,"get"))}function Di(o,s,a){return Oi(o,Ni(o,s,"set"),a),a}function Ni(o,s,a){if(!s.has(o))throw new TypeError("attempted to "+a+" private field on non-instance");return s.get(o)}function Ii(o,s){return s.get?s.get.call(o):s.value}function Oi(o,s,a){if(s.set)s.set.call(o,a);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=a}}function Pi(o,s,a){if(!s.has(o))throw new TypeError("attempted to get private field on non-instance");return a}function Fi(o,s){if(s.has(o))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Mi(o,s,a){Fi(o,s),s.set(o,a)}class Bi extends nt{static registerType(o,s){s.type=o,this.types[o]=s}static fromJSON(o){const s=this.types[o.type];if(s)return s.fromJSON(o)}constructor(o){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(...arguments),this.attributes=qt.box(s)}copyWithAttributes(o){return new this.constructor(this.getValue(),o)}copyWithAdditionalAttributes(o){return this.copyWithAttributes(this.attributes.merge(o))}copyWithoutAttribute(o){return this.copyWithAttributes(this.attributes.remove(o))}copy(){return this.copyWithAttributes(this.attributes)}getAttribute(o){return this.attributes.get(o)}getAttributesHash(){return this.attributes}getAttributes(){return this.attributes.toObject()}hasAttribute(o){return this.attributes.has(o)}hasSameStringValueAsPiece(o){return o&&this.toString()===o.toString()}hasSameAttributesAsPiece(o){return o&&(this.attributes===o.attributes||this.attributes.isEqualTo(o.attributes))}isBlockBreak(){return!1}isEqualTo(o){return super.isEqualTo(...arguments)||this.hasSameConstructorAs(o)&&this.hasSameStringValueAsPiece(o)&&this.hasSameAttributesAsPiece(o)}isEmpty(){return 0===this.length}isSerializable(){return!0}toJSON(){return{type:this.constructor.type,attributes:this.getAttributes()}}contentsForInspection(){return{type:this.constructor.type,attributes:this.attributes.inspect()}}canBeGrouped(){return this.hasAttribute("href")}canBeGroupedWith(o){return this.getAttribute("href")===o.getAttribute("href")}getLength(){return this.length}canBeConsolidatedWith(o){return!1}}Ti(Bi,"types",{});class _i extends te{constructor(o){super(...arguments),this.url=o}perform(o){const s=new Image;s.onload=()=>(s.width=this.width=s.naturalWidth,s.height=this.height=s.naturalHeight,o(!0,s)),s.onerror=()=>o(!1),s.src=this.url}}class ji extends nt{static attachmentForFile(o){const s=new this(this.attributesForFile(o));return s.setFile(o),s}static attributesForFile(o){return new qt({filename:o.name,filesize:o.size,contentType:o.type})}static fromJSON(o){return new this(o)}constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(o),this.releaseFile=this.releaseFile.bind(this),this.attributes=qt.box(o),this.didChangeAttributes()}getAttribute(o){return this.attributes.get(o)}hasAttribute(o){return this.attributes.has(o)}getAttributes(){return this.attributes.toObject()}setAttributes(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=this.attributes.merge(o);var a,l,c,h;if(!this.attributes.isEqualTo(s))return this.attributes=s,this.didChangeAttributes(),null===(a=this.previewDelegate)||void 0===a||null===(l=a.attachmentDidChangeAttributes)||void 0===l||l.call(a,this),null===(c=this.delegate)||void 0===c||null===(h=c.attachmentDidChangeAttributes)||void 0===h?void 0:h.call(c,this)}didChangeAttributes(){if(this.isPreviewable())return this.preloadURL()}isPending(){return null!=this.file&&!(this.getURL()||this.getHref())}isPreviewable(){return this.attributes.has("previewable")?this.attributes.get("previewable"):ji.previewablePattern.test(this.getContentType())}getType(){return this.hasContent()?"content":this.isPreviewable()?"preview":"file"}getURL(){return this.attributes.get("url")}getHref(){return this.attributes.get("href")}getFilename(){return this.attributes.get("filename")||""}getFilesize(){return this.attributes.get("filesize")}getFormattedFilesize(){const o=this.attributes.get("filesize");return"number"==typeof o?T.formatter(o):""}getExtension(){var o;return null===(o=this.getFilename().match(/\.(\w+)$/))||void 0===o?void 0:o[1].toLowerCase()}getContentType(){return this.attributes.get("contentType")}hasContent(){return this.attributes.has("content")}getContent(){return this.attributes.get("content")}getWidth(){return this.attributes.get("width")}getHeight(){return this.attributes.get("height")}getFile(){return this.file}setFile(o){if(this.file=o,this.isPreviewable())return this.preloadFile()}releaseFile(){this.releasePreloadedFile(),this.file=null}getUploadProgress(){return null!=this.uploadProgress?this.uploadProgress:0}setUploadProgress(o){var s,a;if(this.uploadProgress!==o)return this.uploadProgress=o,null===(s=this.uploadProgressDelegate)||void 0===s||null===(a=s.attachmentDidChangeUploadProgress)||void 0===a?void 0:a.call(s,this)}toJSON(){return this.getAttributes()}getCacheKey(){return[super.getCacheKey(...arguments),this.attributes.getCacheKey(),this.getPreviewURL()].join("/")}getPreviewURL(){return this.previewURL||this.preloadingURL}setPreviewURL(o){var s,a,l,c;if(o!==this.getPreviewURL())return this.previewURL=o,null===(s=this.previewDelegate)||void 0===s||null===(a=s.attachmentDidChangeAttributes)||void 0===a||a.call(s,this),null===(l=this.delegate)||void 0===l||null===(c=l.attachmentDidChangePreviewURL)||void 0===c?void 0:c.call(l,this)}preloadURL(){return this.preload(this.getURL(),this.releaseFile)}preloadFile(){if(this.file)return this.fileObjectURL=URL.createObjectURL(this.file),this.preload(this.fileObjectURL)}releasePreloadedFile(){this.fileObjectURL&&(URL.revokeObjectURL(this.fileObjectURL),this.fileObjectURL=null)}preload(o,s){if(o&&o!==this.getPreviewURL()){this.preloadingURL=o;return new _i(o).then((a=>{let{width:l,height:c}=a;return this.getWidth()&&this.getHeight()||this.setAttributes({width:l,height:c}),this.preloadingURL=null,this.setPreviewURL(o),null==s?void 0:s()})).catch((()=>(this.preloadingURL=null,null==s?void 0:s())))}}}Ti(ji,"previewablePattern",/^image(\/(gif|png|webp|jpe?g)|$)/);class Wi extends Bi{static fromJSON(o){return new this(ji.fromJSON(o.attachment),o.attributes)}constructor(o){super(...arguments),this.attachment=o,this.length=1,this.ensureAttachmentExclusivelyHasAttribute("href"),this.attachment.hasContent()||this.removeProhibitedAttributes()}ensureAttachmentExclusivelyHasAttribute(o){this.hasAttribute(o)&&(this.attachment.hasAttribute(o)||this.attachment.setAttributes(this.attributes.slice([o])),this.attributes=this.attributes.remove(o))}removeProhibitedAttributes(){const o=this.attributes.slice(Wi.permittedAttributes);o.isEqualTo(this.attributes)||(this.attributes=o)}getValue(){return this.attachment}isSerializable(){return!this.attachment.isPending()}getCaption(){return this.attributes.get("caption")||""}isEqualTo(o){var s;return super.isEqualTo(o)&&this.attachment.id===(null==o||null===(s=o.attachment)||void 0===s?void 0:s.id)}toString(){return"ï¿¼"}toJSON(){const o=super.toJSON(...arguments);return o.attachment=this.attachment,o}getCacheKey(){return[super.getCacheKey(...arguments),this.attachment.getCacheKey()].join("/")}toConsole(){return JSON.stringify(this.toString())}}Ti(Wi,"permittedAttributes",["caption","presentation"]),Bi.registerType("attachment",Wi);class Ui extends Bi{static fromJSON(o){return new this(o.string,o.attributes)}constructor(o){super(...arguments),this.string=(o=>o.replace(/\r\n?/g,"\n"))(o),this.length=this.string.length}getValue(){return this.string}toString(){return this.string.toString()}isBlockBreak(){return"\n"===this.toString()&&!0===this.getAttribute("blockBreak")}toJSON(){const o=super.toJSON(...arguments);return o.string=this.string,o}canBeConsolidatedWith(o){return o&&this.hasSameConstructorAs(o)&&this.hasSameAttributesAsPiece(o)}consolidateWith(o){return new this.constructor(this.toString()+o.toString(),this.attributes)}splitAtOffset(o){let s,a;return 0===o?(s=null,a=this):o===this.length?(s=this,a=null):(s=new this.constructor(this.string.slice(0,o),this.attributes),a=new this.constructor(this.string.slice(o),this.attributes)),[s,a]}toConsole(){let{string:o}=this;return o.length>15&&(o=o.slice(0,14)+"â€¦"),JSON.stringify(o.toString())}}Bi.registerType("string",Ui);class Vi extends nt{static box(o){return o instanceof this?o:new this(o)}constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(...arguments),this.objects=o.slice(0),this.length=this.objects.length}indexOf(o){return this.objects.indexOf(o)}splice(){for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return new this.constructor(ot(this.objects,...s))}eachObject(o){return this.objects.map(((s,a)=>o(s,a)))}insertObjectAtIndex(o,s){return this.splice(s,0,o)}insertSplittableListAtIndex(o,s){return this.splice(s,0,...o.objects)}insertSplittableListAtPosition(o,s){const[a,l]=this.splitObjectAtPosition(s);return new this.constructor(a).insertSplittableListAtIndex(o,l)}editObjectAtIndex(o,s){return this.replaceObjectAtIndex(s(this.objects[o]),o)}replaceObjectAtIndex(o,s){return this.splice(s,1,o)}removeObjectAtIndex(o){return this.splice(o,1)}getObjectAtIndex(o){return this.objects[o]}getSplittableListInRange(o){const[s,a,l]=this.splitObjectsAtRange(o);return new this.constructor(s.slice(a,l+1))}selectSplittableList(o){const s=this.objects.filter((s=>o(s)));return new this.constructor(s)}removeObjectsInRange(o){const[s,a,l]=this.splitObjectsAtRange(o);return new this.constructor(s).splice(a,l-a+1)}transformObjectsInRange(o,s){const[a,l,c]=this.splitObjectsAtRange(o),h=a.map(((o,a)=>l<=a&&a<=c?s(o):o));return new this.constructor(h)}splitObjectsAtRange(o){let s,[a,l,c]=this.splitObjectAtPosition(qi(o));return[a,s]=new this.constructor(a).splitObjectAtPosition(Hi(o)+c),[a,l,s-1]}getObjectAtPosition(o){const{index:s}=this.findIndexAndOffsetAtPosition(o);return this.objects[s]}splitObjectAtPosition(o){let s,a;const{index:l,offset:c}=this.findIndexAndOffsetAtPosition(o),h=this.objects.slice(0);if(null!=l)if(0===c)s=l,a=0;else{const o=this.getObjectAtIndex(l),[d,m]=o.splitAtOffset(c);h.splice(l,1,d,m),s=l+1,a=d.getLength()-c}else s=h.length,a=0;return[h,s,a]}consolidate(){const o=[];let s=this.objects[0];return this.objects.slice(1).forEach((a=>{var l,c;null!==(l=(c=s).canBeConsolidatedWith)&&void 0!==l&&l.call(c,a)?s=s.consolidateWith(a):(o.push(s),s=a)})),s&&o.push(s),new this.constructor(o)}consolidateFromIndexToIndex(o,s){const a=this.objects.slice(0).slice(o,s+1),l=new this.constructor(a).consolidate().toArray();return this.splice(o,a.length,...l)}findIndexAndOffsetAtPosition(o){let s,a=0;for(s=0;s<this.objects.length;s++){const l=a+this.objects[s].getLength();if(a<=o&&o<l)return{index:s,offset:o-a};a=l}return{index:null,offset:null}}findPositionAtIndexAndOffset(o,s){let a=0;for(let l=0;l<this.objects.length;l++){const c=this.objects[l];if(l<o)a+=c.getLength();else if(l===o){a+=s;break}}return a}getEndPosition(){return null==this.endPosition&&(this.endPosition=0,this.objects.forEach((o=>this.endPosition+=o.getLength()))),this.endPosition}toString(){return this.objects.join("")}toArray(){return this.objects.slice(0)}toJSON(){return this.toArray()}isEqualTo(o){return super.isEqualTo(...arguments)||zi(this.objects,null==o?void 0:o.objects)}contentsForInspection(){return{objects:"[".concat(this.objects.map((o=>o.inspect())).join(", "),"]")}}}const zi=function(o){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(o.length!==s.length)return!1;let a=!0;for(let l=0;l<o.length;l++){const c=o[l];a&&!c.isEqualTo(s[l])&&(a=!1)}return a},qi=o=>o[0],Hi=o=>o[1];class Ji extends nt{static textForAttachmentWithAttributes(o,s){return new this([new Wi(o,s)])}static textForStringWithAttributes(o,s){return new this([new Ui(o,s)])}static fromJSON(o){return new this(Array.from(o).map((o=>Bi.fromJSON(o))))}constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(...arguments);const s=o.filter((o=>!o.isEmpty()));this.pieceList=new Vi(s)}copy(){return this.copyWithPieceList(this.pieceList)}copyWithPieceList(o){return new this.constructor(o.consolidate().toArray())}copyUsingObjectMap(o){const s=this.getPieces().map((s=>o.find(s)||s));return new this.constructor(s)}appendText(o){return this.insertTextAtPosition(o,this.getLength())}insertTextAtPosition(o,s){return this.copyWithPieceList(this.pieceList.insertSplittableListAtPosition(o.pieceList,s))}removeTextAtRange(o){return this.copyWithPieceList(this.pieceList.removeObjectsInRange(o))}replaceTextAtRange(o,s){return this.removeTextAtRange(s).insertTextAtPosition(o,s[0])}moveTextFromRangeToPosition(o,s){if(o[0]<=s&&s<=o[1])return;const a=this.getTextAtRange(o),l=a.getLength();return o[0]<s&&(s-=l),this.removeTextAtRange(o).insertTextAtPosition(a,s)}addAttributeAtRange(o,s,a){const l={};return l[o]=s,this.addAttributesAtRange(l,a)}addAttributesAtRange(o,s){return this.copyWithPieceList(this.pieceList.transformObjectsInRange(s,(s=>s.copyWithAdditionalAttributes(o))))}removeAttributeAtRange(o,s){return this.copyWithPieceList(this.pieceList.transformObjectsInRange(s,(s=>s.copyWithoutAttribute(o))))}setAttributesAtRange(o,s){return this.copyWithPieceList(this.pieceList.transformObjectsInRange(s,(s=>s.copyWithAttributes(o))))}getAttributesAtPosition(o){var s;return(null===(s=this.pieceList.getObjectAtPosition(o))||void 0===s?void 0:s.getAttributes())||{}}getCommonAttributes(){const o=Array.from(this.pieceList.toArray()).map((o=>o.getAttributes()));return qt.fromCommonAttributesOfObjects(o).toObject()}getCommonAttributesAtRange(o){return this.getTextAtRange(o).getCommonAttributes()||{}}getExpandedRangeForAttributeAtOffset(o,s){let a,l=a=s;const c=this.getLength();for(;l>0&&this.getCommonAttributesAtRange([l-1,a])[o];)l--;for(;a<c&&this.getCommonAttributesAtRange([s,a+1])[o];)a++;return[l,a]}getTextAtRange(o){return this.copyWithPieceList(this.pieceList.getSplittableListInRange(o))}getStringAtRange(o){return this.pieceList.getSplittableListInRange(o).toString()}getStringAtPosition(o){return this.getStringAtRange([o,o+1])}startsWithString(o){return this.getStringAtRange([0,o.length])===o}endsWithString(o){const s=this.getLength();return this.getStringAtRange([s-o.length,s])===o}getAttachmentPieces(){return this.pieceList.toArray().filter((o=>!!o.attachment))}getAttachments(){return this.getAttachmentPieces().map((o=>o.attachment))}getAttachmentAndPositionById(o){let s=0;for(const l of this.pieceList.toArray()){var a;if((null===(a=l.attachment)||void 0===a?void 0:a.id)===o)return{attachment:l.attachment,position:s};s+=l.length}return{attachment:null,position:null}}getAttachmentById(o){const{attachment:s}=this.getAttachmentAndPositionById(o);return s}getRangeOfAttachment(o){const s=this.getAttachmentAndPositionById(o.id),a=s.position;if(o=s.attachment)return[a,a+1]}updateAttributesForAttachment(o,s){const a=this.getRangeOfAttachment(s);return a?this.addAttributesAtRange(o,a):this}getLength(){return this.pieceList.getEndPosition()}isEmpty(){return 0===this.getLength()}isEqualTo(o){var s;return super.isEqualTo(o)||(null==o||null===(s=o.pieceList)||void 0===s?void 0:s.isEqualTo(this.pieceList))}isBlockBreak(){return 1===this.getLength()&&this.pieceList.getObjectAtIndex(0).isBlockBreak()}eachPiece(o){return this.pieceList.eachObject(o)}getPieces(){return this.pieceList.toArray()}getPieceAtPosition(o){return this.pieceList.getObjectAtPosition(o)}contentsForInspection(){return{pieceList:this.pieceList.inspect()}}toSerializableText(){const o=this.pieceList.selectSplittableList((o=>o.isSerializable()));return this.copyWithPieceList(o)}toString(){return this.pieceList.toString()}toJSON(){return this.pieceList.toJSON()}toConsole(){return JSON.stringify(this.pieceList.toArray().map((o=>JSON.parse(o.toConsole()))))}getDirection(){return xt(this.toString())}isRTL(){return"rtl"===this.getDirection()}}class Ki extends nt{static fromJSON(o){return new this(Ji.fromJSON(o.text),o.attributes,o.htmlAttributes)}constructor(o,s,a){super(...arguments),this.text=Gi(o||new Ji),this.attributes=s||[],this.htmlAttributes=a||{}}isEmpty(){return this.text.isBlockBreak()}isEqualTo(o){return!!super.isEqualTo(o)||this.text.isEqualTo(null==o?void 0:o.text)&&rt(this.attributes,null==o?void 0:o.attributes)&&kt(this.htmlAttributes,null==o?void 0:o.htmlAttributes)}copyWithText(o){return new Ki(o,this.attributes,this.htmlAttributes)}copyWithoutText(){return this.copyWithText(null)}copyWithAttributes(o){return new Ki(this.text,o,this.htmlAttributes)}copyWithoutAttributes(){return this.copyWithAttributes(null)}copyUsingObjectMap(o){const s=o.find(this.text);return s?this.copyWithText(s):this.copyWithText(this.text.copyUsingObjectMap(o))}addAttribute(o){const s=this.attributes.concat(tn(o));return this.copyWithAttributes(s)}addHTMLAttribute(o,s){const a=Object.assign({},this.htmlAttributes,{[o]:s});return new Ki(this.text,this.attributes,a)}removeAttribute(o){const{listAttribute:s}=gt(o),a=nn(nn(this.attributes,o),s);return this.copyWithAttributes(a)}removeLastAttribute(){return this.removeAttribute(this.getLastAttribute())}getLastAttribute(){return en(this.attributes)}getAttributes(){return this.attributes.slice(0)}getAttributeLevel(){return this.attributes.length}getAttributeAtLevel(o){return this.attributes[o-1]}hasAttribute(o){return this.attributes.includes(o)}hasAttributes(){return this.getAttributeLevel()>0}getLastNestableAttribute(){return en(this.getNestableAttributes())}getNestableAttributes(){return this.attributes.filter((o=>gt(o).nestable))}getNestingLevel(){return this.getNestableAttributes().length}decreaseNestingLevel(){const o=this.getLastNestableAttribute();return o?this.removeAttribute(o):this}increaseNestingLevel(){const o=this.getLastNestableAttribute();if(o){const s=this.attributes.lastIndexOf(o),a=ot(this.attributes,s+1,0,...tn(o));return this.copyWithAttributes(a)}return this}getListItemAttributes(){return this.attributes.filter((o=>gt(o).listAttribute))}isListItem(){var o;return null===(o=gt(this.getLastAttribute()))||void 0===o?void 0:o.listAttribute}isTerminalBlock(){var o;return null===(o=gt(this.getLastAttribute()))||void 0===o?void 0:o.terminal}breaksOnReturn(){var o;return null===(o=gt(this.getLastAttribute()))||void 0===o?void 0:o.breakOnReturn}findLineBreakInDirectionFromPosition(o,s){const a=this.toString();let l;switch(o){case"forward":l=a.indexOf("\n",s);break;case"backward":l=a.slice(0,s).lastIndexOf("\n")}if(-1!==l)return l}contentsForInspection(){return{text:this.text.inspect(),attributes:this.attributes}}toString(){return this.text.toString()}toJSON(){return{text:this.text,attributes:this.attributes,htmlAttributes:this.htmlAttributes}}getDirection(){return this.text.getDirection()}isRTL(){return this.text.isRTL()}getLength(){return this.text.getLength()}canBeConsolidatedWith(o){return!this.hasAttributes()&&!o.hasAttributes()&&this.getDirection()===o.getDirection()}consolidateWith(o){const s=Ji.textForStringWithAttributes("\n"),a=this.getTextWithoutBlockBreak().appendText(s);return this.copyWithText(a.appendText(o.text))}splitAtOffset(o){let s,a;return 0===o?(s=null,a=this):o===this.getLength()?(s=this,a=null):(s=this.copyWithText(this.text.getTextAtRange([0,o])),a=this.copyWithText(this.text.getTextAtRange([o,this.getLength()]))),[s,a]}getBlockBreakPosition(){return this.text.getLength()-1}getTextWithoutBlockBreak(){return Zi(this.text)?this.text.getTextAtRange([0,this.getBlockBreakPosition()]):this.text.copy()}canBeGrouped(o){return this.attributes[o]}canBeGroupedWith(o,s){const a=o.getAttributes(),c=a[s],h=this.attributes[s];return h===c&&!(!1===gt(h).group&&!(()=>{if(!oe){oe=[];for(const o in l){const{listAttribute:s}=l[o];null!=s&&oe.push(s)}}return oe})().includes(a[s+1]))&&(this.getDirection()===o.getDirection()||o.isEmpty())}}const Gi=function(o){return o=Yi(o),Xi(o)},Yi=function(o){let s=!1;const a=o.getPieces();let l=a.slice(0,a.length-1);const c=a[a.length-1];return c?(l=l.map((o=>o.isBlockBreak()?(s=!0,Qi(o)):o)),s?new Ji([...l,c]):o):o},wn=Ji.textForStringWithAttributes("\n",{blockBreak:!0}),Xi=function(o){return Zi(o)?o:o.appendText(wn)},Zi=function(o){const s=o.getLength();return 0!==s&&o.getTextAtRange([s-1,s]).isBlockBreak()},Qi=o=>o.copyWithoutAttribute("blockBreak"),tn=function(o){const{listAttribute:s}=gt(o);return s?[s,o]:[o]},en=o=>o.slice(-1)[0],nn=function(o,s){const a=o.lastIndexOf(s);return-1===a?o:ot(o,a,1)};class rn extends nt{static fromJSON(o){return new this(Array.from(o).map((o=>Ki.fromJSON(o))))}static fromString(o,s){const a=Ji.textForStringWithAttributes(o,s);return new this([new Ki(a)])}constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(...arguments),0===o.length&&(o=[new Ki]),this.blockList=Vi.box(o)}isEmpty(){const o=this.getBlockAtIndex(0);return 1===this.blockList.length&&o.isEmpty()&&!o.hasAttributes()}copy(){const o=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).consolidateBlocks?this.blockList.consolidate().toArray():this.blockList.toArray();return new this.constructor(o)}copyUsingObjectsFromDocument(o){const s=new Xt(o.getObjects());return this.copyUsingObjectMap(s)}copyUsingObjectMap(o){const s=this.getBlocks().map((s=>o.find(s)||s.copyUsingObjectMap(o)));return new this.constructor(s)}copyWithBaseBlockAttributes(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const s=this.getBlocks().map((s=>{const a=o.concat(s.getAttributes());return s.copyWithAttributes(a)}));return new this.constructor(s)}replaceBlock(o,s){const a=this.blockList.indexOf(o);return-1===a?this:new this.constructor(this.blockList.replaceObjectAtIndex(s,a))}insertDocumentAtRange(o,s){const{blockList:a}=o;s=Tt(s);let[l]=s;const{index:c,offset:h}=this.locationFromPosition(l);let d=this;const m=this.getBlockAtPosition(l);return wt(s)&&m.isEmpty()&&!m.hasAttributes()?d=new this.constructor(d.blockList.removeObjectAtIndex(c)):m.getBlockBreakPosition()===h&&l++,d=d.removeTextAtRange(s),new this.constructor(d.blockList.insertSplittableListAtPosition(a,l))}mergeDocumentAtRange(o,s){let a,l;s=Tt(s);const[c]=s,h=this.locationFromPosition(c),d=this.getBlockAtIndex(h.index).getAttributes(),m=o.getBaseBlockAttributes(),p=d.slice(-m.length);if(rt(m,p)){const s=d.slice(0,-m.length);a=o.copyWithBaseBlockAttributes(s)}else a=o.copy({consolidateBlocks:!0}).copyWithBaseBlockAttributes(d);const T=a.getBlockCount(),B=a.getBlockAtIndex(0);if(rt(d,B.getAttributes())){const o=B.getTextWithoutBlockBreak();if(l=this.insertTextAtRange(o,s),T>1){a=new this.constructor(a.getBlocks().slice(1));const s=c+o.getLength();l=l.insertDocumentAtRange(a,s)}}else l=this.insertDocumentAtRange(a,s);return l}insertTextAtRange(o,s){s=Tt(s);const[a]=s,{index:l,offset:c}=this.locationFromPosition(a),h=this.removeTextAtRange(s);return new this.constructor(h.blockList.editObjectAtIndex(l,(s=>s.copyWithText(s.text.insertTextAtPosition(o,c)))))}removeTextAtRange(o){let s;o=Tt(o);const[a,l]=o;if(wt(o))return this;const[c,h]=Array.from(this.locationRangeFromRange(o)),d=c.index,m=c.offset,p=this.getBlockAtIndex(d),T=h.index,B=h.offset,j=this.getBlockAtIndex(T);if(l-a==1&&p.getBlockBreakPosition()===m&&j.getBlockBreakPosition()!==B&&"\n"===j.text.getStringAtPosition(B))s=this.blockList.editObjectAtIndex(T,(o=>o.copyWithText(o.text.removeTextAtRange([B,B+1]))));else{let o;const a=p.text.getTextAtRange([0,m]),l=j.text.getTextAtRange([B,j.getLength()]),c=a.appendText(l);o=d!==T&&0===m&&p.getAttributeLevel()>=j.getAttributeLevel()?j.copyWithText(c):p.copyWithText(c);const h=T+1-d;s=this.blockList.splice(d,h,o)}return new this.constructor(s)}moveTextFromRangeToPosition(o,s){let a;o=Tt(o);const[l,c]=o;if(l<=s&&s<=c)return this;let h=this.getDocumentAtRange(o),d=this.removeTextAtRange(o);const m=l<s;m&&(s-=h.getLength());const[p,...T]=h.getBlocks();return 0===T.length?(a=p.getTextWithoutBlockBreak(),m&&(s+=1)):a=p.text,d=d.insertTextAtRange(a,s),0===T.length?d:(h=new this.constructor(T),s+=a.getLength(),d.insertDocumentAtRange(h,s))}addAttributeAtRange(o,s,a){let{blockList:l}=this;return this.eachBlockAtRange(a,((a,c,h)=>l=l.editObjectAtIndex(h,(function(){return gt(o)?a.addAttribute(o,s):c[0]===c[1]?a:a.copyWithText(a.text.addAttributeAtRange(o,s,c))})))),new this.constructor(l)}addAttribute(o,s){let{blockList:a}=this;return this.eachBlock(((l,c)=>a=a.editObjectAtIndex(c,(()=>l.addAttribute(o,s))))),new this.constructor(a)}removeAttributeAtRange(o,s){let{blockList:a}=this;return this.eachBlockAtRange(s,(function(s,l,c){gt(o)?a=a.editObjectAtIndex(c,(()=>s.removeAttribute(o))):l[0]!==l[1]&&(a=a.editObjectAtIndex(c,(()=>s.copyWithText(s.text.removeAttributeAtRange(o,l)))))})),new this.constructor(a)}updateAttributesForAttachment(o,s){const a=this.getRangeOfAttachment(s),[l]=Array.from(a),{index:c}=this.locationFromPosition(l),h=this.getTextAtIndex(c);return new this.constructor(this.blockList.editObjectAtIndex(c,(a=>a.copyWithText(h.updateAttributesForAttachment(o,s)))))}removeAttributeForAttachment(o,s){const a=this.getRangeOfAttachment(s);return this.removeAttributeAtRange(o,a)}setHTMLAttributeAtPosition(o,s,a){const l=this.getBlockAtPosition(o),c=l.addHTMLAttribute(s,a);return this.replaceBlock(l,c)}insertBlockBreakAtRange(o){let s;o=Tt(o);const[a]=o,{offset:l}=this.locationFromPosition(a),c=this.removeTextAtRange(o);return 0===l&&(s=[new Ki]),new this.constructor(c.blockList.insertSplittableListAtPosition(new Vi(s),a))}applyBlockAttributeAtRange(o,s,a){const l=this.expandRangeToLineBreaksAndSplitBlocks(a);let c=l.document;a=l.range;const h=gt(o);if(h.listAttribute){c=c.removeLastListAttributeAtRange(a,{exceptAttributeName:o});const s=c.convertLineBreaksToBlockBreaksInRange(a);c=s.document,a=s.range}else c=h.exclusive?c.removeBlockAttributesAtRange(a):h.terminal?c.removeLastTerminalAttributeAtRange(a):c.consolidateBlocksAtRange(a);return c.addAttributeAtRange(o,s,a)}removeLastListAttributeAtRange(o){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{blockList:a}=this;return this.eachBlockAtRange(o,(function(o,l,c){const h=o.getLastAttribute();h&&gt(h).listAttribute&&h!==s.exceptAttributeName&&(a=a.editObjectAtIndex(c,(()=>o.removeAttribute(h))))})),new this.constructor(a)}removeLastTerminalAttributeAtRange(o){let{blockList:s}=this;return this.eachBlockAtRange(o,(function(o,a,l){const c=o.getLastAttribute();c&&gt(c).terminal&&(s=s.editObjectAtIndex(l,(()=>o.removeAttribute(c))))})),new this.constructor(s)}removeBlockAttributesAtRange(o){let{blockList:s}=this;return this.eachBlockAtRange(o,(function(o,a,l){o.hasAttributes()&&(s=s.editObjectAtIndex(l,(()=>o.copyWithoutAttributes())))})),new this.constructor(s)}expandRangeToLineBreaksAndSplitBlocks(o){let s;o=Tt(o);let[a,l]=o;const c=this.locationFromPosition(a),h=this.locationFromPosition(l);let d=this;const m=d.getBlockAtIndex(c.index);if(c.offset=m.findLineBreakInDirectionFromPosition("backward",c.offset),null!=c.offset&&(s=d.positionFromLocation(c),d=d.insertBlockBreakAtRange([s,s+1]),h.index+=1,h.offset-=d.getBlockAtIndex(c.index).getLength(),c.index+=1),c.offset=0,0===h.offset&&h.index>c.index)h.index-=1,h.offset=d.getBlockAtIndex(h.index).getBlockBreakPosition();else{const o=d.getBlockAtIndex(h.index);"\n"===o.text.getStringAtRange([h.offset-1,h.offset])?h.offset-=1:h.offset=o.findLineBreakInDirectionFromPosition("forward",h.offset),h.offset!==o.getBlockBreakPosition()&&(s=d.positionFromLocation(h),d=d.insertBlockBreakAtRange([s,s+1]))}return a=d.positionFromLocation(c),l=d.positionFromLocation(h),{document:d,range:o=Tt([a,l])}}convertLineBreaksToBlockBreaksInRange(o){o=Tt(o);let[s]=o;const a=this.getStringAtRange(o).slice(0,-1);let l=this;return a.replace(/.*?\n/g,(function(o){s+=o.length,l=l.insertBlockBreakAtRange([s-1,s])})),{document:l,range:o}}consolidateBlocksAtRange(o){o=Tt(o);const[s,a]=o,l=this.locationFromPosition(s).index,c=this.locationFromPosition(a).index;return new this.constructor(this.blockList.consolidateFromIndexToIndex(l,c))}getDocumentAtRange(o){o=Tt(o);const s=this.blockList.getSplittableListInRange(o).toArray();return new this.constructor(s)}getStringAtRange(o){let s;const a=o=Tt(o);return a[a.length-1]!==this.getLength()&&(s=-1),this.getDocumentAtRange(o).toString().slice(0,s)}getBlockAtIndex(o){return this.blockList.getObjectAtIndex(o)}getBlockAtPosition(o){const{index:s}=this.locationFromPosition(o);return this.getBlockAtIndex(s)}getTextAtIndex(o){var s;return null===(s=this.getBlockAtIndex(o))||void 0===s?void 0:s.text}getTextAtPosition(o){const{index:s}=this.locationFromPosition(o);return this.getTextAtIndex(s)}getPieceAtPosition(o){const{index:s,offset:a}=this.locationFromPosition(o);return this.getTextAtIndex(s).getPieceAtPosition(a)}getCharacterAtPosition(o){const{index:s,offset:a}=this.locationFromPosition(o);return this.getTextAtIndex(s).getStringAtRange([a,a+1])}getLength(){return this.blockList.getEndPosition()}getBlocks(){return this.blockList.toArray()}getBlockCount(){return this.blockList.length}getEditCount(){return this.editCount}eachBlock(o){return this.blockList.eachObject(o)}eachBlockAtRange(o,s){let a,l;o=Tt(o);const[c,h]=o,d=this.locationFromPosition(c),m=this.locationFromPosition(h);if(d.index===m.index)return a=this.getBlockAtIndex(d.index),l=[d.offset,m.offset],s(a,l,d.index);for(let o=d.index;o<=m.index;o++)if(a=this.getBlockAtIndex(o),a){switch(o){case d.index:l=[d.offset,a.text.getLength()];break;case m.index:l=[0,m.offset];break;default:l=[0,a.text.getLength()]}s(a,l,o)}}getCommonAttributesAtRange(o){o=Tt(o);const[s]=o;if(wt(o))return this.getCommonAttributesAtPosition(s);{const s=[],a=[];return this.eachBlockAtRange(o,(function(o,l){if(l[0]!==l[1])return s.push(o.text.getCommonAttributesAtRange(l)),a.push(on(o))})),qt.fromCommonAttributesOfObjects(s).merge(qt.fromCommonAttributesOfObjects(a)).toObject()}}getCommonAttributesAtPosition(o){let s,a;const{index:l,offset:c}=this.locationFromPosition(o),h=this.getBlockAtIndex(l);if(!h)return{};const d=on(h),m=h.text.getAttributesAtPosition(c),p=h.text.getAttributesAtPosition(c-1),T=Object.keys(J).filter((o=>J[o].inheritable));for(s in p)a=p[s],(a===m[s]||T.includes(s))&&(d[s]=a);return d}getRangeOfCommonAttributeAtPosition(o,s){const{index:a,offset:l}=this.locationFromPosition(s),c=this.getTextAtIndex(a),[h,d]=Array.from(c.getExpandedRangeForAttributeAtOffset(o,l)),m=this.positionFromLocation({index:a,offset:h}),p=this.positionFromLocation({index:a,offset:d});return Tt([m,p])}getBaseBlockAttributes(){let o=this.getBlockAtIndex(0).getAttributes();for(let s=1;s<this.getBlockCount();s++){const a=this.getBlockAtIndex(s).getAttributes(),l=Math.min(o.length,a.length);o=(()=>{const s=[];for(let c=0;c<l&&a[c]===o[c];c++)s.push(a[c]);return s})()}return o}getAttachmentById(o){for(const s of this.getAttachments())if(s.id===o)return s}getAttachmentPieces(){let o=[];return this.blockList.eachObject((s=>{let{text:a}=s;return o=o.concat(a.getAttachmentPieces())})),o}getAttachments(){return this.getAttachmentPieces().map((o=>o.attachment))}getRangeOfAttachment(o){let s=0;const a=this.blockList.toArray();for(let l=0;l<a.length;l++){const{text:c}=a[l],h=c.getRangeOfAttachment(o);if(h)return Tt([s+h[0],s+h[1]]);s+=c.getLength()}}getLocationRangeOfAttachment(o){const s=this.getRangeOfAttachment(o);return this.locationRangeFromRange(s)}getAttachmentPieceForAttachment(o){for(const s of this.getAttachmentPieces())if(s.attachment===o)return s}findRangesForBlockAttribute(o){let s=0;const a=[];return this.getBlocks().forEach((l=>{const c=l.getLength();l.hasAttribute(o)&&a.push([s,s+c]),s+=c})),a}findRangesForTextAttribute(o){let{withValue:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=0,l=[];const c=[];return this.getPieces().forEach((h=>{const d=h.getLength();(function(a){return s?a.getAttribute(o)===s:a.hasAttribute(o)})(h)&&(l[1]===a?l[1]=a+d:c.push(l=[a,a+d])),a+=d})),c}locationFromPosition(o){const s=this.blockList.findIndexAndOffsetAtPosition(Math.max(0,o));if(null!=s.index)return s;{const o=this.getBlocks();return{index:o.length-1,offset:o[o.length-1].getLength()}}}positionFromLocation(o){return this.blockList.findPositionAtIndexAndOffset(o.index,o.offset)}locationRangeFromPosition(o){return Tt(this.locationFromPosition(o))}locationRangeFromRange(o){if(!(o=Tt(o)))return;const[s,a]=Array.from(o),l=this.locationFromPosition(s),c=this.locationFromPosition(a);return Tt([l,c])}rangeFromLocationRange(o){let s;o=Tt(o);const a=this.positionFromLocation(o[0]);return wt(o)||(s=this.positionFromLocation(o[1])),Tt([a,s])}isEqualTo(o){return this.blockList.isEqualTo(null==o?void 0:o.blockList)}getTexts(){return this.getBlocks().map((o=>o.text))}getPieces(){const o=[];return Array.from(this.getTexts()).forEach((s=>{o.push(...Array.from(s.getPieces()||[]))})),o}getObjects(){return this.getBlocks().concat(this.getTexts()).concat(this.getPieces())}toSerializableDocument(){const o=[];return this.blockList.eachObject((s=>o.push(s.copyWithText(s.text.toSerializableText())))),new this.constructor(o)}toString(){return this.blockList.toString()}toJSON(){return this.blockList.toJSON()}toConsole(){return JSON.stringify(this.blockList.toArray().map((o=>JSON.parse(o.text.toConsole()))))}}const on=function(o){const s={},a=o.getLastAttribute();return a&&(s[a]=!0),s},sn=function(o){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{string:o=jt(o),attributes:s,type:"string"}},an=(o,s)=>{try{return JSON.parse(o.getAttribute("data-trix-".concat(s)))}catch(o){return{}}};class ln extends z{static parse(o,s){const a=new this(o,s);return a.parse(),a}constructor(o){let{referenceElement:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(...arguments),this.html=o,this.referenceElement=s,this.blocks=[],this.blockElements=[],this.processedElements=[]}getDocument(){return rn.fromJSON(this.blocks)}parse(){try{this.createHiddenContainer(),ci.setHTML(this.containerElement,this.html);const o=S(this.containerElement,{usingFilter:dn});for(;o.nextNode();)this.processNode(o.currentNode);return this.translateBlockElementMarginsToNewlines()}finally{this.removeHiddenContainer()}}createHiddenContainer(){return this.referenceElement?(this.containerElement=this.referenceElement.cloneNode(!1),this.containerElement.removeAttribute("id"),this.containerElement.setAttribute("data-trix-internal",""),this.containerElement.style.display="none",this.referenceElement.parentNode.insertBefore(this.containerElement,this.referenceElement.nextSibling)):(this.containerElement=k({tagName:"div",style:{display:"none"}}),document.body.appendChild(this.containerElement))}removeHiddenContainer(){return E(this.containerElement)}processNode(o){switch(o.nodeType){case Node.TEXT_NODE:if(!this.isInsignificantTextNode(o))return this.appendBlockForTextNode(o),this.processTextNode(o);break;case Node.ELEMENT_NODE:return this.appendBlockForElement(o),this.processElement(o)}}appendBlockForTextNode(o){const s=o.parentNode;if(s===this.currentBlockElement&&this.isBlockElement(o.previousSibling))return this.appendStringWithAttributes("\n");if(s===this.containerElement||this.isBlockElement(s)){var a;const o=this.getBlockAttributes(s),l=this.getBlockHTMLAttributes(s);rt(o,null===(a=this.currentBlock)||void 0===a?void 0:a.attributes)||(this.currentBlock=this.appendBlockForAttributesWithElement(o,s,l),this.currentBlockElement=s)}}appendBlockForElement(o){const s=this.isBlockElement(o),a=x(this.currentBlockElement,o);if(s&&!this.isBlockElement(o.firstChild)){if(!this.isInsignificantTextNode(o.firstChild)||!this.isBlockElement(o.firstElementChild)){const s=this.getBlockAttributes(o),l=this.getBlockHTMLAttributes(o);if(o.firstChild){if(a&&rt(s,this.currentBlock.attributes))return this.appendStringWithAttributes("\n");this.currentBlock=this.appendBlockForAttributesWithElement(s,o,l),this.currentBlockElement=o}}}else if(this.currentBlockElement&&!a&&!s){const s=this.findParentBlockElement(o);if(s)return this.appendBlockForElement(s);this.currentBlock=this.appendEmptyBlock(),this.currentBlockElement=null}}findParentBlockElement(o){let{parentElement:s}=o;for(;s&&s!==this.containerElement;){if(this.isBlockElement(s)&&this.blockElements.includes(s))return s;s=s.parentElement}return null}processTextNode(o){let s=o.data;var a;cn(o.parentNode)||(s=Ut(s),pn(null===(a=o.previousSibling)||void 0===a?void 0:a.textContent)&&(s=gn(s)));return this.appendStringWithAttributes(s,this.getTextAttributes(o.parentNode))}processElement(o){let s;if(P(o)){if(s=an(o,"attachment"),Object.keys(s).length){const a=this.getTextAttributes(o);this.appendAttachmentWithAttributes(s,a),o.innerHTML=""}return this.processedElements.push(o)}switch(R(o)){case"br":return this.isExtraBR(o)||this.isBlockElement(o.nextSibling)||this.appendStringWithAttributes("\n",this.getTextAttributes(o)),this.processedElements.push(o);case"img":s={url:o.getAttribute("src"),contentType:"image"};const a=(o=>{const s=o.getAttribute("width"),a=o.getAttribute("height"),l={};return s&&(l.width=parseInt(s,10)),a&&(l.height=parseInt(a,10)),l})(o);for(const o in a){const l=a[o];s[o]=l}return this.appendAttachmentWithAttributes(s,this.getTextAttributes(o)),this.processedElements.push(o);case"tr":if(this.needsTableSeparator(o))return this.appendStringWithAttributes(H.tableRowSeparator);break;case"td":if(this.needsTableSeparator(o))return this.appendStringWithAttributes(H.tableCellSeparator)}}appendBlockForAttributesWithElement(o,s){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.blockElements.push(s);const l=function(){return{text:[],attributes:arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},htmlAttributes:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}}}(o,a);return this.blocks.push(l),l}appendEmptyBlock(){return this.appendBlockForAttributesWithElement([],null)}appendStringWithAttributes(o,s){return this.appendPiece(sn(o,s))}appendAttachmentWithAttributes(o,s){return this.appendPiece(function(o){return{attachment:o,attributes:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},type:"attachment"}}(o,s))}appendPiece(o){return 0===this.blocks.length&&this.appendEmptyBlock(),this.blocks[this.blocks.length-1].text.push(o)}appendStringToTextAtIndex(o,s){const{text:a}=this.blocks[s],l=a[a.length-1];if("string"!==(null==l?void 0:l.type))return a.push(sn(o));l.string+=o}prependStringToTextAtIndex(o,s){const{text:a}=this.blocks[s],l=a[0];if("string"!==(null==l?void 0:l.type))return a.unshift(sn(o));l.string=o+l.string}getTextAttributes(o){let s;const a={};for(const l in J){const c=J[l];if(c.tagName&&A(o,{matchingSelector:c.tagName,untilNode:this.containerElement}))a[l]=!0;else if(c.parser){if(s=c.parser(o),s){let h=!1;for(const a of this.findBlockElementAncestors(o))if(c.parser(a)===s){h=!0;break}h||(a[l]=s)}}else c.styleProperty&&(s=o.style[c.styleProperty],s&&(a[l]=s))}if(P(o)){const l=an(o,"attributes");for(const o in l)s=l[o],a[o]=s}return a}getBlockAttributes(o){const s=[];for(;o&&o!==this.containerElement;){for(const c in l){const h=l[c];var a;!1!==h.parse&&R(o)===h.tagName&&(null!==(a=h.test)&&void 0!==a&&a.call(h,o)||!h.test)&&(s.push(c),h.listAttribute&&s.push(h.listAttribute))}o=o.parentNode}return s.reverse()}getBlockHTMLAttributes(o){const s={},a=Object.values(l).find((s=>s.tagName===R(o)));return((null==a?void 0:a.htmlAttributes)||[]).forEach((a=>{o.hasAttribute(a)&&(s[a]=o.getAttribute(a))})),s}findBlockElementAncestors(o){const s=[];for(;o&&o!==this.containerElement;){const a=R(o);w().includes(a)&&s.push(o),o=o.parentNode}return s}isBlockElement(o){if((null==o?void 0:o.nodeType)===Node.ELEMENT_NODE&&!P(o)&&!A(o,{matchingSelector:"td",untilNode:this.containerElement}))return w().includes(R(o))||"block"===window.getComputedStyle(o).display}isInsignificantTextNode(o){if((null==o?void 0:o.nodeType)!==Node.TEXT_NODE)return;if(!mn(o.data))return;const{parentNode:s,previousSibling:a,nextSibling:l}=o;return un(s.previousSibling)&&!this.isBlockElement(s.previousSibling)||cn(s)?void 0:!a||this.isBlockElement(a)||!l||this.isBlockElement(l)}isExtraBR(o){return"br"===R(o)&&this.isBlockElement(o.parentNode)&&o.parentNode.lastChild===o}needsTableSeparator(o){if(H.removeBlankTableCells){var s;const a=null===(s=o.previousSibling)||void 0===s?void 0:s.textContent;return a&&/\S/.test(a)}return o.previousSibling}translateBlockElementMarginsToNewlines(){const o=this.getMarginOfDefaultBlockElement();for(let s=0;s<this.blocks.length;s++){const a=this.getMarginOfBlockElementAtIndex(s);a&&(a.top>2*o.top&&this.prependStringToTextAtIndex("\n",s),a.bottom>2*o.bottom&&this.appendStringToTextAtIndex("\n",s))}}getMarginOfBlockElementAtIndex(o){const s=this.blockElements[o];if(s&&s.textContent&&!w().includes(R(s))&&!this.processedElements.includes(s))return hn(s)}getMarginOfDefaultBlockElement(){const o=k(l.default.tagName);return this.containerElement.appendChild(o),hn(o)}}const cn=function(o){const{whiteSpace:s}=window.getComputedStyle(o);return["pre","pre-wrap","pre-line"].includes(s)},un=o=>o&&!pn(o.textContent),hn=function(o){const s=window.getComputedStyle(o);if("block"===s.display)return{top:parseInt(s.marginTop),bottom:parseInt(s.marginBottom)}},dn=function(o){return"style"===R(o)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT},gn=o=>o.replace(new RegExp("^".concat(ce.source,"+")),""),mn=o=>new RegExp("^".concat(ce.source,"*$")).test(o),pn=o=>/\s$/.test(o),Nn=["contenteditable","data-trix-id","data-trix-store-key","data-trix-mutable","data-trix-placeholder","tabindex"],Wn="data-trix-serialized-attributes",Un="[".concat(Wn,"]"),zn=new RegExp("\x3c!--block--\x3e","g"),Vn={"application/json":function(o){let s;if(o instanceof rn)s=o;else{if(!(o instanceof HTMLElement))throw new Error("unserializable object");s=ln.parse(o.innerHTML).getDocument()}return s.toSerializableDocument().toJSONString()},"text/html":function(o){let s;if(o instanceof rn)s=xi.render(o);else{if(!(o instanceof HTMLElement))throw new Error("unserializable object");s=o.cloneNode(!0)}return Array.from(s.querySelectorAll("[data-trix-serialize=false]")).forEach((o=>{E(o)})),Nn.forEach((o=>{Array.from(s.querySelectorAll("[".concat(o,"]"))).forEach((s=>{s.removeAttribute(o)}))})),Array.from(s.querySelectorAll(Un)).forEach((o=>{try{const s=JSON.parse(o.getAttribute(Wn));o.removeAttribute(Wn);for(const a in s){const l=s[a];o.setAttribute(a,l)}}catch(o){}})),s.innerHTML.replace(zn,"")}};var qn=Object.freeze({__proto__:null});class Cn extends z{constructor(o,s){super(...arguments),this.attachmentManager=o,this.attachment=s,this.id=this.attachment.id,this.file=this.attachment.file}remove(){return this.attachmentManager.requestRemovalOfAttachment(this.attachment)}}Cn.proxyMethod("attachment.getAttribute"),Cn.proxyMethod("attachment.hasAttribute"),Cn.proxyMethod("attachment.setAttribute"),Cn.proxyMethod("attachment.getAttributes"),Cn.proxyMethod("attachment.setAttributes"),Cn.proxyMethod("attachment.isPending"),Cn.proxyMethod("attachment.isPreviewable"),Cn.proxyMethod("attachment.getURL"),Cn.proxyMethod("attachment.getHref"),Cn.proxyMethod("attachment.getFilename"),Cn.proxyMethod("attachment.getFilesize"),Cn.proxyMethod("attachment.getFormattedFilesize"),Cn.proxyMethod("attachment.getExtension"),Cn.proxyMethod("attachment.getContentType"),Cn.proxyMethod("attachment.getFile"),Cn.proxyMethod("attachment.setFile"),Cn.proxyMethod("attachment.releaseFile"),Cn.proxyMethod("attachment.getUploadProgress"),Cn.proxyMethod("attachment.setUploadProgress");class En extends z{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(...arguments),this.managedAttachments={},Array.from(o).forEach((o=>{this.manageAttachment(o)}))}getAttachments(){const o=[];for(const s in this.managedAttachments){const a=this.managedAttachments[s];o.push(a)}return o}manageAttachment(o){return this.managedAttachments[o.id]||(this.managedAttachments[o.id]=new Cn(this,o)),this.managedAttachments[o.id]}attachmentIsManaged(o){return o.id in this.managedAttachments}requestRemovalOfAttachment(o){var s,a;if(this.attachmentIsManaged(o))return null===(s=this.delegate)||void 0===s||null===(a=s.attachmentManagerDidRequestRemovalOfAttachment)||void 0===a?void 0:a.call(s,o)}unmanageAttachment(o){const s=this.managedAttachments[o.id];return delete this.managedAttachments[o.id],s}}class Sn{constructor(o){this.composition=o,this.document=this.composition.document;const s=this.composition.getSelectedRange();this.startPosition=s[0],this.endPosition=s[1],this.startLocation=this.document.locationFromPosition(this.startPosition),this.endLocation=this.document.locationFromPosition(this.endPosition),this.block=this.document.getBlockAtIndex(this.endLocation.index),this.breaksOnReturn=this.block.breaksOnReturn(),this.previousCharacter=this.block.text.getStringAtPosition(this.endLocation.offset-1),this.nextCharacter=this.block.text.getStringAtPosition(this.endLocation.offset)}shouldInsertBlockBreak(){return this.block.hasAttributes()&&this.block.isListItem()&&!this.block.isEmpty()?0!==this.startLocation.offset:this.breaksOnReturn&&"\n"!==this.nextCharacter}shouldBreakFormattedBlock(){return this.block.hasAttributes()&&!this.block.isListItem()&&(this.breaksOnReturn&&"\n"===this.nextCharacter||"\n"===this.previousCharacter)}shouldDecreaseListLevel(){return this.block.hasAttributes()&&this.block.isListItem()&&this.block.isEmpty()}shouldPrependListItem(){return this.block.isListItem()&&0===this.startLocation.offset&&!this.block.isEmpty()}shouldRemoveLastBlockAttribute(){return this.block.hasAttributes()&&!this.block.isListItem()&&this.block.isEmpty()}}class Rn extends z{constructor(){super(...arguments),this.document=new rn,this.attachments=[],this.currentAttributes={},this.revision=0}setDocument(o){var s,a;if(!o.isEqualTo(this.document))return this.document=o,this.refreshAttachments(),this.revision++,null===(s=this.delegate)||void 0===s||null===(a=s.compositionDidChangeDocument)||void 0===a?void 0:a.call(s,o)}getSnapshot(){return{document:this.document,selectedRange:this.getSelectedRange()}}loadSnapshot(o){var s,a,l,c;let{document:h,selectedRange:d}=o;return null===(s=this.delegate)||void 0===s||null===(a=s.compositionWillLoadSnapshot)||void 0===a||a.call(s),this.setDocument(null!=h?h:new rn),this.setSelection(null!=d?d:[0,0]),null===(l=this.delegate)||void 0===l||null===(c=l.compositionDidLoadSnapshot)||void 0===c?void 0:c.call(l)}insertText(o){let{updatePosition:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{updatePosition:!0};const a=this.getSelectedRange();this.setDocument(this.document.insertTextAtRange(o,a));const l=a[0],c=l+o.getLength();return s&&this.setSelection(c),this.notifyDelegateOfInsertionAtRange([l,c])}insertBlock(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ki;const s=new rn([o]);return this.insertDocument(s)}insertDocument(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new rn;const s=this.getSelectedRange();this.setDocument(this.document.insertDocumentAtRange(o,s));const a=s[0],l=a+o.getLength();return this.setSelection(l),this.notifyDelegateOfInsertionAtRange([a,l])}insertString(o,s){const a=this.getCurrentTextAttributes(),l=Ji.textForStringWithAttributes(o,a);return this.insertText(l,s)}insertBlockBreak(){const o=this.getSelectedRange();this.setDocument(this.document.insertBlockBreakAtRange(o));const s=o[0],a=s+1;return this.setSelection(a),this.notifyDelegateOfInsertionAtRange([s,a])}insertLineBreak(){const o=new Sn(this);if(o.shouldDecreaseListLevel())return this.decreaseListLevel(),this.setSelection(o.startPosition);if(o.shouldPrependListItem()){const s=new rn([o.block.copyWithoutText()]);return this.insertDocument(s)}return o.shouldInsertBlockBreak()?this.insertBlockBreak():o.shouldRemoveLastBlockAttribute()?this.removeLastBlockAttribute():o.shouldBreakFormattedBlock()?this.breakFormattedBlock(o):this.insertString("\n")}insertHTML(o){const s=ln.parse(o).getDocument(),a=this.getSelectedRange();this.setDocument(this.document.mergeDocumentAtRange(s,a));const l=a[0],c=l+s.getLength()-1;return this.setSelection(c),this.notifyDelegateOfInsertionAtRange([l,c])}replaceHTML(o){const s=ln.parse(o).getDocument().copyUsingObjectsFromDocument(this.document),a=this.getLocationRange({strict:!1}),l=this.document.rangeFromLocationRange(a);return this.setDocument(s),this.setSelection(l)}insertFile(o){return this.insertFiles([o])}insertFiles(o){const s=[];return Array.from(o).forEach((o=>{var a;if(null!==(a=this.delegate)&&void 0!==a&&a.compositionShouldAcceptFile(o)){const a=ji.attachmentForFile(o);s.push(a)}})),this.insertAttachments(s)}insertAttachment(o){return this.insertAttachments([o])}insertAttachments(o){let s=new Ji;return Array.from(o).forEach((o=>{var l;const c=o.getType(),h=null===(l=a[c])||void 0===l?void 0:l.presentation,d=this.getCurrentTextAttributes();h&&(d.presentation=h);const m=Ji.textForAttachmentWithAttributes(o,d);s=s.appendText(m)})),this.insertText(s)}shouldManageDeletingInDirection(o){const s=this.getLocationRange();if(wt(s)){if("backward"===o&&0===s[0].offset)return!0;if(this.shouldManageMovingCursorInDirection(o))return!0}else if(s[0].index!==s[1].index)return!0;return!1}deleteInDirection(o){let s,a,l,{length:c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const h=this.getLocationRange();let d=this.getSelectedRange();const m=wt(d);if(m?a="backward"===o&&0===h[0].offset:l=h[0].index!==h[1].index,a&&this.canDecreaseBlockAttributeLevel()){const o=this.getBlock();if(o.isListItem()?this.decreaseListLevel():this.decreaseBlockAttributeLevel(),this.setSelection(d[0]),o.isEmpty())return!1}return m&&(d=this.getExpandedRangeInDirection(o,{length:c}),"backward"===o&&(s=this.getAttachmentAtRange(d))),s?(this.editAttachment(s),!1):(this.setDocument(this.document.removeTextAtRange(d)),this.setSelection(d[0]),!a&&!l&&void 0)}moveTextFromRange(o){const[s]=Array.from(this.getSelectedRange());return this.setDocument(this.document.moveTextFromRangeToPosition(o,s)),this.setSelection(s)}removeAttachment(o){const s=this.document.getRangeOfAttachment(o);if(s)return this.stopEditingAttachment(),this.setDocument(this.document.removeTextAtRange(s)),this.setSelection(s[0])}removeLastBlockAttribute(){const[o,s]=Array.from(this.getSelectedRange()),a=this.document.getBlockAtPosition(s);return this.removeCurrentAttribute(a.getLastAttribute()),this.setSelection(o)}insertPlaceholder(){return this.placeholderPosition=this.getPosition(),this.insertString(" ")}selectPlaceholder(){if(null!=this.placeholderPosition)return this.setSelectedRange([this.placeholderPosition,this.placeholderPosition+1]),this.getSelectedRange()}forgetPlaceholder(){this.placeholderPosition=null}hasCurrentAttribute(o){const s=this.currentAttributes[o];return null!=s&&!1!==s}toggleCurrentAttribute(o){const s=!this.currentAttributes[o];return s?this.setCurrentAttribute(o,s):this.removeCurrentAttribute(o)}canSetCurrentAttribute(o){return gt(o)?this.canSetCurrentBlockAttribute(o):this.canSetCurrentTextAttribute(o)}canSetCurrentTextAttribute(o){const s=this.getSelectedDocument();if(s){for(const o of Array.from(s.getAttachments()))if(!o.hasContent())return!1;return!0}}canSetCurrentBlockAttribute(o){const s=this.getBlock();if(s)return!s.isTerminalBlock()}setCurrentAttribute(o,s){return gt(o)?this.setBlockAttribute(o,s):(this.setTextAttribute(o,s),this.currentAttributes[o]=s,this.notifyDelegateOfCurrentAttributesChange())}setHTMLAtributeAtPosition(o,s,a){var l;const c=this.document.getBlockAtPosition(o),h=null===(l=gt(c.getLastAttribute()))||void 0===l?void 0:l.htmlAttributes;if(c&&null!=h&&h.includes(s)){const l=this.document.setHTMLAttributeAtPosition(o,s,a);this.setDocument(l)}}setTextAttribute(o,s){const a=this.getSelectedRange();if(!a)return;const[l,c]=Array.from(a);if(l!==c)return this.setDocument(this.document.addAttributeAtRange(o,s,a));if("href"===o){const o=Ji.textForStringWithAttributes(s,{href:s});return this.insertText(o)}}setBlockAttribute(o,s){const a=this.getSelectedRange();if(this.canSetCurrentAttribute(o))return this.setDocument(this.document.applyBlockAttributeAtRange(o,s,a)),this.setSelection(a)}removeCurrentAttribute(o){return gt(o)?(this.removeBlockAttribute(o),this.updateCurrentAttributes()):(this.removeTextAttribute(o),delete this.currentAttributes[o],this.notifyDelegateOfCurrentAttributesChange())}removeTextAttribute(o){const s=this.getSelectedRange();if(s)return this.setDocument(this.document.removeAttributeAtRange(o,s))}removeBlockAttribute(o){const s=this.getSelectedRange();if(s)return this.setDocument(this.document.removeAttributeAtRange(o,s))}canDecreaseNestingLevel(){var o;return(null===(o=this.getBlock())||void 0===o?void 0:o.getNestingLevel())>0}canIncreaseNestingLevel(){var o;const s=this.getBlock();if(s){if(null===(o=gt(s.getLastNestableAttribute()))||void 0===o||!o.listAttribute)return s.getNestingLevel()>0;{const o=this.getPreviousBlock();if(o)return function(){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return rt((arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).slice(0,o.length),o)}(o.getListItemAttributes(),s.getListItemAttributes())}}}decreaseNestingLevel(){const o=this.getBlock();if(o)return this.setDocument(this.document.replaceBlock(o,o.decreaseNestingLevel()))}increaseNestingLevel(){const o=this.getBlock();if(o)return this.setDocument(this.document.replaceBlock(o,o.increaseNestingLevel()))}canDecreaseBlockAttributeLevel(){var o;return(null===(o=this.getBlock())||void 0===o?void 0:o.getAttributeLevel())>0}decreaseBlockAttributeLevel(){var o;const s=null===(o=this.getBlock())||void 0===o?void 0:o.getLastAttribute();if(s)return this.removeCurrentAttribute(s)}decreaseListLevel(){let[o]=Array.from(this.getSelectedRange());const{index:s}=this.document.locationFromPosition(o);let a=s;const l=this.getBlock().getAttributeLevel();let c=this.document.getBlockAtIndex(a+1);for(;c&&c.isListItem()&&!(c.getAttributeLevel()<=l);)a++,c=this.document.getBlockAtIndex(a+1);o=this.document.positionFromLocation({index:s,offset:0});const h=this.document.positionFromLocation({index:a,offset:0});return this.setDocument(this.document.removeLastListAttributeAtRange([o,h]))}updateCurrentAttributes(){const o=this.getSelectedRange({ignoreLock:!0});if(o){const s=this.document.getCommonAttributesAtRange(o);if(Array.from(dt()).forEach((o=>{s[o]||this.canSetCurrentAttribute(o)||(s[o]=!1)})),!kt(s,this.currentAttributes))return this.currentAttributes=s,this.notifyDelegateOfCurrentAttributesChange()}}getCurrentAttributes(){return g.call({},this.currentAttributes)}getCurrentTextAttributes(){const o={};for(const s in this.currentAttributes){const a=this.currentAttributes[s];!1!==a&&pt(s)&&(o[s]=a)}return o}freezeSelection(){return this.setCurrentAttribute("frozen",!0)}thawSelection(){return this.removeCurrentAttribute("frozen")}hasFrozenSelection(){return this.hasCurrentAttribute("frozen")}setSelection(o){var s;const a=this.document.locationRangeFromRange(o);return null===(s=this.delegate)||void 0===s?void 0:s.compositionDidRequestChangingSelectionToLocationRange(a)}getSelectedRange(){const o=this.getLocationRange();if(o)return this.document.rangeFromLocationRange(o)}setSelectedRange(o){const s=this.document.locationRangeFromRange(o);return this.getSelectionManager().setLocationRange(s)}getPosition(){const o=this.getLocationRange();if(o)return this.document.positionFromLocation(o[0])}getLocationRange(o){return this.targetLocationRange?this.targetLocationRange:this.getSelectionManager().getLocationRange(o)||Tt({index:0,offset:0})}withTargetLocationRange(o,s){let a;this.targetLocationRange=o;try{a=s()}finally{this.targetLocationRange=null}return a}withTargetRange(o,s){const a=this.document.locationRangeFromRange(o);return this.withTargetLocationRange(a,s)}withTargetDOMRange(o,s){const a=this.createLocationRangeFromDOMRange(o,{strict:!1});return this.withTargetLocationRange(a,s)}getExpandedRangeInDirection(o){let{length:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[a,l]=Array.from(this.getSelectedRange());return"backward"===o?s?a-=s:a=this.translateUTF16PositionFromOffset(a,-1):s?l+=s:l=this.translateUTF16PositionFromOffset(l,1),Tt([a,l])}shouldManageMovingCursorInDirection(o){if(this.editingAttachment)return!0;const s=this.getExpandedRangeInDirection(o);return null!=this.getAttachmentAtRange(s)}moveCursorInDirection(o){let s,a;if(this.editingAttachment)a=this.document.getRangeOfAttachment(this.editingAttachment);else{const l=this.getSelectedRange();a=this.getExpandedRangeInDirection(o),s=!Lt(l,a)}if("backward"===o?this.setSelectedRange(a[0]):this.setSelectedRange(a[1]),s){const o=this.getAttachmentAtRange(a);if(o)return this.editAttachment(o)}}expandSelectionInDirection(o){let{length:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=this.getExpandedRangeInDirection(o,{length:s});return this.setSelectedRange(a)}expandSelectionForEditing(){if(this.hasCurrentAttribute("href"))return this.expandSelectionAroundCommonAttribute("href")}expandSelectionAroundCommonAttribute(o){const s=this.getPosition(),a=this.document.getRangeOfCommonAttributeAtPosition(o,s);return this.setSelectedRange(a)}selectionContainsAttachments(){var o;return(null===(o=this.getSelectedAttachments())||void 0===o?void 0:o.length)>0}selectionIsInCursorTarget(){return this.editingAttachment||this.positionIsCursorTarget(this.getPosition())}positionIsCursorTarget(o){const s=this.document.locationFromPosition(o);if(s)return this.locationIsCursorTarget(s)}positionIsBlockBreak(o){var s;return null===(s=this.document.getPieceAtPosition(o))||void 0===s?void 0:s.isBlockBreak()}getSelectedDocument(){const o=this.getSelectedRange();if(o)return this.document.getDocumentAtRange(o)}getSelectedAttachments(){var o;return null===(o=this.getSelectedDocument())||void 0===o?void 0:o.getAttachments()}getAttachments(){return this.attachments.slice(0)}refreshAttachments(){const o=this.document.getAttachments(),{added:s,removed:a}=function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const a=[],l=[],c=new Set;o.forEach((o=>{c.add(o)}));const h=new Set;return s.forEach((o=>{h.add(o),c.has(o)||a.push(o)})),o.forEach((o=>{h.has(o)||l.push(o)})),{added:a,removed:l}}(this.attachments,o);return this.attachments=o,Array.from(a).forEach((o=>{var s,a;o.delegate=null,null===(s=this.delegate)||void 0===s||null===(a=s.compositionDidRemoveAttachment)||void 0===a||a.call(s,o)})),(()=>{const o=[];return Array.from(s).forEach((s=>{var a,l;s.delegate=this,o.push(null===(a=this.delegate)||void 0===a||null===(l=a.compositionDidAddAttachment)||void 0===l?void 0:l.call(a,s))})),o})()}attachmentDidChangeAttributes(o){var s,a;return this.revision++,null===(s=this.delegate)||void 0===s||null===(a=s.compositionDidEditAttachment)||void 0===a?void 0:a.call(s,o)}attachmentDidChangePreviewURL(o){var s,a;return this.revision++,null===(s=this.delegate)||void 0===s||null===(a=s.compositionDidChangeAttachmentPreviewURL)||void 0===a?void 0:a.call(s,o)}editAttachment(o,s){var a,l;if(o!==this.editingAttachment)return this.stopEditingAttachment(),this.editingAttachment=o,null===(a=this.delegate)||void 0===a||null===(l=a.compositionDidStartEditingAttachment)||void 0===l?void 0:l.call(a,this.editingAttachment,s)}stopEditingAttachment(){var o,s;this.editingAttachment&&(null===(o=this.delegate)||void 0===o||null===(s=o.compositionDidStopEditingAttachment)||void 0===s||s.call(o,this.editingAttachment),this.editingAttachment=null)}updateAttributesForAttachment(o,s){return this.setDocument(this.document.updateAttributesForAttachment(o,s))}removeAttributeForAttachment(o,s){return this.setDocument(this.document.removeAttributeForAttachment(o,s))}breakFormattedBlock(o){let{document:s}=o;const{block:a}=o;let l=o.startPosition,c=[l-1,l];a.getBlockBreakPosition()===o.startLocation.offset?(a.breaksOnReturn()&&"\n"===o.nextCharacter?l+=1:s=s.removeTextAtRange(c),c=[l,l]):"\n"===o.nextCharacter?"\n"===o.previousCharacter?c=[l-1,l+1]:(c=[l,l+1],l+=1):o.startLocation.offset-1!=0&&(l+=1);const h=new rn([a.removeLastAttribute().copyWithoutText()]);return this.setDocument(s.insertDocumentAtRange(h,c)),this.setSelection(l)}getPreviousBlock(){const o=this.getLocationRange();if(o){const{index:s}=o[0];if(s>0)return this.document.getBlockAtIndex(s-1)}}getBlock(){const o=this.getLocationRange();if(o)return this.document.getBlockAtIndex(o[0].index)}getAttachmentAtRange(o){const s=this.document.getDocumentAtRange(o);if(s.toString()==="".concat("ï¿¼","\n"))return s.getAttachments()[0]}notifyDelegateOfCurrentAttributesChange(){var o,s;return null===(o=this.delegate)||void 0===o||null===(s=o.compositionDidChangeCurrentAttributes)||void 0===s?void 0:s.call(o,this.currentAttributes)}notifyDelegateOfInsertionAtRange(o){var s,a;return null===(s=this.delegate)||void 0===s||null===(a=s.compositionDidPerformInsertionAtRange)||void 0===a?void 0:a.call(s,o)}translateUTF16PositionFromOffset(o,s){const a=this.document.toUTF16String(),l=a.offsetFromUCS2Offset(o);return a.offsetToUCS2Offset(l+s)}}Rn.proxyMethod("getSelectionManager().getPointRange"),Rn.proxyMethod("getSelectionManager().setLocationRangeFromPointRange"),Rn.proxyMethod("getSelectionManager().createLocationRangeFromDOMRange"),Rn.proxyMethod("getSelectionManager().locationIsCursorTarget"),Rn.proxyMethod("getSelectionManager().selectionIsExpanded"),Rn.proxyMethod("delegate?.getSelectionManager");class kn extends z{constructor(o){super(...arguments),this.composition=o,this.undoEntries=[],this.redoEntries=[]}recordUndoEntry(o){let{context:s,consolidatable:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const l=this.undoEntries.slice(-1)[0];if(!a||!Tn(l,o,s)){const a=this.createEntry({description:o,context:s});this.undoEntries.push(a),this.redoEntries=[]}}undo(){const o=this.undoEntries.pop();if(o){const s=this.createEntry(o);return this.redoEntries.push(s),this.composition.loadSnapshot(o.snapshot)}}redo(){const o=this.redoEntries.pop();if(o){const s=this.createEntry(o);return this.undoEntries.push(s),this.composition.loadSnapshot(o.snapshot)}}canUndo(){return this.undoEntries.length>0}canRedo(){return this.redoEntries.length>0}createEntry(){let{description:o,context:s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{description:null==o?void 0:o.toString(),context:JSON.stringify(s),snapshot:this.composition.getSnapshot()}}}const Tn=(o,s,a)=>(null==o?void 0:o.description)===(null==s?void 0:s.toString())&&(null==o?void 0:o.context)===JSON.stringify(a),$n="attachmentGallery";class Ln{constructor(o){this.document=o.document,this.selectedRange=o.selectedRange}perform(){return this.removeBlockAttribute(),this.applyBlockAttribute()}getSnapshot(){return{document:this.document,selectedRange:this.selectedRange}}removeBlockAttribute(){return this.findRangesOfBlocks().map((o=>this.document=this.document.removeAttributeAtRange($n,o)))}applyBlockAttribute(){let o=0;this.findRangesOfPieces().forEach((s=>{s[1]-s[0]>1&&(s[0]+=o,s[1]+=o,"\n"!==this.document.getCharacterAtPosition(s[1])&&(this.document=this.document.insertBlockBreakAtRange(s[1]),s[1]<this.selectedRange[1]&&this.moveSelectedRangeForward(),s[1]++,o++),0!==s[0]&&"\n"!==this.document.getCharacterAtPosition(s[0]-1)&&(this.document=this.document.insertBlockBreakAtRange(s[0]),s[0]<this.selectedRange[0]&&this.moveSelectedRangeForward(),s[0]++,o++),this.document=this.document.applyBlockAttributeAtRange($n,!0,s))}))}findRangesOfBlocks(){return this.document.findRangesForBlockAttribute($n)}findRangesOfPieces(){return this.document.findRangesForTextAttribute("presentation",{withValue:"gallery"})}moveSelectedRangeForward(){this.selectedRange[0]+=1,this.selectedRange[1]+=1}}const Dn=function(o){const s=new Ln(o);return s.perform(),s.getSnapshot()},Yn=[Dn];class In{constructor(o,s,a){this.insertFiles=this.insertFiles.bind(this),this.composition=o,this.selectionManager=s,this.element=a,this.undoManager=new kn(this.composition),this.filters=Yn.slice(0)}loadDocument(o){return this.loadSnapshot({document:o,selectedRange:[0,0]})}loadHTML(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const s=ln.parse(o,{referenceElement:this.element}).getDocument();return this.loadDocument(s)}loadJSON(o){let{document:s,selectedRange:a}=o;return s=rn.fromJSON(s),this.loadSnapshot({document:s,selectedRange:a})}loadSnapshot(o){return this.undoManager=new kn(this.composition),this.composition.loadSnapshot(o)}getDocument(){return this.composition.document}getSelectedDocument(){return this.composition.getSelectedDocument()}getSnapshot(){return this.composition.getSnapshot()}toJSON(){return this.getSnapshot()}deleteInDirection(o){return this.composition.deleteInDirection(o)}insertAttachment(o){return this.composition.insertAttachment(o)}insertAttachments(o){return this.composition.insertAttachments(o)}insertDocument(o){return this.composition.insertDocument(o)}insertFile(o){return this.composition.insertFile(o)}insertFiles(o){return this.composition.insertFiles(o)}insertHTML(o){return this.composition.insertHTML(o)}insertString(o){return this.composition.insertString(o)}insertText(o){return this.composition.insertText(o)}insertLineBreak(){return this.composition.insertLineBreak()}getSelectedRange(){return this.composition.getSelectedRange()}getPosition(){return this.composition.getPosition()}getClientRectAtPosition(o){const s=this.getDocument().locationRangeFromRange([o,o+1]);return this.selectionManager.getClientRectAtLocationRange(s)}expandSelectionInDirection(o){return this.composition.expandSelectionInDirection(o)}moveCursorInDirection(o){return this.composition.moveCursorInDirection(o)}setSelectedRange(o){return this.composition.setSelectedRange(o)}activateAttribute(o){let s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.composition.setCurrentAttribute(o,s)}attributeIsActive(o){return this.composition.hasCurrentAttribute(o)}canActivateAttribute(o){return this.composition.canSetCurrentAttribute(o)}deactivateAttribute(o){return this.composition.removeCurrentAttribute(o)}setHTMLAtributeAtPosition(o,s,a){this.composition.setHTMLAtributeAtPosition(o,s,a)}canDecreaseNestingLevel(){return this.composition.canDecreaseNestingLevel()}canIncreaseNestingLevel(){return this.composition.canIncreaseNestingLevel()}decreaseNestingLevel(){if(this.canDecreaseNestingLevel())return this.composition.decreaseNestingLevel()}increaseNestingLevel(){if(this.canIncreaseNestingLevel())return this.composition.increaseNestingLevel()}canRedo(){return this.undoManager.canRedo()}canUndo(){return this.undoManager.canUndo()}recordUndoEntry(o){let{context:s,consolidatable:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.undoManager.recordUndoEntry(o,{context:s,consolidatable:a})}redo(){if(this.canRedo())return this.undoManager.redo()}undo(){if(this.canUndo())return this.undoManager.undo()}}class On{constructor(o){this.element=o}findLocationFromContainerAndOffset(o,s){let{strict:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{strict:!0},l=0,c=!1;const h={index:0,offset:0},d=this.findAttachmentElementParentForNode(o);d&&(o=d.parentNode,s=C(d));const m=S(this.element,{usingFilter:Bn});for(;m.nextNode();){const d=m.currentNode;if(d===o&&M(o)){O(d)||(h.offset+=s);break}if(d.parentNode===o){if(l++===s)break}else if(!x(o,d)&&l>0)break;D(d,{strict:a})?(c&&h.index++,h.offset=0,c=!0):h.offset+=Pn(d)}return h}findContainerAndOffsetFromLocation(o){let s,a;if(0===o.index&&0===o.offset){for(s=this.element,a=0;s.firstChild;)if(s=s.firstChild,L(s)){a=1;break}return[s,a]}let[l,c]=this.findNodeAndOffsetFromLocation(o);if(l){if(M(l))0===Pn(l)?(s=l.parentNode.parentNode,a=C(l.parentNode),O(l,{name:"right"})&&a++):(s=l,a=o.offset-c);else{if(s=l.parentNode,!D(l.previousSibling)&&!L(s))for(;l===s.lastChild&&(l=s,s=s.parentNode,!L(s)););a=C(l),0!==o.offset&&a++}return[s,a]}}findNodeAndOffsetFromLocation(o){let s,a,l=0;for(const c of this.getSignificantNodesForIndex(o.index)){const h=Pn(c);if(o.offset<=l+h)if(M(c)){if(s=c,a=l,o.offset===a&&O(s))break}else s||(s=c,a=l);if(l+=h,l>o.offset)break}return[s,a]}findAttachmentElementParentForNode(o){for(;o&&o!==this.element;){if(P(o))return o;o=o.parentNode}}getSignificantNodesForIndex(o){const s=[],a=S(this.element,{usingFilter:Fn});let l=!1;for(;a.nextNode();){const h=a.currentNode;var c;if(N(h)){if(null!=c?c++:c=0,c===o)l=!0;else if(l)break}else l&&s.push(h)}return s}}const Pn=function(o){return o.nodeType===Node.TEXT_NODE?O(o)?0:o.textContent.length:"br"===R(o)||P(o)?1:0},Fn=function(o){return Mn(o)===NodeFilter.FILTER_ACCEPT?Bn(o):NodeFilter.FILTER_REJECT},Mn=function(o){return F(o)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT},Bn=function(o){return P(o.parentNode)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT};class _n{createDOMRangeFromPoint(o){let s,{x:a,y:l}=o;if(document.caretPositionFromPoint){const{offsetNode:o,offset:c}=document.caretPositionFromPoint(a,l);return s=document.createRange(),s.setStart(o,c),s}if(document.caretRangeFromPoint)return document.caretRangeFromPoint(a,l);if(document.body.createTextRange){const c=Ft();try{const o=document.body.createTextRange();o.moveToPoint(a,l),o.select()}catch(o){}return s=Ft(),Mt(c),s}}getClientRectsForDOMRange(o){const s=Array.from(o.getClientRects());return[s[0],s[s.length-1]]}}class jn extends z{constructor(o){super(...arguments),this.didMouseDown=this.didMouseDown.bind(this),this.selectionDidChange=this.selectionDidChange.bind(this),this.element=o,this.locationMapper=new On(this.element),this.pointMapper=new _n,this.lockCount=0,f("mousedown",{onElement:this.element,withCallback:this.didMouseDown})}getLocationRange(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!1===o.strict?this.createLocationRangeFromDOMRange(Ft()):o.ignoreLock?this.currentLocationRange:this.lockedLocationRange?this.lockedLocationRange:this.currentLocationRange}setLocationRange(o){if(this.lockedLocationRange)return;o=Tt(o);const s=this.createDOMRangeFromLocationRange(o);s&&(Mt(s),this.updateCurrentLocationRange(o))}setLocationRangeFromPointRange(o){o=Tt(o);const s=this.getLocationAtPoint(o[0]),a=this.getLocationAtPoint(o[1]);this.setLocationRange([s,a])}getClientRectAtLocationRange(o){const s=this.createDOMRangeFromLocationRange(o);if(s)return this.getClientRectsForDOMRange(s)[1]}locationIsCursorTarget(o){const s=Array.from(this.findNodeAndOffsetFromLocation(o))[0];return O(s)}lock(){0==this.lockCount++&&(this.updateCurrentLocationRange(),this.lockedLocationRange=this.getLocationRange())}unlock(){if(0==--this.lockCount){const{lockedLocationRange:o}=this;if(this.lockedLocationRange=null,null!=o)return this.setLocationRange(o)}}clearSelection(){var o;return null===(o=Pt())||void 0===o?void 0:o.removeAllRanges()}selectionIsCollapsed(){var o;return!0===(null===(o=Ft())||void 0===o?void 0:o.collapsed)}selectionIsExpanded(){return!this.selectionIsCollapsed()}createLocationRangeFromDOMRange(o,s){if(null==o||!this.domRangeWithinElement(o))return;const a=this.findLocationFromContainerAndOffset(o.startContainer,o.startOffset,s);if(!a)return;const l=o.collapsed?void 0:this.findLocationFromContainerAndOffset(o.endContainer,o.endOffset,s);return Tt([a,l])}didMouseDown(){return this.pauseTemporarily()}pauseTemporarily(){let o;this.paused=!0;const e=()=>{if(this.paused=!1,clearTimeout(s),Array.from(o).forEach((o=>{o.destroy()})),x(document,this.element))return this.selectionDidChange()},s=setTimeout(e,200);o=["mousemove","keydown"].map((o=>f(o,{onElement:document,withCallback:e})))}selectionDidChange(){if(!this.paused&&!y(this.element))return this.updateCurrentLocationRange()}updateCurrentLocationRange(o){var s,a;if((null!=o?o:o=this.createLocationRangeFromDOMRange(Ft()))&&!Lt(o,this.currentLocationRange))return this.currentLocationRange=o,null===(s=this.delegate)||void 0===s||null===(a=s.locationRangeDidChange)||void 0===a?void 0:a.call(s,this.currentLocationRange.slice(0))}createDOMRangeFromLocationRange(o){const s=this.findContainerAndOffsetFromLocation(o[0]),a=wt(o)?s:this.findContainerAndOffsetFromLocation(o[1])||s;if(null!=s&&null!=a){const o=document.createRange();return o.setStart(...Array.from(s||[])),o.setEnd(...Array.from(a||[])),o}}getLocationAtPoint(o){const s=this.createDOMRangeFromPoint(o);var a;if(s)return null===(a=this.createLocationRangeFromDOMRange(s))||void 0===a?void 0:a[0]}domRangeWithinElement(o){return o.collapsed?x(this.element,o.startContainer):x(this.element,o.startContainer)&&x(this.element,o.endContainer)}}jn.proxyMethod("locationMapper.findLocationFromContainerAndOffset"),jn.proxyMethod("locationMapper.findContainerAndOffsetFromLocation"),jn.proxyMethod("locationMapper.findNodeAndOffsetFromLocation"),jn.proxyMethod("pointMapper.createDOMRangeFromPoint"),jn.proxyMethod("pointMapper.getClientRectsForDOMRange");var Xn=Object.freeze({__proto__:null,Attachment:ji,AttachmentManager:En,AttachmentPiece:Wi,Block:Ki,Composition:Rn,Document:rn,Editor:In,HTMLParser:ln,HTMLSanitizer:ci,LineBreakInsertion:Sn,LocationMapper:On,ManagedAttachment:Cn,Piece:Bi,PointMapper:_n,SelectionManager:jn,SplittableList:Vi,StringPiece:Ui,Text:Ji,UndoManager:kn}),nr=Object.freeze({__proto__:null,ObjectView:ee,AttachmentView:di,BlockView:yi,DocumentView:xi,PieceView:fi,PreviewableAttachmentView:pi,TextView:bi});const{lang:sr,css:ar,keyNames:lr}=Y,Hn=function(o){return function(){const s=o.apply(this,arguments);s.do(),this.undos||(this.undos=[]),this.undos.push(s.undo)}};class Jn extends z{constructor(o,s,a){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(...arguments),Ti(this,"makeElementMutable",Hn((()=>({do:()=>{this.element.dataset.trixMutable=!0},undo:()=>delete this.element.dataset.trixMutable})))),Ti(this,"addToolbar",Hn((()=>{const o=k({tagName:"div",className:ar.attachmentToolbar,data:{trixMutable:!0},childNodes:k({tagName:"div",className:"trix-button-row",childNodes:k({tagName:"span",className:"trix-button-group trix-button-group--actions",childNodes:k({tagName:"button",className:"trix-button trix-button--remove",textContent:sr.remove,attributes:{title:sr.remove},data:{trixAction:"remove"}})})})});return this.attachment.isPreviewable()&&o.appendChild(k({tagName:"div",className:ar.attachmentMetadataContainer,childNodes:k({tagName:"span",className:ar.attachmentMetadata,childNodes:[k({tagName:"span",className:ar.attachmentName,textContent:this.attachment.getFilename(),attributes:{title:this.attachment.getFilename()}}),k({tagName:"span",className:ar.attachmentSize,textContent:this.attachment.getFormattedFilesize()})]})})),f("click",{onElement:o,withCallback:this.didClickToolbar}),f("click",{onElement:o,matchingSelector:"[data-trix-action]",withCallback:this.didClickActionButton}),b("trix-attachment-before-toolbar",{onElement:this.element,attributes:{toolbar:o,attachment:this.attachment}}),{do:()=>this.element.appendChild(o),undo:()=>E(o)}}))),Ti(this,"installCaptionEditor",Hn((()=>{const o=k({tagName:"textarea",className:ar.attachmentCaptionEditor,attributes:{placeholder:sr.captionPlaceholder},data:{trixMutable:!0}});o.value=this.attachmentPiece.getCaption();const s=o.cloneNode();s.classList.add("trix-autoresize-clone"),s.tabIndex=-1;const i=function(){s.value=o.value,o.style.height=s.scrollHeight+"px"};f("input",{onElement:o,withCallback:i}),f("input",{onElement:o,withCallback:this.didInputCaption}),f("keydown",{onElement:o,withCallback:this.didKeyDownCaption}),f("change",{onElement:o,withCallback:this.didChangeCaption}),f("blur",{onElement:o,withCallback:this.didBlurCaption});const a=this.element.querySelector("figcaption"),l=a.cloneNode();return{do:()=>{if(a.style.display="none",l.appendChild(o),l.appendChild(s),l.classList.add("".concat(ar.attachmentCaption,"--editing")),a.parentElement.insertBefore(l,a),i(),this.options.editCaption)return St((()=>o.focus()))},undo(){E(l),a.style.display=null}}}))),this.didClickToolbar=this.didClickToolbar.bind(this),this.didClickActionButton=this.didClickActionButton.bind(this),this.didKeyDownCaption=this.didKeyDownCaption.bind(this),this.didInputCaption=this.didInputCaption.bind(this),this.didChangeCaption=this.didChangeCaption.bind(this),this.didBlurCaption=this.didBlurCaption.bind(this),this.attachmentPiece=o,this.element=s,this.container=a,this.options=l,this.attachment=this.attachmentPiece.attachment,"a"===R(this.element)&&(this.element=this.element.firstChild),this.install()}install(){this.makeElementMutable(),this.addToolbar(),this.attachment.isPreviewable()&&this.installCaptionEditor()}uninstall(){var o;let s=this.undos.pop();for(this.savePendingCaption();s;)s(),s=this.undos.pop();null===(o=this.delegate)||void 0===o||o.didUninstallAttachmentEditor(this)}savePendingCaption(){if(null!=this.pendingCaption){const c=this.pendingCaption;var o,s,a,l;this.pendingCaption=null,c?null===(o=this.delegate)||void 0===o||null===(s=o.attachmentEditorDidRequestUpdatingAttributesForAttachment)||void 0===s||s.call(o,{caption:c},this.attachment):null===(a=this.delegate)||void 0===a||null===(l=a.attachmentEditorDidRequestRemovingAttributeForAttachment)||void 0===l||l.call(a,"caption",this.attachment)}}didClickToolbar(o){return o.preventDefault(),o.stopPropagation()}didClickActionButton(o){var s;if("remove"===o.target.getAttribute("data-trix-action"))return null===(s=this.delegate)||void 0===s?void 0:s.attachmentEditorDidRequestRemovalOfAttachment(this.attachment)}didKeyDownCaption(o){var s,a;if("return"===lr[o.keyCode])return o.preventDefault(),this.savePendingCaption(),null===(s=this.delegate)||void 0===s||null===(a=s.attachmentEditorDidRequestDeselectingAttachment)||void 0===a?void 0:a.call(s,this.attachment)}didInputCaption(o){this.pendingCaption=o.target.value.replace(/\s/g," ").trim()}didChangeCaption(o){return this.savePendingCaption()}didBlurCaption(o){return this.savePendingCaption()}}class Kn extends z{constructor(o,a){super(...arguments),this.didFocus=this.didFocus.bind(this),this.didBlur=this.didBlur.bind(this),this.didClickAttachment=this.didClickAttachment.bind(this),this.element=o,this.composition=a,this.documentView=new xi(this.composition.document,{element:this.element}),f("focus",{onElement:this.element,withCallback:this.didFocus}),f("blur",{onElement:this.element,withCallback:this.didBlur}),f("click",{onElement:this.element,matchingSelector:"a[contenteditable=false]",preventDefault:!0}),f("mousedown",{onElement:this.element,matchingSelector:s,withCallback:this.didClickAttachment}),f("click",{onElement:this.element,matchingSelector:"a".concat(s),preventDefault:!0})}didFocus(o){var s;const i=()=>{var o,s;if(!this.focused)return this.focused=!0,null===(o=this.delegate)||void 0===o||null===(s=o.compositionControllerDidFocus)||void 0===s?void 0:s.call(o)};return(null===(s=this.blurPromise)||void 0===s?void 0:s.then(i))||i()}didBlur(o){this.blurPromise=new Promise((o=>St((()=>{var s,a;y(this.element)||(this.focused=null,null===(s=this.delegate)||void 0===s||null===(a=s.compositionControllerDidBlur)||void 0===a||a.call(s));return this.blurPromise=null,o()}))))}didClickAttachment(o,s){var a,l;const c=this.findAttachmentForElement(s),h=!!A(o.target,{matchingSelector:"figcaption"});return null===(a=this.delegate)||void 0===a||null===(l=a.compositionControllerDidSelectAttachment)||void 0===l?void 0:l.call(a,c,{editCaption:h})}getSerializableElement(){return this.isEditingAttachment()?this.documentView.shadowElement:this.element}render(){var o,s,a,l,c,h;(this.revision!==this.composition.revision&&(this.documentView.setDocument(this.composition.document),this.documentView.render(),this.revision=this.composition.revision),this.canSyncDocumentView()&&!this.documentView.isSynced())&&(null===(a=this.delegate)||void 0===a||null===(l=a.compositionControllerWillSyncDocumentView)||void 0===l||l.call(a),this.documentView.sync(),null===(c=this.delegate)||void 0===c||null===(h=c.compositionControllerDidSyncDocumentView)||void 0===h||h.call(c));return null===(o=this.delegate)||void 0===o||null===(s=o.compositionControllerDidRender)||void 0===s?void 0:s.call(o)}rerenderViewForObject(o){return this.invalidateViewForObject(o),this.render()}invalidateViewForObject(o){return this.documentView.invalidateViewForObject(o)}isViewCachingEnabled(){return this.documentView.isViewCachingEnabled()}enableViewCaching(){return this.documentView.enableViewCaching()}disableViewCaching(){return this.documentView.disableViewCaching()}refreshViewCache(){return this.documentView.garbageCollectCachedViews()}isEditingAttachment(){return!!this.attachmentEditor}installAttachmentEditorForAttachment(o,s){var a;if((null===(a=this.attachmentEditor)||void 0===a?void 0:a.attachment)===o)return;const l=this.documentView.findElementForObject(o);if(!l)return;this.uninstallAttachmentEditor();const c=this.composition.document.getAttachmentPieceForAttachment(o);this.attachmentEditor=new Jn(c,l,this.element,s),this.attachmentEditor.delegate=this}uninstallAttachmentEditor(){var o;return null===(o=this.attachmentEditor)||void 0===o?void 0:o.uninstall()}didUninstallAttachmentEditor(){return this.attachmentEditor=null,this.render()}attachmentEditorDidRequestUpdatingAttributesForAttachment(o,s){var a,l;return null===(a=this.delegate)||void 0===a||null===(l=a.compositionControllerWillUpdateAttachment)||void 0===l||l.call(a,s),this.composition.updateAttributesForAttachment(o,s)}attachmentEditorDidRequestRemovingAttributeForAttachment(o,s){var a,l;return null===(a=this.delegate)||void 0===a||null===(l=a.compositionControllerWillUpdateAttachment)||void 0===l||l.call(a,s),this.composition.removeAttributeForAttachment(o,s)}attachmentEditorDidRequestRemovalOfAttachment(o){var s,a;return null===(s=this.delegate)||void 0===s||null===(a=s.compositionControllerDidRequestRemovalOfAttachment)||void 0===a?void 0:a.call(s,o)}attachmentEditorDidRequestDeselectingAttachment(o){var s,a;return null===(s=this.delegate)||void 0===s||null===(a=s.compositionControllerDidRequestDeselectingAttachment)||void 0===a?void 0:a.call(s,o)}canSyncDocumentView(){return!this.isEditingAttachment()}findAttachmentForElement(o){return this.composition.document.getAttachmentById(parseInt(o.dataset.trixId,10))}}class Gn extends z{}const cr="data-trix-mutable",dr="[".concat(cr,"]"),Sr={attributes:!0,childList:!0,characterData:!0,characterDataOldValue:!0,subtree:!0};class Zn extends z{constructor(o){super(o),this.didMutate=this.didMutate.bind(this),this.element=o,this.observer=new window.MutationObserver(this.didMutate),this.start()}start(){return this.reset(),this.observer.observe(this.element,Sr)}stop(){return this.observer.disconnect()}didMutate(o){var s,a;if(this.mutations.push(...Array.from(this.findSignificantMutations(o)||[])),this.mutations.length)return null===(s=this.delegate)||void 0===s||null===(a=s.elementDidMutate)||void 0===a||a.call(s,this.getMutationSummary()),this.reset()}reset(){this.mutations=[]}findSignificantMutations(o){return o.filter((o=>this.mutationIsSignificant(o)))}mutationIsSignificant(o){if(this.nodeIsMutable(o.target))return!1;for(const s of Array.from(this.nodesModifiedByMutation(o)))if(this.nodeIsSignificant(s))return!0;return!1}nodeIsSignificant(o){return o!==this.element&&!this.nodeIsMutable(o)&&!F(o)}nodeIsMutable(o){return A(o,{matchingSelector:dr})}nodesModifiedByMutation(o){const s=[];switch(o.type){case"attributes":o.attributeName!==cr&&s.push(o.target);break;case"characterData":s.push(o.target.parentNode),s.push(o.target);break;case"childList":s.push(...Array.from(o.addedNodes||[])),s.push(...Array.from(o.removedNodes||[]))}return s}getMutationSummary(){return this.getTextMutationSummary()}getTextMutationSummary(){const{additions:o,deletions:s}=this.getTextChangesFromCharacterData(),a=this.getTextChangesFromChildList();Array.from(a.additions).forEach((s=>{Array.from(o).includes(s)||o.push(s)})),s.push(...Array.from(a.deletions||[]));const l={},c=o.join("");c&&(l.textAdded=c);const h=s.join("");return h&&(l.textDeleted=h),l}getMutationsByType(o){return Array.from(this.mutations).filter((s=>s.type===o))}getTextChangesFromChildList(){let o,s;const a=[],l=[];Array.from(this.getMutationsByType("childList")).forEach((o=>{a.push(...Array.from(o.addedNodes||[])),l.push(...Array.from(o.removedNodes||[]))}));0===a.length&&1===l.length&&N(l[0])?(o=[],s=["\n"]):(o=Qn(a),s=Qn(l));const c=o.filter(((o,a)=>o!==s[a])).map(jt),h=s.filter(((s,a)=>s!==o[a])).map(jt);return{additions:c,deletions:h}}getTextChangesFromCharacterData(){let o,s;const a=this.getMutationsByType("characterData");if(a.length){const l=a[0],c=a[a.length-1],h=function(o,s){let a,l;return o=$.box(o),(s=$.box(s)).length<o.length?[l,a]=Vt(o,s):[a,l]=Vt(s,o),{added:a,removed:l}}(jt(l.oldValue),jt(c.target.data));o=h.added,s=h.removed}return{additions:o?[o]:[],deletions:s?[s]:[]}}}const Qn=function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const s=[];for(const a of Array.from(o))switch(a.nodeType){case Node.TEXT_NODE:s.push(a.data);break;case Node.ELEMENT_NODE:"br"===R(a)?s.push("\n"):s.push(...Array.from(Qn(a.childNodes)||[]))}return s};class tr extends te{constructor(o){super(...arguments),this.file=o}perform(o){const s=new FileReader;return s.onerror=()=>o(!1),s.onload=()=>{s.onerror=null;try{s.abort()}catch(o){}return o(!0,this.file)},s.readAsArrayBuffer(this.file)}}class er{constructor(o){this.element=o}shouldIgnore(o){return!!d.samsungAndroid&&(this.previousEvent=this.event,this.event=o,this.checkSamsungKeyboardBuggyModeStart(),this.checkSamsungKeyboardBuggyModeEnd(),this.buggyMode)}checkSamsungKeyboardBuggyModeStart(){this.insertingLongTextAfterUnidentifiedChar()&&ir(this.element.innerText,this.event.data)&&(this.buggyMode=!0,this.event.preventDefault())}checkSamsungKeyboardBuggyModeEnd(){this.buggyMode&&"insertText"!==this.event.inputType&&(this.buggyMode=!1)}insertingLongTextAfterUnidentifiedChar(){var o;return this.isBeforeInputInsertText()&&this.previousEventWasUnidentifiedKeydown()&&(null===(o=this.event.data)||void 0===o?void 0:o.length)>50}isBeforeInputInsertText(){return"beforeinput"===this.event.type&&"insertText"===this.event.inputType}previousEventWasUnidentifiedKeydown(){var o,s;return"keydown"===(null===(o=this.previousEvent)||void 0===o?void 0:o.type)&&"Unidentified"===(null===(s=this.previousEvent)||void 0===s?void 0:s.key)}}const ir=(o,s)=>rr(o)===rr(s),Rr=new RegExp("(".concat("ï¿¼","|").concat(B,"|").concat(j,"|\\s)+"),"g"),rr=o=>o.replace(Rr," ").trim();class or extends z{constructor(o){super(...arguments),this.element=o,this.mutationObserver=new Zn(this.element),this.mutationObserver.delegate=this,this.flakyKeyboardDetector=new er(this.element);for(const o in this.constructor.events)f(o,{onElement:this.element,withCallback:this.handlerFor(o)})}elementDidMutate(o){}editorWillSyncDocumentView(){return this.mutationObserver.stop()}editorDidSyncDocumentView(){return this.mutationObserver.start()}requestRender(){var o,s;return null===(o=this.delegate)||void 0===o||null===(s=o.inputControllerDidRequestRender)||void 0===s?void 0:s.call(o)}requestReparse(){var o,s;return null===(o=this.delegate)||void 0===o||null===(s=o.inputControllerDidRequestReparse)||void 0===s||s.call(o),this.requestRender()}attachFiles(o){const s=Array.from(o).map((o=>new tr(o)));return Promise.all(s).then((o=>{this.handleInput((function(){var s,a;return null===(s=this.delegate)||void 0===s||s.inputControllerWillAttachFiles(),null===(a=this.responder)||void 0===a||a.insertFiles(o),this.requestRender()}))}))}handlerFor(o){return s=>{s.defaultPrevented||this.handleInput((()=>{if(!y(this.element)){if(this.flakyKeyboardDetector.shouldIgnore(s))return;this.eventName=o,this.constructor.events[o].call(this,s)}}))}}handleInput(o){try{var s;null===(s=this.delegate)||void 0===s||s.inputControllerWillHandleInput(),o.call(this)}finally{var a;null===(a=this.delegate)||void 0===a||a.inputControllerDidHandleInput()}}createLinkHTML(o,s){const a=document.createElement("a");return a.href=o,a.textContent=s||o,a.outerHTML}}var Tr;Ti(or,"events",{});const{browser:kr,keyNames:Lr}=Y;let wr=0;class ur extends or{constructor(){super(...arguments),this.resetInputSummary()}setInputSummary(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.inputSummary.eventName=this.eventName;for(const s in o){const a=o[s];this.inputSummary[s]=a}return this.inputSummary}resetInputSummary(){this.inputSummary={}}reset(){return this.resetInputSummary(),le.reset()}elementDidMutate(o){var s,a;return this.isComposing()?null===(s=this.delegate)||void 0===s||null===(a=s.inputControllerDidAllowUnhandledInput)||void 0===a?void 0:a.call(s):this.handleInput((function(){return this.mutationIsSignificant(o)&&(this.mutationIsExpected(o)?this.requestRender():this.requestReparse()),this.reset()}))}mutationIsExpected(o){let{textAdded:s,textDeleted:a}=o;if(this.inputSummary.preferDocument)return!0;const l=null!=s?s===this.inputSummary.textAdded:!this.inputSummary.textAdded,c=null!=a?this.inputSummary.didDelete:!this.inputSummary.didDelete,h=["\n"," \n"].includes(s)&&!l,d="\n"===a&&!c;if(h&&!d||d&&!h){const o=this.getSelectedRange();if(o){var m;const a=h?s.replace(/\n$/,"").length||-1:(null==s?void 0:s.length)||1;if(null!==(m=this.responder)&&void 0!==m&&m.positionIsBlockBreak(o[1]+a))return!0}}return l&&c}mutationIsSignificant(o){var s;const a=Object.keys(o).length>0,l=""===(null===(s=this.compositionInput)||void 0===s?void 0:s.getEndData());return a||!l}getCompositionInput(){if(this.isComposing())return this.compositionInput;this.compositionInput=new pr(this)}isComposing(){return this.compositionInput&&!this.compositionInput.isEnded()}deleteInDirection(o,s){var a;return!1!==(null===(a=this.responder)||void 0===a?void 0:a.deleteInDirection(o))?this.setInputSummary({didDelete:!0}):s?(s.preventDefault(),this.requestRender()):void 0}serializeSelectionToDataTransfer(o){var s;if(!function(o){if(null==o||!o.setData)return!1;for(const s in se){const a=se[s];try{if(o.setData(s,a),!o.getData(s)===a)return!1}catch(o){return!1}}return!0}(o))return;const a=null===(s=this.responder)||void 0===s?void 0:s.getSelectedDocument().toSerializableDocument();return o.setData("application/x-trix-document",JSON.stringify(a)),o.setData("text/html",xi.render(a).innerHTML),o.setData("text/plain",a.toString().replace(/\n$/,"")),!0}canAcceptDataTransfer(o){const s={};return Array.from((null==o?void 0:o.types)||[]).forEach((o=>{s[o]=!0})),s.Files||s["application/x-trix-document"]||s["text/html"]||s["text/plain"]}getPastedHTMLUsingHiddenElement(o){const s=this.getSelectedRange(),a={position:"absolute",left:"".concat(window.pageXOffset,"px"),top:"".concat(window.pageYOffset,"px"),opacity:0},l=k({style:a,tagName:"div",editable:!0});return document.body.appendChild(l),l.focus(),requestAnimationFrame((()=>{const a=l.innerHTML;return E(l),this.setSelectedRange(s),o(a)}))}}Ti(ur,"events",{keydown(o){this.isComposing()||this.resetInputSummary(),this.inputSummary.didInput=!0;const s=Lr[o.keyCode];if(s){var a;let l=this.keys;["ctrl","alt","shift","meta"].forEach((s=>{var a;o["".concat(s,"Key")]&&("ctrl"===s&&(s="control"),l=null===(a=l)||void 0===a?void 0:a[s])})),null!=(null===(a=l)||void 0===a?void 0:a[s])&&(this.setInputSummary({keyName:s}),le.reset(),l[s].call(this,o))}if(ae(o)){const s=String.fromCharCode(o.keyCode).toLowerCase();if(s){var l;const a=["alt","shift"].map((s=>{if(o["".concat(s,"Key")])return s})).filter((o=>o));a.push(s),null!==(l=this.delegate)&&void 0!==l&&l.inputControllerDidReceiveKeyboardCommand(a)&&o.preventDefault()}}},keypress(o){if(null!=this.inputSummary.eventName)return;if(o.metaKey)return;if(o.ctrlKey&&!o.altKey)return;const s=gr(o);var a,l;return s?(null===(a=this.delegate)||void 0===a||a.inputControllerWillPerformTyping(),null===(l=this.responder)||void 0===l||l.insertString(s),this.setInputSummary({textAdded:s,didDelete:this.selectionIsExpanded()})):void 0},textInput(o){const{data:s}=o,{textAdded:a}=this.inputSummary;if(a&&a!==s&&a.toUpperCase()===s){var l;const o=this.getSelectedRange();return this.setSelectedRange([o[0],o[1]+a.length]),null===(l=this.responder)||void 0===l||l.insertString(s),this.setInputSummary({textAdded:s}),this.setSelectedRange(o)}},dragenter(o){o.preventDefault()},dragstart(o){var s,a;return this.serializeSelectionToDataTransfer(o.dataTransfer),this.draggedRange=this.getSelectedRange(),null===(s=this.delegate)||void 0===s||null===(a=s.inputControllerDidStartDrag)||void 0===a?void 0:a.call(s)},dragover(o){if(this.draggedRange||this.canAcceptDataTransfer(o.dataTransfer)){o.preventDefault();const l={x:o.clientX,y:o.clientY};var s,a;if(!kt(l,this.draggingPoint))return this.draggingPoint=l,null===(s=this.delegate)||void 0===s||null===(a=s.inputControllerDidReceiveDragOverPoint)||void 0===a?void 0:a.call(s,this.draggingPoint)}},dragend(o){var s,a;null===(s=this.delegate)||void 0===s||null===(a=s.inputControllerDidCancelDrag)||void 0===a||a.call(s),this.draggedRange=null,this.draggingPoint=null},drop(o){var s,a;o.preventDefault();const l=null===(s=o.dataTransfer)||void 0===s?void 0:s.files,c=o.dataTransfer.getData("application/x-trix-document"),h={x:o.clientX,y:o.clientY};if(null===(a=this.responder)||void 0===a||a.setLocationRangeFromPointRange(h),null!=l&&l.length)this.attachFiles(l);else if(this.draggedRange){var d,m;null===(d=this.delegate)||void 0===d||d.inputControllerWillMoveText(),null===(m=this.responder)||void 0===m||m.moveTextFromRange(this.draggedRange),this.draggedRange=null,this.requestRender()}else if(c){var p;const o=rn.fromJSONString(c);null===(p=this.responder)||void 0===p||p.insertDocument(o),this.requestRender()}this.draggedRange=null,this.draggingPoint=null},cut(o){var s,a;if(null!==(s=this.responder)&&void 0!==s&&s.selectionIsExpanded()&&(this.serializeSelectionToDataTransfer(o.clipboardData)&&o.preventDefault(),null===(a=this.delegate)||void 0===a||a.inputControllerWillCutText(),this.deleteInDirection("backward"),o.defaultPrevented))return this.requestRender()},copy(o){var s;null!==(s=this.responder)&&void 0!==s&&s.selectionIsExpanded()&&this.serializeSelectionToDataTransfer(o.clipboardData)&&o.preventDefault()},paste(o){const s=o.clipboardData||o.testClipboardData,a={clipboard:s};if(!s||mr(o))return void this.getPastedHTMLUsingHiddenElement((o=>{var s,l,c;return a.type="text/html",a.html=o,null===(s=this.delegate)||void 0===s||s.inputControllerWillPaste(a),null===(l=this.responder)||void 0===l||l.insertHTML(a.html),this.requestRender(),null===(c=this.delegate)||void 0===c?void 0:c.inputControllerDidPaste(a)}));const l=s.getData("URL"),c=s.getData("text/html"),h=s.getData("public.url-name");if(l){var d,m,p;let o;a.type="text/html",o=h?Ut(h).trim():l,a.html=this.createLinkHTML(l,o),null===(d=this.delegate)||void 0===d||d.inputControllerWillPaste(a),this.setInputSummary({textAdded:o,didDelete:this.selectionIsExpanded()}),null===(m=this.responder)||void 0===m||m.insertHTML(a.html),this.requestRender(),null===(p=this.delegate)||void 0===p||p.inputControllerDidPaste(a)}else if(Ct(s)){var T,B,j;a.type="text/plain",a.string=s.getData("text/plain"),null===(T=this.delegate)||void 0===T||T.inputControllerWillPaste(a),this.setInputSummary({textAdded:a.string,didDelete:this.selectionIsExpanded()}),null===(B=this.responder)||void 0===B||B.insertString(a.string),this.requestRender(),null===(j=this.delegate)||void 0===j||j.inputControllerDidPaste(a)}else if(c){var _,W,U;a.type="text/html",a.html=c,null===(_=this.delegate)||void 0===_||_.inputControllerWillPaste(a),null===(W=this.responder)||void 0===W||W.insertHTML(a.html),this.requestRender(),null===(U=this.delegate)||void 0===U||U.inputControllerDidPaste(a)}else if(Array.from(s.types).includes("Files")){var V,H;const o=null===(V=s.items)||void 0===V||null===(V=V[0])||void 0===V||null===(H=V.getAsFile)||void 0===H?void 0:H.call(V);if(o){var J,K,G;const s=hr(o);!o.name&&s&&(o.name="pasted-file-".concat(++wr,".").concat(s)),a.type="File",a.file=o,null===(J=this.delegate)||void 0===J||J.inputControllerWillAttachFiles(),null===(K=this.responder)||void 0===K||K.insertFile(a.file),this.requestRender(),null===(G=this.delegate)||void 0===G||G.inputControllerDidPaste(a)}}o.preventDefault()},compositionstart(o){return this.getCompositionInput().start(o.data)},compositionupdate(o){return this.getCompositionInput().update(o.data)},compositionend(o){return this.getCompositionInput().end(o.data)},beforeinput(o){this.inputSummary.didInput=!0},input(o){return this.inputSummary.didInput=!0,o.stopPropagation()}}),Ti(ur,"keys",{backspace(o){var s;return null===(s=this.delegate)||void 0===s||s.inputControllerWillPerformTyping(),this.deleteInDirection("backward",o)},delete(o){var s;return null===(s=this.delegate)||void 0===s||s.inputControllerWillPerformTyping(),this.deleteInDirection("forward",o)},return(o){var s,a;return this.setInputSummary({preferDocument:!0}),null===(s=this.delegate)||void 0===s||s.inputControllerWillPerformTyping(),null===(a=this.responder)||void 0===a?void 0:a.insertLineBreak()},tab(o){var s,a;null!==(s=this.responder)&&void 0!==s&&s.canIncreaseNestingLevel()&&(null===(a=this.responder)||void 0===a||a.increaseNestingLevel(),this.requestRender(),o.preventDefault())},left(o){var s;if(this.selectionIsInCursorTarget())return o.preventDefault(),null===(s=this.responder)||void 0===s?void 0:s.moveCursorInDirection("backward")},right(o){var s;if(this.selectionIsInCursorTarget())return o.preventDefault(),null===(s=this.responder)||void 0===s?void 0:s.moveCursorInDirection("forward")},control:{d(o){var s;return null===(s=this.delegate)||void 0===s||s.inputControllerWillPerformTyping(),this.deleteInDirection("forward",o)},h(o){var s;return null===(s=this.delegate)||void 0===s||s.inputControllerWillPerformTyping(),this.deleteInDirection("backward",o)},o(o){var s,a;return o.preventDefault(),null===(s=this.delegate)||void 0===s||s.inputControllerWillPerformTyping(),null===(a=this.responder)||void 0===a||a.insertString("\n",{updatePosition:!1}),this.requestRender()}},shift:{return(o){var s,a;null===(s=this.delegate)||void 0===s||s.inputControllerWillPerformTyping(),null===(a=this.responder)||void 0===a||a.insertString("\n"),this.requestRender(),o.preventDefault()},tab(o){var s,a;null!==(s=this.responder)&&void 0!==s&&s.canDecreaseNestingLevel()&&(null===(a=this.responder)||void 0===a||a.decreaseNestingLevel(),this.requestRender(),o.preventDefault())},left(o){if(this.selectionIsInCursorTarget())return o.preventDefault(),this.expandSelectionInDirection("backward")},right(o){if(this.selectionIsInCursorTarget())return o.preventDefault(),this.expandSelectionInDirection("forward")}},alt:{backspace(o){var s;return this.setInputSummary({preferDocument:!1}),null===(s=this.delegate)||void 0===s?void 0:s.inputControllerWillPerformTyping()}},meta:{backspace(o){var s;return this.setInputSummary({preferDocument:!1}),null===(s=this.delegate)||void 0===s?void 0:s.inputControllerWillPerformTyping()}}}),ur.proxyMethod("responder?.getSelectedRange"),ur.proxyMethod("responder?.setSelectedRange"),ur.proxyMethod("responder?.expandSelectionInDirection"),ur.proxyMethod("responder?.selectionIsInCursorTarget"),ur.proxyMethod("responder?.selectionIsExpanded");const hr=o=>{var s;return null===(s=o.type)||void 0===s||null===(s=s.match(/\/(\w+)$/))||void 0===s?void 0:s[1]},Dr=!(null===(Tr=" ".codePointAt)||void 0===Tr||!Tr.call(" ",0)),gr=function(o){if(o.key&&Dr&&o.key.codePointAt(0)===o.keyCode)return o.key;{let s;if(null===o.which?s=o.keyCode:0!==o.which&&0!==o.charCode&&(s=o.charCode),null!=s&&"escape"!==Lr[s])return $.fromCodepoints([s]).toString()}},mr=function(o){const s=o.clipboardData;if(s){if(s.types.includes("text/html")){for(const o of s.types){const a=/^CorePasteboardFlavorType/.test(o),l=/^dyn\./.test(o)&&s.getData(o);if(a||l)return!0}return!1}{const o=s.types.includes("com.apple.webarchive"),a=s.types.includes("com.apple.flat-rtfd");return o||a}}};class pr extends z{constructor(o){super(...arguments),this.inputController=o,this.responder=this.inputController.responder,this.delegate=this.inputController.delegate,this.inputSummary=this.inputController.inputSummary,this.data={}}start(o){if(this.data.start=o,this.isSignificant()){var s,a;"keypress"===this.inputSummary.eventName&&this.inputSummary.textAdded&&(null===(a=this.responder)||void 0===a||a.deleteInDirection("left"));this.selectionIsExpanded()||(this.insertPlaceholder(),this.requestRender()),this.range=null===(s=this.responder)||void 0===s?void 0:s.getSelectedRange()}}update(o){if(this.data.update=o,this.isSignificant()){const o=this.selectPlaceholder();o&&(this.forgetPlaceholder(),this.range=o)}}end(o){return this.data.end=o,this.isSignificant()?(this.forgetPlaceholder(),this.canApplyToDocument()?(this.setInputSummary({preferDocument:!0,didInput:!1}),null===(s=this.delegate)||void 0===s||s.inputControllerWillPerformTyping(),null===(a=this.responder)||void 0===a||a.setSelectedRange(this.range),null===(l=this.responder)||void 0===l||l.insertString(this.data.end),null===(c=this.responder)||void 0===c?void 0:c.setSelectedRange(this.range[0]+this.data.end.length)):null!=this.data.start||null!=this.data.update?(this.requestReparse(),this.inputController.reset()):void 0):this.inputController.reset();var s,a,l,c}getEndData(){return this.data.end}isEnded(){return null!=this.getEndData()}isSignificant(){return!kr.composesExistingText||this.inputSummary.didInput}canApplyToDocument(){var o,s;return 0===(null===(o=this.data.start)||void 0===o?void 0:o.length)&&(null===(s=this.data.end)||void 0===s?void 0:s.length)>0&&this.range}}pr.proxyMethod("inputController.setInputSummary"),pr.proxyMethod("inputController.requestRender"),pr.proxyMethod("inputController.requestReparse"),pr.proxyMethod("responder?.selectionIsExpanded"),pr.proxyMethod("responder?.insertPlaceholder"),pr.proxyMethod("responder?.selectPlaceholder"),pr.proxyMethod("responder?.forgetPlaceholder");class fr extends or{constructor(){super(...arguments),this.render=this.render.bind(this)}elementDidMutate(){return this.scheduledRender?this.composing?null===(o=this.delegate)||void 0===o||null===(s=o.inputControllerDidAllowUnhandledInput)||void 0===s?void 0:s.call(o):void 0:this.reparse();var o,s}scheduleRender(){return this.scheduledRender?this.scheduledRender:this.scheduledRender=requestAnimationFrame(this.render)}render(){var o,s;(cancelAnimationFrame(this.scheduledRender),this.scheduledRender=null,this.composing)||null===(s=this.delegate)||void 0===s||s.render();null===(o=this.afterRender)||void 0===o||o.call(this),this.afterRender=null}reparse(){var o;return null===(o=this.delegate)||void 0===o?void 0:o.reparse()}insertString(){var o;let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=arguments.length>1?arguments[1]:void 0;return null===(o=this.delegate)||void 0===o||o.inputControllerWillPerformTyping(),this.withTargetDOMRange((function(){var o;return null===(o=this.responder)||void 0===o?void 0:o.insertString(s,a)}))}toggleAttributeIfSupported(o){var s;if(dt().includes(o))return null===(s=this.delegate)||void 0===s||s.inputControllerWillPerformFormatting(o),this.withTargetDOMRange((function(){var s;return null===(s=this.responder)||void 0===s?void 0:s.toggleCurrentAttribute(o)}))}activateAttributeIfSupported(o,s){var a;if(dt().includes(o))return null===(a=this.delegate)||void 0===a||a.inputControllerWillPerformFormatting(o),this.withTargetDOMRange((function(){var a;return null===(a=this.responder)||void 0===a?void 0:a.setCurrentAttribute(o,s)}))}deleteInDirection(o){let{recordUndoEntry:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{recordUndoEntry:!0};var a;s&&(null===(a=this.delegate)||void 0===a||a.inputControllerWillPerformTyping());const n=()=>{var s;return null===(s=this.responder)||void 0===s?void 0:s.deleteInDirection(o)},l=this.getTargetDOMRange({minLength:this.composing?1:2});return l?this.withTargetDOMRange(l,n):n()}withTargetDOMRange(o,s){var a;return"function"==typeof o&&(s=o,o=this.getTargetDOMRange()),o?null===(a=this.responder)||void 0===a?void 0:a.withTargetDOMRange(o,s.bind(this)):(le.reset(),s.call(this))}getTargetDOMRange(){var o,s;let{minLength:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{minLength:0};const l=null===(o=(s=this.event).getTargetRanges)||void 0===o?void 0:o.call(s);if(l&&l.length){const o=br(l[0]);if(0===a||o.toString().length>=a)return o}}withEvent(o,s){let a;this.event=o;try{a=s.call(this)}finally{this.event=null}return a}}Ti(fr,"events",{keydown(o){if(ae(o)){var s;const a=Cr(o);null!==(s=this.delegate)&&void 0!==s&&s.inputControllerDidReceiveKeyboardCommand(a)&&o.preventDefault()}else{let s=o.key;o.altKey&&(s+="+Alt"),o.shiftKey&&(s+="+Shift");const a=this.constructor.keys[s];if(a)return this.withEvent(o,a)}},paste(o){var s;let a;const l=null===(s=o.clipboardData)||void 0===s?void 0:s.getData("URL");return yr(o)?(o.preventDefault(),this.attachFiles(o.clipboardData.files)):xr(o)?(o.preventDefault(),a={type:"text/plain",string:o.clipboardData.getData("text/plain")},null===(c=this.delegate)||void 0===c||c.inputControllerWillPaste(a),null===(h=this.responder)||void 0===h||h.insertString(a.string),this.render(),null===(d=this.delegate)||void 0===d?void 0:d.inputControllerDidPaste(a)):l?(o.preventDefault(),a={type:"text/html",html:this.createLinkHTML(l)},null===(m=this.delegate)||void 0===m||m.inputControllerWillPaste(a),null===(p=this.responder)||void 0===p||p.insertHTML(a.html),this.render(),null===(T=this.delegate)||void 0===T?void 0:T.inputControllerDidPaste(a)):void 0;var c,h,d,m,p,T},beforeinput(o){const s=this.constructor.inputTypes[o.inputType],a=(l=o,!(!/iPhone|iPad/.test(navigator.userAgent)||l.inputType&&"insertParagraph"!==l.inputType));var l;s&&(this.withEvent(o,s),a||this.scheduleRender()),a&&this.render()},input(o){le.reset()},dragstart(o){var s,a;null!==(s=this.responder)&&void 0!==s&&s.selectionContainsAttachments()&&(o.dataTransfer.setData("application/x-trix-dragging",!0),this.dragging={range:null===(a=this.responder)||void 0===a?void 0:a.getSelectedRange(),point:Er(o)})},dragenter(o){vr(o)&&o.preventDefault()},dragover(o){if(this.dragging){o.preventDefault();const a=Er(o);var s;if(!kt(a,this.dragging.point))return this.dragging.point=a,null===(s=this.responder)||void 0===s?void 0:s.setLocationRangeFromPointRange(a)}else vr(o)&&o.preventDefault()},drop(o){var s,a;if(this.dragging)return o.preventDefault(),null===(s=this.delegate)||void 0===s||s.inputControllerWillMoveText(),null===(a=this.responder)||void 0===a||a.moveTextFromRange(this.dragging.range),this.dragging=null,this.scheduleRender();if(vr(o)){var l;o.preventDefault();const s=Er(o);return null===(l=this.responder)||void 0===l||l.setLocationRangeFromPointRange(s),this.attachFiles(o.dataTransfer.files)}},dragend(){var o;this.dragging&&(null===(o=this.responder)||void 0===o||o.setSelectedRange(this.dragging.range),this.dragging=null)},compositionend(o){this.composing&&(this.composing=!1,d.recentAndroid||this.scheduleRender())}}),Ti(fr,"keys",{ArrowLeft(){var o,s;if(null!==(o=this.responder)&&void 0!==o&&o.shouldManageMovingCursorInDirection("backward"))return this.event.preventDefault(),null===(s=this.responder)||void 0===s?void 0:s.moveCursorInDirection("backward")},ArrowRight(){var o,s;if(null!==(o=this.responder)&&void 0!==o&&o.shouldManageMovingCursorInDirection("forward"))return this.event.preventDefault(),null===(s=this.responder)||void 0===s?void 0:s.moveCursorInDirection("forward")},Backspace(){var o,s,a;if(null!==(o=this.responder)&&void 0!==o&&o.shouldManageDeletingInDirection("backward"))return this.event.preventDefault(),null===(s=this.delegate)||void 0===s||s.inputControllerWillPerformTyping(),null===(a=this.responder)||void 0===a||a.deleteInDirection("backward"),this.render()},Tab(){var o,s;if(null!==(o=this.responder)&&void 0!==o&&o.canIncreaseNestingLevel())return this.event.preventDefault(),null===(s=this.responder)||void 0===s||s.increaseNestingLevel(),this.render()},"Tab+Shift"(){var o,s;if(null!==(o=this.responder)&&void 0!==o&&o.canDecreaseNestingLevel())return this.event.preventDefault(),null===(s=this.responder)||void 0===s||s.decreaseNestingLevel(),this.render()}}),Ti(fr,"inputTypes",{deleteByComposition(){return this.deleteInDirection("backward",{recordUndoEntry:!1})},deleteByCut(){return this.deleteInDirection("backward")},deleteByDrag(){return this.event.preventDefault(),this.withTargetDOMRange((function(){var o;this.deleteByDragRange=null===(o=this.responder)||void 0===o?void 0:o.getSelectedRange()}))},deleteCompositionText(){return this.deleteInDirection("backward",{recordUndoEntry:!1})},deleteContent(){return this.deleteInDirection("backward")},deleteContentBackward(){return this.deleteInDirection("backward")},deleteContentForward(){return this.deleteInDirection("forward")},deleteEntireSoftLine(){return this.deleteInDirection("forward")},deleteHardLineBackward(){return this.deleteInDirection("backward")},deleteHardLineForward(){return this.deleteInDirection("forward")},deleteSoftLineBackward(){return this.deleteInDirection("backward")},deleteSoftLineForward(){return this.deleteInDirection("forward")},deleteWordBackward(){return this.deleteInDirection("backward")},deleteWordForward(){return this.deleteInDirection("forward")},formatBackColor(){return this.activateAttributeIfSupported("backgroundColor",this.event.data)},formatBold(){return this.toggleAttributeIfSupported("bold")},formatFontColor(){return this.activateAttributeIfSupported("color",this.event.data)},formatFontName(){return this.activateAttributeIfSupported("font",this.event.data)},formatIndent(){var o;if(null!==(o=this.responder)&&void 0!==o&&o.canIncreaseNestingLevel())return this.withTargetDOMRange((function(){var o;return null===(o=this.responder)||void 0===o?void 0:o.increaseNestingLevel()}))},formatItalic(){return this.toggleAttributeIfSupported("italic")},formatJustifyCenter(){return this.toggleAttributeIfSupported("justifyCenter")},formatJustifyFull(){return this.toggleAttributeIfSupported("justifyFull")},formatJustifyLeft(){return this.toggleAttributeIfSupported("justifyLeft")},formatJustifyRight(){return this.toggleAttributeIfSupported("justifyRight")},formatOutdent(){var o;if(null!==(o=this.responder)&&void 0!==o&&o.canDecreaseNestingLevel())return this.withTargetDOMRange((function(){var o;return null===(o=this.responder)||void 0===o?void 0:o.decreaseNestingLevel()}))},formatRemove(){this.withTargetDOMRange((function(){for(const a in null===(o=this.responder)||void 0===o?void 0:o.getCurrentAttributes()){var o,s;null===(s=this.responder)||void 0===s||s.removeCurrentAttribute(a)}}))},formatSetBlockTextDirection(){return this.activateAttributeIfSupported("blockDir",this.event.data)},formatSetInlineTextDirection(){return this.activateAttributeIfSupported("textDir",this.event.data)},formatStrikeThrough(){return this.toggleAttributeIfSupported("strike")},formatSubscript(){return this.toggleAttributeIfSupported("sub")},formatSuperscript(){return this.toggleAttributeIfSupported("sup")},formatUnderline(){return this.toggleAttributeIfSupported("underline")},historyRedo(){var o;return null===(o=this.delegate)||void 0===o?void 0:o.inputControllerWillPerformRedo()},historyUndo(){var o;return null===(o=this.delegate)||void 0===o?void 0:o.inputControllerWillPerformUndo()},insertCompositionText(){return this.composing=!0,this.insertString(this.event.data)},insertFromComposition(){return this.composing=!1,this.insertString(this.event.data)},insertFromDrop(){const o=this.deleteByDragRange;var s;if(o)return this.deleteByDragRange=null,null===(s=this.delegate)||void 0===s||s.inputControllerWillMoveText(),this.withTargetDOMRange((function(){var s;return null===(s=this.responder)||void 0===s?void 0:s.moveTextFromRange(o)}))},insertFromPaste(){const{dataTransfer:o}=this.event,s={dataTransfer:o},a=o.getData("URL"),l=o.getData("text/html");if(a){var c;let l;this.event.preventDefault(),s.type="text/html";const h=o.getData("public.url-name");l=h?Ut(h).trim():a,s.html=this.createLinkHTML(a,l),null===(c=this.delegate)||void 0===c||c.inputControllerWillPaste(s),this.withTargetDOMRange((function(){var o;return null===(o=this.responder)||void 0===o?void 0:o.insertHTML(s.html)})),this.afterRender=()=>{var o;return null===(o=this.delegate)||void 0===o?void 0:o.inputControllerDidPaste(s)}}else if(Ct(o)){var h;s.type="text/plain",s.string=o.getData("text/plain"),null===(h=this.delegate)||void 0===h||h.inputControllerWillPaste(s),this.withTargetDOMRange((function(){var o;return null===(o=this.responder)||void 0===o?void 0:o.insertString(s.string)})),this.afterRender=()=>{var o;return null===(o=this.delegate)||void 0===o?void 0:o.inputControllerDidPaste(s)}}else if(Ar(this.event)){var d;s.type="File",s.file=o.files[0],null===(d=this.delegate)||void 0===d||d.inputControllerWillPaste(s),this.withTargetDOMRange((function(){var o;return null===(o=this.responder)||void 0===o?void 0:o.insertFile(s.file)})),this.afterRender=()=>{var o;return null===(o=this.delegate)||void 0===o?void 0:o.inputControllerDidPaste(s)}}else if(l){var m;this.event.preventDefault(),s.type="text/html",s.html=l,null===(m=this.delegate)||void 0===m||m.inputControllerWillPaste(s),this.withTargetDOMRange((function(){var o;return null===(o=this.responder)||void 0===o?void 0:o.insertHTML(s.html)})),this.afterRender=()=>{var o;return null===(o=this.delegate)||void 0===o?void 0:o.inputControllerDidPaste(s)}}},insertFromYank(){return this.insertString(this.event.data)},insertLineBreak(){return this.insertString("\n")},insertLink(){return this.activateAttributeIfSupported("href",this.event.data)},insertOrderedList(){return this.toggleAttributeIfSupported("number")},insertParagraph(){var o;return null===(o=this.delegate)||void 0===o||o.inputControllerWillPerformTyping(),this.withTargetDOMRange((function(){var o;return null===(o=this.responder)||void 0===o?void 0:o.insertLineBreak()}))},insertReplacementText(){const o=this.event.dataTransfer.getData("text/plain"),s=this.event.getTargetRanges()[0];this.withTargetDOMRange(s,(()=>{this.insertString(o,{updatePosition:!1})}))},insertText(){var o;return this.insertString(this.event.data||(null===(o=this.event.dataTransfer)||void 0===o?void 0:o.getData("text/plain")))},insertTranspose(){return this.insertString(this.event.data)},insertUnorderedList(){return this.toggleAttributeIfSupported("bullet")}});const br=function(o){const s=document.createRange();return s.setStart(o.startContainer,o.startOffset),s.setEnd(o.endContainer,o.endOffset),s},vr=o=>{var s;return Array.from((null===(s=o.dataTransfer)||void 0===s?void 0:s.types)||[]).includes("Files")},Ar=o=>{var s;return(null===(s=o.dataTransfer.files)||void 0===s?void 0:s[0])&&!yr(o)&&!(o=>{let{dataTransfer:s}=o;return s.types.includes("Files")&&s.types.includes("text/html")&&s.getData("text/html").includes("urn:schemas-microsoft-com:office:office")})(o)},yr=function(o){const s=o.clipboardData;if(s)return Array.from(s.types).filter((o=>o.match(/file/i))).length===s.types.length&&s.files.length>=1},xr=function(o){const s=o.clipboardData;if(s)return s.types.includes("text/plain")&&1===s.types.length},Cr=function(o){const s=[];return o.altKey&&s.push("alt"),o.shiftKey&&s.push("shift"),s.push(o.key),s},Er=o=>({x:o.clientX,y:o.clientY}),Mr="[data-trix-attribute]",Br="[data-trix-action]",_r="".concat(Mr,", ").concat(Br),Wr="[data-trix-dialog]",Hr="".concat(Wr,"[data-trix-active]"),Jr="".concat(Wr," [data-trix-method]"),Kr="".concat(Wr," [data-trix-input]"),Nr=(o,s)=>(s||(s=Or(o)),o.querySelector("[data-trix-input][name='".concat(s,"']"))),Ir=o=>o.getAttribute("data-trix-action"),Or=o=>o.getAttribute("data-trix-attribute")||o.getAttribute("data-trix-dialog-attribute");class Pr extends z{constructor(o){super(o),this.didClickActionButton=this.didClickActionButton.bind(this),this.didClickAttributeButton=this.didClickAttributeButton.bind(this),this.didClickDialogButton=this.didClickDialogButton.bind(this),this.didKeyDownDialogInput=this.didKeyDownDialogInput.bind(this),this.element=o,this.attributes={},this.actions={},this.resetDialogInputs(),f("mousedown",{onElement:this.element,matchingSelector:Br,withCallback:this.didClickActionButton}),f("mousedown",{onElement:this.element,matchingSelector:Mr,withCallback:this.didClickAttributeButton}),f("click",{onElement:this.element,matchingSelector:_r,preventDefault:!0}),f("click",{onElement:this.element,matchingSelector:Jr,withCallback:this.didClickDialogButton}),f("keydown",{onElement:this.element,matchingSelector:Kr,withCallback:this.didKeyDownDialogInput})}didClickActionButton(o,s){var a;null===(a=this.delegate)||void 0===a||a.toolbarDidClickButton(),o.preventDefault();const l=Ir(s);return this.getDialog(l)?this.toggleDialog(l):null===(c=this.delegate)||void 0===c?void 0:c.toolbarDidInvokeAction(l,s);var c}didClickAttributeButton(o,s){var a;null===(a=this.delegate)||void 0===a||a.toolbarDidClickButton(),o.preventDefault();const l=Or(s);var c;this.getDialog(l)?this.toggleDialog(l):null===(c=this.delegate)||void 0===c||c.toolbarDidToggleAttribute(l);return this.refreshAttributeButtons()}didClickDialogButton(o,s){const a=A(s,{matchingSelector:Wr});return this[s.getAttribute("data-trix-method")].call(this,a)}didKeyDownDialogInput(o,s){if(13===o.keyCode){o.preventDefault();const a=s.getAttribute("name"),l=this.getDialog(a);this.setAttribute(l)}if(27===o.keyCode)return o.preventDefault(),this.hideDialog()}updateActions(o){return this.actions=o,this.refreshActionButtons()}refreshActionButtons(){return this.eachActionButton(((o,s)=>{o.disabled=!1===this.actions[s]}))}eachActionButton(o){return Array.from(this.element.querySelectorAll(Br)).map((s=>o(s,Ir(s))))}updateAttributes(o){return this.attributes=o,this.refreshAttributeButtons()}refreshAttributeButtons(){return this.eachAttributeButton(((o,s)=>(o.disabled=!1===this.attributes[s],this.attributes[s]||this.dialogIsVisible(s)?(o.setAttribute("data-trix-active",""),o.classList.add("trix-active")):(o.removeAttribute("data-trix-active"),o.classList.remove("trix-active")))))}eachAttributeButton(o){return Array.from(this.element.querySelectorAll(Mr)).map((s=>o(s,Or(s))))}applyKeyboardCommand(o){const s=JSON.stringify(o.sort());for(const o of Array.from(this.element.querySelectorAll("[data-trix-key]"))){const a=o.getAttribute("data-trix-key").split("+");if(JSON.stringify(a.sort())===s)return b("mousedown",{onElement:o}),!0}return!1}dialogIsVisible(o){const s=this.getDialog(o);if(s)return s.hasAttribute("data-trix-active")}toggleDialog(o){return this.dialogIsVisible(o)?this.hideDialog():this.showDialog(o)}showDialog(o){var s,a;this.hideDialog(),null===(s=this.delegate)||void 0===s||s.toolbarWillShowDialog();const l=this.getDialog(o);l.setAttribute("data-trix-active",""),l.classList.add("trix-active"),Array.from(l.querySelectorAll("input[disabled]")).forEach((o=>{o.removeAttribute("disabled")}));const c=Or(l);if(c){const s=Nr(l,o);s&&(s.value=this.attributes[c]||"",s.select())}return null===(a=this.delegate)||void 0===a?void 0:a.toolbarDidShowDialog(o)}setAttribute(o){const s=Or(o),a=Nr(o,s);return a.willValidate&&!a.checkValidity()?(a.setAttribute("data-trix-validate",""),a.classList.add("trix-validate"),a.focus()):(null===(l=this.delegate)||void 0===l||l.toolbarDidUpdateAttribute(s,a.value),this.hideDialog());var l}removeAttribute(o){var s;const a=Or(o);return null===(s=this.delegate)||void 0===s||s.toolbarDidRemoveAttribute(a),this.hideDialog()}hideDialog(){const o=this.element.querySelector(Hr);var s;if(o)return o.removeAttribute("data-trix-active"),o.classList.remove("trix-active"),this.resetDialogInputs(),null===(s=this.delegate)||void 0===s?void 0:s.toolbarDidHideDialog((o=>o.getAttribute("data-trix-dialog"))(o))}resetDialogInputs(){Array.from(this.element.querySelectorAll(Kr)).forEach((o=>{o.setAttribute("disabled","disabled"),o.removeAttribute("data-trix-validate"),o.classList.remove("trix-validate")}))}getDialog(o){return this.element.querySelector("[data-trix-dialog=".concat(o,"]"))}}class Fr extends Gn{constructor(o){let{editorElement:s,document:a,html:l}=o;super(...arguments),this.editorElement=s,this.selectionManager=new jn(this.editorElement),this.selectionManager.delegate=this,this.composition=new Rn,this.composition.delegate=this,this.attachmentManager=new En(this.composition.getAttachments()),this.attachmentManager.delegate=this,this.inputController=2===V.getLevel()?new fr(this.editorElement):new ur(this.editorElement),this.inputController.delegate=this,this.inputController.responder=this.composition,this.compositionController=new Kn(this.editorElement,this.composition),this.compositionController.delegate=this,this.toolbarController=new Pr(this.editorElement.toolbarElement),this.toolbarController.delegate=this,this.editor=new In(this.composition,this.selectionManager,this.editorElement),a?this.editor.loadDocument(a):this.editor.loadHTML(l)}registerSelectionManager(){return le.registerSelectionManager(this.selectionManager)}unregisterSelectionManager(){return le.unregisterSelectionManager(this.selectionManager)}render(){return this.compositionController.render()}reparse(){return this.composition.replaceHTML(this.editorElement.innerHTML)}compositionDidChangeDocument(o){if(this.notifyEditorElement("document-change"),!this.handlingInput)return this.render()}compositionDidChangeCurrentAttributes(o){return this.currentAttributes=o,this.toolbarController.updateAttributes(this.currentAttributes),this.updateCurrentActions(),this.notifyEditorElement("attributes-change",{attributes:this.currentAttributes})}compositionDidPerformInsertionAtRange(o){this.pasting&&(this.pastedRange=o)}compositionShouldAcceptFile(o){return this.notifyEditorElement("file-accept",{file:o})}compositionDidAddAttachment(o){const s=this.attachmentManager.manageAttachment(o);return this.notifyEditorElement("attachment-add",{attachment:s})}compositionDidEditAttachment(o){this.compositionController.rerenderViewForObject(o);const s=this.attachmentManager.manageAttachment(o);return this.notifyEditorElement("attachment-edit",{attachment:s}),this.notifyEditorElement("change")}compositionDidChangeAttachmentPreviewURL(o){return this.compositionController.invalidateViewForObject(o),this.notifyEditorElement("change")}compositionDidRemoveAttachment(o){const s=this.attachmentManager.unmanageAttachment(o);return this.notifyEditorElement("attachment-remove",{attachment:s})}compositionDidStartEditingAttachment(o,s){return this.attachmentLocationRange=this.composition.document.getLocationRangeOfAttachment(o),this.compositionController.installAttachmentEditorForAttachment(o,s),this.selectionManager.setLocationRange(this.attachmentLocationRange)}compositionDidStopEditingAttachment(o){this.compositionController.uninstallAttachmentEditor(),this.attachmentLocationRange=null}compositionDidRequestChangingSelectionToLocationRange(o){if(!this.loadingSnapshot||this.isFocused())return this.requestedLocationRange=o,this.compositionRevisionWhenLocationRangeRequested=this.composition.revision,this.handlingInput?void 0:this.render()}compositionWillLoadSnapshot(){this.loadingSnapshot=!0}compositionDidLoadSnapshot(){this.compositionController.refreshViewCache(),this.render(),this.loadingSnapshot=!1}getSelectionManager(){return this.selectionManager}attachmentManagerDidRequestRemovalOfAttachment(o){return this.removeAttachment(o)}compositionControllerWillSyncDocumentView(){return this.inputController.editorWillSyncDocumentView(),this.selectionManager.lock(),this.selectionManager.clearSelection()}compositionControllerDidSyncDocumentView(){return this.inputController.editorDidSyncDocumentView(),this.selectionManager.unlock(),this.updateCurrentActions(),this.notifyEditorElement("sync")}compositionControllerDidRender(){this.requestedLocationRange&&(this.compositionRevisionWhenLocationRangeRequested===this.composition.revision&&this.selectionManager.setLocationRange(this.requestedLocationRange),this.requestedLocationRange=null,this.compositionRevisionWhenLocationRangeRequested=null),this.renderedCompositionRevision!==this.composition.revision&&(this.runEditorFilters(),this.composition.updateCurrentAttributes(),this.notifyEditorElement("render")),this.renderedCompositionRevision=this.composition.revision}compositionControllerDidFocus(){return this.isFocusedInvisibly()&&this.setLocationRange({index:0,offset:0}),this.toolbarController.hideDialog(),this.notifyEditorElement("focus")}compositionControllerDidBlur(){return this.notifyEditorElement("blur")}compositionControllerDidSelectAttachment(o,s){return this.toolbarController.hideDialog(),this.composition.editAttachment(o,s)}compositionControllerDidRequestDeselectingAttachment(o){const s=this.attachmentLocationRange||this.composition.document.getLocationRangeOfAttachment(o);return this.selectionManager.setLocationRange(s[1])}compositionControllerWillUpdateAttachment(o){return this.editor.recordUndoEntry("Edit Attachment",{context:o.id,consolidatable:!0})}compositionControllerDidRequestRemovalOfAttachment(o){return this.removeAttachment(o)}inputControllerWillHandleInput(){this.handlingInput=!0,this.requestedRender=!1}inputControllerDidRequestRender(){this.requestedRender=!0}inputControllerDidHandleInput(){if(this.handlingInput=!1,this.requestedRender)return this.requestedRender=!1,this.render()}inputControllerDidAllowUnhandledInput(){return this.notifyEditorElement("change")}inputControllerDidRequestReparse(){return this.reparse()}inputControllerWillPerformTyping(){return this.recordTypingUndoEntry()}inputControllerWillPerformFormatting(o){return this.recordFormattingUndoEntry(o)}inputControllerWillCutText(){return this.editor.recordUndoEntry("Cut")}inputControllerWillPaste(o){return this.editor.recordUndoEntry("Paste"),this.pasting=!0,this.notifyEditorElement("before-paste",{paste:o})}inputControllerDidPaste(o){return o.range=this.pastedRange,this.pastedRange=null,this.pasting=null,this.notifyEditorElement("paste",{paste:o})}inputControllerWillMoveText(){return this.editor.recordUndoEntry("Move")}inputControllerWillAttachFiles(){return this.editor.recordUndoEntry("Drop Files")}inputControllerWillPerformUndo(){return this.editor.undo()}inputControllerWillPerformRedo(){return this.editor.redo()}inputControllerDidReceiveKeyboardCommand(o){return this.toolbarController.applyKeyboardCommand(o)}inputControllerDidStartDrag(){this.locationRangeBeforeDrag=this.selectionManager.getLocationRange()}inputControllerDidReceiveDragOverPoint(o){return this.selectionManager.setLocationRangeFromPointRange(o)}inputControllerDidCancelDrag(){this.selectionManager.setLocationRange(this.locationRangeBeforeDrag),this.locationRangeBeforeDrag=null}locationRangeDidChange(o){return this.composition.updateCurrentAttributes(),this.updateCurrentActions(),this.attachmentLocationRange&&!Lt(this.attachmentLocationRange,o)&&this.composition.stopEditingAttachment(),this.notifyEditorElement("selection-change")}toolbarDidClickButton(){if(!this.getLocationRange())return this.setLocationRange({index:0,offset:0})}toolbarDidInvokeAction(o,s){return this.invokeAction(o,s)}toolbarDidToggleAttribute(o){if(this.recordFormattingUndoEntry(o),this.composition.toggleCurrentAttribute(o),this.render(),!this.selectionFrozen)return this.editorElement.focus()}toolbarDidUpdateAttribute(o,s){if(this.recordFormattingUndoEntry(o),this.composition.setCurrentAttribute(o,s),this.render(),!this.selectionFrozen)return this.editorElement.focus()}toolbarDidRemoveAttribute(o){if(this.recordFormattingUndoEntry(o),this.composition.removeCurrentAttribute(o),this.render(),!this.selectionFrozen)return this.editorElement.focus()}toolbarWillShowDialog(o){return this.composition.expandSelectionForEditing(),this.freezeSelection()}toolbarDidShowDialog(o){return this.notifyEditorElement("toolbar-dialog-show",{dialogName:o})}toolbarDidHideDialog(o){return this.thawSelection(),this.editorElement.focus(),this.notifyEditorElement("toolbar-dialog-hide",{dialogName:o})}freezeSelection(){if(!this.selectionFrozen)return this.selectionManager.lock(),this.composition.freezeSelection(),this.selectionFrozen=!0,this.render()}thawSelection(){if(this.selectionFrozen)return this.composition.thawSelection(),this.selectionManager.unlock(),this.selectionFrozen=!1,this.render()}canInvokeAction(o){return!!this.actionIsExternal(o)||!(null===(s=this.actions[o])||void 0===s||null===(s=s.test)||void 0===s||!s.call(this));var s}invokeAction(o,s){return this.actionIsExternal(o)?this.notifyEditorElement("action-invoke",{actionName:o,invokingElement:s}):null===(a=this.actions[o])||void 0===a||null===(a=a.perform)||void 0===a?void 0:a.call(this);var a}actionIsExternal(o){return/^x-./.test(o)}getCurrentActions(){const o={};for(const s in this.actions)o[s]=this.canInvokeAction(s);return o}updateCurrentActions(){const o=this.getCurrentActions();if(!kt(o,this.currentActions))return this.currentActions=o,this.toolbarController.updateActions(this.currentActions),this.notifyEditorElement("actions-change",{actions:this.currentActions})}runEditorFilters(){let o=this.composition.getSnapshot();if(Array.from(this.editor.filters).forEach((s=>{const{document:a,selectedRange:l}=o;o=s.call(this.editor,o)||{},o.document||(o.document=a),o.selectedRange||(o.selectedRange=l)})),s=o,a=this.composition.getSnapshot(),!Lt(s.selectedRange,a.selectedRange)||!s.document.isEqualTo(a.document))return this.composition.loadSnapshot(o);var s,a}updateInputElement(){const o=function(o,s){const a=Vn[s];if(a)return a(o);throw new Error("unknown content type: ".concat(s))}(this.compositionController.getSerializableElement(),"text/html");return this.editorElement.setFormValue(o)}notifyEditorElement(o,s){switch(o){case"document-change":this.documentChangedSinceLastRender=!0;break;case"render":this.documentChangedSinceLastRender&&(this.documentChangedSinceLastRender=!1,this.notifyEditorElement("change"));break;case"change":case"attachment-add":case"attachment-edit":case"attachment-remove":this.updateInputElement()}return this.editorElement.notify(o,s)}removeAttachment(o){return this.editor.recordUndoEntry("Delete Attachment"),this.composition.removeAttachment(o),this.render()}recordFormattingUndoEntry(o){const s=gt(o),a=this.selectionManager.getLocationRange();if(s||!wt(a))return this.editor.recordUndoEntry("Formatting",{context:this.getUndoContext(),consolidatable:!0})}recordTypingUndoEntry(){return this.editor.recordUndoEntry("Typing",{context:this.getUndoContext(this.currentAttributes),consolidatable:!0})}getUndoContext(){for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return[this.getLocationContext(),this.getTimeContext(),...Array.from(s)]}getLocationContext(){const o=this.selectionManager.getLocationRange();return wt(o)?o[0].index:o}getTimeContext(){return G.interval>0?Math.floor((new Date).getTime()/G.interval):0}isFocused(){var o;return this.editorElement===(null===(o=this.editorElement.ownerDocument)||void 0===o?void 0:o.activeElement)}isFocusedInvisibly(){return this.isFocused()&&!this.getLocationRange()}get actions(){return this.constructor.actions}}Ti(Fr,"actions",{undo:{test(){return this.editor.canUndo()},perform(){return this.editor.undo()}},redo:{test(){return this.editor.canRedo()},perform(){return this.editor.redo()}},link:{test(){return this.editor.canActivateAttribute("href")}},increaseNestingLevel:{test(){return this.editor.canIncreaseNestingLevel()},perform(){return this.editor.increaseNestingLevel()&&this.render()}},decreaseNestingLevel:{test(){return this.editor.canDecreaseNestingLevel()},perform(){return this.editor.decreaseNestingLevel()&&this.render()}},attachFiles:{test:()=>!0,perform(){return V.pickFiles(this.editor.insertFiles)}}}),Fr.proxyMethod("getSelectionManager().setLocationRange"),Fr.proxyMethod("getSelectionManager().getLocationRange");var $r=Object.freeze({__proto__:null,AttachmentEditorController:Jn,CompositionController:Kn,Controller:Gn,EditorController:Fr,InputController:or,Level0InputController:ur,Level2InputController:fr,ToolbarController:Pr}),Xr=Object.freeze({__proto__:null,MutationObserver:Zn,SelectionChangeObserver:It}),Zr=Object.freeze({__proto__:null,FileVerificationOperation:tr,ImagePreloadOperation:_i});bt("trix-toolbar","%t {\n  display: block;\n}\n\n%t {\n  white-space: nowrap;\n}\n\n%t [data-trix-dialog] {\n  display: none;\n}\n\n%t [data-trix-dialog][data-trix-active] {\n  display: block;\n}\n\n%t [data-trix-dialog] [data-trix-validate]:invalid {\n  background-color: #ffdddd;\n}");class jr extends HTMLElement{connectedCallback(){""===this.innerHTML&&(this.innerHTML=K.getDefaultHTML())}}let to=0;const Ur=function(o){if(!o.hasAttribute("contenteditable"))return o.setAttribute("contenteditable",""),function(o){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s.times=1,f(o,s)}("focus",{onElement:o,withCallback:()=>Vr(o)})},Vr=function(o){return zr(o),qr(o)},zr=function(o){var s,a;if(null!==(s=(a=document).queryCommandSupported)&&void 0!==s&&s.call(a,"enableObjectResizing"))return document.execCommand("enableObjectResizing",!1,!1),f("mscontrolselect",{onElement:o,preventDefault:!0})},qr=function(o){var s,a;if(null!==(s=(a=document).queryCommandSupported)&&void 0!==s&&s.call(a,"DefaultParagraphSeparator")){const{tagName:o}=l.default;if(["div","p"].includes(o))return document.execCommand("DefaultParagraphSeparator",!1,o)}},io=d.forcesObjectResizing?{display:"inline",width:"auto"}:{display:"inline-block",width:"1px"};bt("trix-editor","%t {\n    display: block;\n}\n\n%t:empty::before {\n    content: attr(placeholder);\n    color: graytext;\n    cursor: text;\n    pointer-events: none;\n    white-space: pre-line;\n}\n\n%t a[contenteditable=false] {\n    cursor: text;\n}\n\n%t img {\n    max-width: 100%;\n    height: auto;\n}\n\n%t ".concat(s," figcaption textarea {\n    resize: none;\n}\n\n%t ").concat(s," figcaption textarea.trix-autoresize-clone {\n    position: absolute;\n    left: -9999px;\n    max-height: 0px;\n}\n\n%t ").concat(s," figcaption[data-trix-placeholder]:empty::before {\n    content: attr(data-trix-placeholder);\n    color: graytext;\n}\n\n%t [data-trix-cursor-target] {\n    display: ").concat(io.display," !important;\n    width: ").concat(io.width," !important;\n    padding: 0 !important;\n    margin: 0 !important;\n    border: none !important;\n}\n\n%t [data-trix-cursor-target=left] {\n    vertical-align: top !important;\n    margin-left: -1px !important;\n}\n\n%t [data-trix-cursor-target=right] {\n    vertical-align: bottom !important;\n    margin-right: -1px !important;\n}"));var no=new WeakMap,ro=new WeakSet;class Gr{constructor(o){var s,a;Fi(s=this,a=ro),a.add(s),Mi(this,no,{writable:!0,value:void 0}),this.element=o,Di(this,no,o.attachInternals())}connectedCallback(){Pi(this,ro,Yr).call(this)}disconnectedCallback(){}get labels(){return Li(this,no).labels}get disabled(){var o;return null===(o=this.element.inputElement)||void 0===o?void 0:o.disabled}set disabled(o){this.element.toggleAttribute("disabled",o)}get required(){return this.element.hasAttribute("required")}set required(o){this.element.toggleAttribute("required",o),Pi(this,ro,Yr).call(this)}get validity(){return Li(this,no).validity}get validationMessage(){return Li(this,no).validationMessage}get willValidate(){return Li(this,no).willValidate}setFormValue(o){Pi(this,ro,Yr).call(this)}checkValidity(){return Li(this,no).checkValidity()}reportValidity(){return Li(this,no).reportValidity()}setCustomValidity(o){Pi(this,ro,Yr).call(this,o)}}function Yr(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const{required:s,value:a}=this.element,l=s&&!a,c=!!o,h=k("input",{required:s}),d=o||h.validationMessage;Li(this,no).setValidity({valueMissing:l,customError:c},d)}var oo=new WeakMap,so=new WeakMap,ao=new WeakMap;class Qr{constructor(o){Mi(this,oo,{writable:!0,value:void 0}),Mi(this,so,{writable:!0,value:o=>{o.defaultPrevented||o.target===this.element.form&&this.element.reset()}}),Mi(this,ao,{writable:!0,value:o=>{if(o.defaultPrevented)return;if(this.element.contains(o.target))return;const s=A(o.target,{matchingSelector:"label"});s&&Array.from(this.labels).includes(s)&&this.element.focus()}}),this.element=o}connectedCallback(){Di(this,oo,function(o){if(o.hasAttribute("aria-label")||o.hasAttribute("aria-labelledby"))return;const e=function(){const s=Array.from(o.labels).map((s=>{if(!s.contains(o))return s.textContent})).filter((o=>o)),a=s.join(" ");return a?o.setAttribute("aria-label",a):o.removeAttribute("aria-label")};return e(),f("focus",{onElement:o,withCallback:e})}(this.element)),window.addEventListener("reset",Li(this,so),!1),window.addEventListener("click",Li(this,ao),!1)}disconnectedCallback(){var o;null===(o=Li(this,oo))||void 0===o||o.destroy(),window.removeEventListener("reset",Li(this,so),!1),window.removeEventListener("click",Li(this,ao),!1)}get labels(){const o=[];this.element.id&&this.element.ownerDocument&&o.push(...Array.from(this.element.ownerDocument.querySelectorAll("label[for='".concat(this.element.id,"']"))||[]));const s=A(this.element,{matchingSelector:"label"});return s&&[this.element,null].includes(s.control)&&o.push(s),o}get disabled(){return console.warn("This browser does not support the [disabled] attribute for trix-editor elements."),!1}set disabled(o){console.warn("This browser does not support the [disabled] attribute for trix-editor elements.")}get required(){return console.warn("This browser does not support the [required] attribute for trix-editor elements."),!1}set required(o){console.warn("This browser does not support the [required] attribute for trix-editor elements.")}get validity(){return console.warn("This browser does not support the validity property for trix-editor elements."),null}get validationMessage(){return console.warn("This browser does not support the validationMessage property for trix-editor elements."),""}get willValidate(){return console.warn("This browser does not support the willValidate property for trix-editor elements."),!1}setFormValue(o){}checkValidity(){return console.warn("This browser does not support checkValidity() for trix-editor elements."),!0}reportValidity(){return console.warn("This browser does not support reportValidity() for trix-editor elements."),!0}setCustomValidity(o){console.warn("This browser does not support setCustomValidity(validationMessage) for trix-editor elements.")}}var lo=new WeakMap;class eo extends HTMLElement{constructor(){super(),Mi(this,lo,{writable:!0,value:void 0}),Di(this,lo,this.constructor.formAssociated?new Gr(this):new Qr(this))}get trixId(){return this.hasAttribute("trix-id")?this.getAttribute("trix-id"):(this.setAttribute("trix-id",++to),this.trixId)}get labels(){return Li(this,lo).labels}get disabled(){return Li(this,lo).disabled}set disabled(o){Li(this,lo).disabled=o}get required(){return Li(this,lo).required}set required(o){Li(this,lo).required=o}get validity(){return Li(this,lo).validity}get validationMessage(){return Li(this,lo).validationMessage}get willValidate(){return Li(this,lo).willValidate}get type(){return this.localName}get toolbarElement(){var o;if(this.hasAttribute("toolbar"))return null===(o=this.ownerDocument)||void 0===o?void 0:o.getElementById(this.getAttribute("toolbar"));if(this.parentNode){const o="trix-toolbar-".concat(this.trixId);this.setAttribute("toolbar",o);const s=k("trix-toolbar",{id:o});return this.parentNode.insertBefore(s,this),s}}get form(){var o;return null===(o=this.inputElement)||void 0===o?void 0:o.form}get inputElement(){var o;if(this.hasAttribute("input"))return null===(o=this.ownerDocument)||void 0===o?void 0:o.getElementById(this.getAttribute("input"));if(this.parentNode){const o="trix-input-".concat(this.trixId);this.setAttribute("input",o);const s=k("input",{type:"hidden",id:o});return this.parentNode.insertBefore(s,this.nextElementSibling),s}}get editor(){var o;return null===(o=this.editorController)||void 0===o?void 0:o.editor}get name(){var o;return null===(o=this.inputElement)||void 0===o?void 0:o.name}get value(){var o;return null===(o=this.inputElement)||void 0===o?void 0:o.value}set value(o){var s;this.defaultValue=o,null===(s=this.editor)||void 0===s||s.loadHTML(this.defaultValue)}notify(o,s){if(this.editorController)return b("trix-".concat(o),{onElement:this,attributes:s})}setFormValue(o){this.inputElement&&(this.inputElement.value=o,Li(this,lo).setFormValue(o))}connectedCallback(){this.hasAttribute("data-trix-internal")||(Ur(this),function(o){o.hasAttribute("role")||o.setAttribute("role","textbox")}(this),this.editorController||(b("trix-before-initialize",{onElement:this}),this.editorController=new Fr({editorElement:this,html:this.defaultValue=this.value}),requestAnimationFrame((()=>b("trix-initialize",{onElement:this})))),this.editorController.registerSelectionManager(),Li(this,lo).connectedCallback(),function(o){!document.querySelector(":focus")&&o.hasAttribute("autofocus")&&document.querySelector("[autofocus]")===o&&o.focus()}(this))}disconnectedCallback(){var o;null===(o=this.editorController)||void 0===o||o.unregisterSelectionManager(),Li(this,lo).disconnectedCallback()}checkValidity(){return Li(this,lo).checkValidity()}reportValidity(){return Li(this,lo).reportValidity()}setCustomValidity(o){Li(this,lo).setCustomValidity(o)}formDisabledCallback(o){this.inputElement&&(this.inputElement.disabled=o),this.toggleAttribute("contenteditable",!o)}formResetCallback(){this.reset()}reset(){this.value=this.defaultValue}}Ti(eo,"formAssociated","ElementInternals"in window);const co={VERSION:o,config:Y,core:qn,models:Xn,views:nr,controllers:$r,observers:Xr,operations:Zr,elements:Object.freeze({__proto__:null,TrixEditorElement:eo,TrixToolbarElement:jr}),filters:Object.freeze({__proto__:null,Filter:Ln,attachmentGalleryFilter:Dn})};Object.assign(co,Xn),window.Trix=co,setTimeout((function(){customElements.get("trix-toolbar")||customElements.define("trix-toolbar",jr),customElements.get("trix-editor")||customElements.define("trix-editor",eo)}),0);export{co as default};

